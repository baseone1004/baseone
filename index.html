<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BaseOne</title>
<style>
  :root{
    --bg:#0b1020; --panel:#121a33; --panel2:#0f1530;
    --line:rgba(255,255,255,.10);
    --text:#eaf0ff; --sub:#b9c6ff;
    --blue:#4f8cff; --blue2:#2f6bff;
    --green:#2dd4bf;
  }
  *{box-sizing:border-box}
  body{
    margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;color:var(--text);
    background:radial-gradient(1200px 800px at 20% 10%, #1a2a5a 0%, var(--bg) 45%), var(--bg);
  }
  a{color:inherit;text-decoration:none}
  .wrap{max-width:1100px;margin:0 auto;padding:18px}
  .top{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;margin-bottom:14px}
  .brand{display:flex;align-items:center;gap:10px}
  .logo{width:38px;height:38px;border-radius:14px;background:linear-gradient(135deg,#4f8cff,#2dd4bf);display:grid;place-items:center;font-weight:900}
  .title{font-size:26px;font-weight:900}
  .pill{padding:6px 10px;border:1px solid var(--line);border-radius:999px;background:rgba(255,255,255,.04);color:var(--sub);font-size:12px}
  .btn{padding:10px 14px;border-radius:12px;border:1px solid var(--line);background:rgba(255,255,255,.06);color:var(--text);cursor:pointer;font-weight:800}
  .btn.primary{background:linear-gradient(135deg,var(--blue),var(--blue2));border:none}
  .btn.gray{background:rgba(255,255,255,.08)}
  .panel{background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));border:1px solid var(--line);border-radius:18px;padding:14px}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between}
  .small{font-size:12px;color:var(--sub);line-height:1.5}
  input,select{
    padding:10px;border-radius:12px;border:1px solid var(--line);
    background:rgba(15,21,48,.85);color:var(--text);outline:none;min-width:220px
  }
  .cats{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-top:12px}
  @media(max-width:900px){.cats{grid-template-columns:repeat(2,1fr)}}
  .cat{
    border:1px solid var(--line);border-radius:18px;padding:14px;cursor:pointer;
    background:linear-gradient(135deg, rgba(79,140,255,.12), rgba(45,212,191,.06));
    transition:.15s transform ease,.15s background ease
  }
  .cat:hover{transform:translateY(-2px);background:linear-gradient(135deg, rgba(79,140,255,.18), rgba(45,212,191,.10))}
  .catTop{display:flex;align-items:center;gap:10px}
  .icon{width:36px;height:36px;border-radius:14px;background:rgba(255,255,255,.08);display:grid;place-items:center;font-size:18px}
  .catName{font-weight:900}
  .catDesc{font-size:12px;color:var(--sub);margin-top:6px}
  .list{margin-top:12px;display:grid;grid-template-columns:1fr;gap:10px}
  .item{
    border:1px solid var(--line);border-radius:16px;padding:12px;
    background:rgba(18,26,51,.70);display:flex;gap:10px;justify-content:space-between;align-items:center
  }
  .itemLeft{min-width:0}
  .itemTitle{font-weight:800;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .itemMeta{font-size:12px;color:var(--sub);margin-top:4px}
  .chip{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:rgba(255,255,255,.04);color:var(--sub);font-size:12px}
  /* modal */
  .modalBg{display:none; position:fixed; inset:0; background:rgba(0,0,0,.6); padding:18px;}
  .modal{max-width:920px;margin:40px auto;background:rgba(18,26,51,.92);backdrop-filter: blur(10px);
    border:1px solid var(--line);border-radius:18px;padding:14px}
  textarea{
    width:100%;min-height:180px;background:rgba(15,21,48,.9);border:1px solid var(--line);
    border-radius:14px;color:var(--text);padding:10px;resize:vertical
  }
  .ok{color:#9ff5d2;font-weight:800}
  .warn{color:#ffb4b4;font-weight:800}
</style>
</head>
<body>
<div class="wrap">

  <div class="top">
    <div class="brand">
      <div class="logo">B</div>
      <div>
        <div class="title">BaseOne</div>
        <div class="small">ì¹´í…Œê³ ë¦¬/ìˆ˜ìµí˜• ì£¼ì œë¥¼ ì¹´ë“œë¡œ ë§Œë“¤ê³ , ë³µì‚¬í•˜ê±°ë‚˜(ë˜ëŠ” ë¡œì»¬ ì„œë²„ë¡œ) AI ìƒì„± í…ŒìŠ¤íŠ¸ë¥¼ í•  ìˆ˜ ìˆì–´ìš”.</div>
      </div>
    </div>
    <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
      <span class="pill" id="serverPill">ì„œë²„: -</span>
      <a href="./settings.html"><button class="btn">ì„¤ì •</button></a>
      <button class="btn primary" onclick="makeMoney()">ğŸ’° ìˆ˜ìµí˜• ì£¼ì œ 100</button>
    </div>
  </div>

  <div class="panel">
    <div class="row">
      <div>
        <div style="font-weight:900">ì£¼ì œ ìƒì„±</div>
        <div class="small" id="selInfo">ì•„ë˜ì—ì„œ ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”.</div>
      </div>
      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <input id="filter" placeholder="ì£¼ì œ ê²€ìƒ‰(í•„í„°)" oninput="renderList()">
        <button class="btn" onclick="copyAll()">ì „ì²´ë³µì‚¬</button>
        <button class="btn primary" onclick="aiGenerateSelected()">âœ¨ AI ìƒì„±(ì„ íƒ ì£¼ì œ)</button>
      </div>
    </div>
  </div>

  <div class="cats" id="catGrid"></div>

  <div class="panel" style="margin-top:12px">
    <div class="row">
      <div>
        <div class="chip" id="boxTitle">ì£¼ì œ ëª©ë¡</div>
        <div class="small" id="boxSub">ì„ íƒí•œ ì£¼ì œê°€ ì—¬ê¸° ì¹´ë“œë¡œ ë‚˜ì™€ìš”.</div>
      </div>
      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <select id="blogSelect">
          <option value="">ë¸”ë¡œê·¸ ì„ íƒ(ì €ì¥ëœ ì£¼ì†Œ)</option>
        </select>
      </div>
    </div>

    <div class="list" id="list"></div>
  </div>

</div>

<!-- ê²°ê³¼ ëª¨ë‹¬ -->
<div class="modalBg" id="modalBg">
  <div class="modal">
    <div class="row">
      <b>AI ìƒì„± ê²°ê³¼</b>
      <button class="btn gray" onclick="closeModal()">ë‹«ê¸°</button>
    </div>

    <div class="panel" style="margin-top:12px">
      <div class="row">
        <div>
          <div class="small">ì œëª©</div>
          <div style="font-weight:900" id="outTitle">-</div>
          <div class="small" id="outMeta">-</div>
        </div>
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <button class="btn" onclick="copyText(document.getElementById('outTitle').textContent)">ì œëª© ë³µì‚¬</button>
          <button class="btn" onclick="copyText(document.getElementById('outImage').value)">ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ ë³µì‚¬</button>
          <button class="btn primary" onclick="copyText(document.getElementById('outBody').value)">ë³¸ë¬¸ í”„ë¡¬í”„íŠ¸ ë³µì‚¬</button>
        </div>
      </div>
    </div>

    <div class="panel" style="margin-top:12px">
      <div class="small"><b>ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸</b></div>
      <textarea id="outImage"></textarea>
    </div>

    <div class="panel" style="margin-top:12px">
      <div class="small"><b>ë³¸ë¬¸ í”„ë¡¬í”„íŠ¸</b></div>
      <textarea id="outBody"></textarea>
    </div>
  </div>
</div>

<script>
const CATS = [
  {n:"ê±´ê°•", i:"ğŸ©º", d:"ì²´ì¤‘/ì‹ë‹¨/ìˆ˜ë©´/ì˜ì–‘"},
  {n:"ì»´í“¨í„°/IT", i:"ğŸ’»", d:"PC/ì•±/ë³´ì•ˆ/AI"},
  {n:"ìë™ì°¨", i:"ğŸš—", d:"ì •ë¹„/ë³´í—˜/ì—°ë¹„"},
  {n:"ìƒí™œ/ê°€ì „", i:"ğŸ ", d:"ì²­ì†Œ/ê°€ì „/ì ˆì•½"},
  {n:"ìœ¡ì•„", i:"ğŸ¼", d:"ìœ¡ì•„í…œ/êµìœ¡/ì¼ìƒ"},
  {n:"ëˆ/ì¬í…Œí¬", i:"ğŸ’³", d:"ì ˆì•½/ì„¸ê¸ˆ/íˆ¬ì"},
  {n:"ì—¬í–‰", i:"âœˆï¸", d:"ì½”ìŠ¤/ì¤€ë¹„/íŒ"},
  {n:"ìš”ë¦¬", i:"ğŸ³", d:"ë ˆì‹œí”¼/ì¬ë£Œ/ë³´ê´€"},
  {n:"ìê¸°ê³„ë°œ", i:"ğŸ“ˆ", d:"ìŠµê´€/ë£¨í‹´/ëª©í‘œ"},
  {n:"ê³µë¶€/ìê²©ì¦", i:"ğŸ“š", d:"ì‹œí—˜/ê³µë¶€ë²•"},
  {n:"ë°˜ë ¤ë™ë¬¼", i:"ğŸ¶", d:"ì¼€ì–´/ìš©í’ˆ"},
  {n:"íŒ¨ì…˜/ë·°í‹°", i:"ğŸ’„", d:"ê´€ë¦¬/ì½”ë””"},
  {n:"ì·¨ë¯¸", i:"ğŸ¨", d:"ì·¨ë¯¸/DIY"},
  {n:"ìŠ¤í¬ì¸ ", i:"âš½", d:"ìš´ë™/ë£¨í‹´"},
  {n:"ê²Œì„", i:"ğŸ®", d:"ë¦¬ë·°/íŒ"},
  {n:"ì˜í™”/ë“œë¼ë§ˆ", i:"ğŸ¬", d:"ì¶”ì²œ/ë¦¬ë·°"},
];

const SETTINGS_KEY = "baseone_settings_v3";
let topics = [];
let selectedTopic = "";
let selectedCat = "";

function loadSettings(){
  const s = JSON.parse(localStorage.getItem(SETTINGS_KEY)||"{}");
  const backend = s.backend || "http://127.0.0.1:5000";
  document.getElementById("serverPill").textContent = "ì„œë²„: " + backend;

  // ì €ì¥ëœ ë¸”ë¡œê·¸ ì£¼ì†Œë¥¼ ë“œë¡­ë‹¤ìš´ì— ë„£ê¸°
  const sel = document.getElementById("blogSelect");
  sel.innerHTML = `<option value="">ë¸”ë¡œê·¸ ì„ íƒ(ì €ì¥ëœ ì£¼ì†Œ)</option>`;
  const add = (arr,label) => (arr||[]).filter(Boolean).forEach((u,idx)=>{
    const opt = document.createElement("option");
    opt.value = u;
    opt.textContent = `${label} ${idx+1} - ${u}`;
    sel.appendChild(opt);
  });
  add(s.blogspot,"ë¸”ë¡œê·¸ìŠ¤íŒŸ");
  add(s.naver,"ë„¤ì´ë²„");
  add(s.tistory,"í‹°ìŠ¤í† ë¦¬");
}
loadSettings();

const catGrid = document.getElementById("catGrid");
CATS.forEach(c=>{
  const d=document.createElement("div");
  d.className="cat";
  d.innerHTML = `
    <div class="catTop">
      <div class="icon">${c.i}</div>
      <div style="min-width:0">
        <div class="catName">${c.n}</div>
        <div class="catDesc">${c.d}</div>
      </div>
    </div>
  `;
  d.onclick=()=>makeTopics(c.n);
  catGrid.appendChild(d);
});

function setInfo(){
  document.getElementById("selInfo").textContent =
    selectedTopic ? `ì„ íƒ ì£¼ì œ: ${selectedTopic}` : "ì•„ë˜ì—ì„œ ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”.";
}

function makeTopics(cat){
  selectedCat = cat;
  topics = [];
  for(let i=1;i<=50;i++){
    topics.push(`${cat} ê¸€ ì•„ì´ë””ì–´ ${i}`);
  }
  selectedTopic = topics[0] || "";
  document.getElementById("boxTitle").textContent = `${cat} ì£¼ì œ 50ê°œ`;
  document.getElementById("boxSub").textContent = "ì¹´ë“œë¥¼ ëˆŒëŸ¬ ì„ íƒ/ë³µì‚¬í•  ìˆ˜ ìˆì–´ìš”.";
  setInfo();
  renderList();
}

function makeMoney(){
  selectedCat = "ìˆ˜ìµí˜•";
  topics=[];
  const buckets=["ë³´í—˜","ëŒ€ì¶œ","ì¹´ë“œ","í†µì‹ ë¹„","ì „ê¸°ìš”ê¸ˆ","ì„¸ê¸ˆ","ì—°ê¸ˆ","ë¶€ì—…","ë‹¤ì´ì–´íŠ¸","ì˜ì–‘ì œ","ê°€ì „","ìœ¡ì•„í…œ","ìë™ì°¨","ì—¬í–‰","ìê²©ì¦","ë…¸íŠ¸ë¶","ì²­ì†Œ","ìƒí™œíŒ"];
  for(let i=1;i<=100;i++){
    topics.push(`ìˆ˜ìµí˜• ì£¼ì œ ${i}: ${buckets[i%buckets.length]}`);
  }
  selectedTopic = topics[0] || "";
  document.getElementById("boxTitle").textContent = `ğŸ’° ìˆ˜ìµí˜• ì£¼ì œ 100ê°œ`;
  document.getElementById("boxSub").textContent = "ìˆ˜ìµí˜• ì£¼ì œë¥¼ ì¹´ë“œë¡œ ì •ë¦¬í–ˆì–´ìš”.";
  setInfo();
  renderList();
}

function renderList(){
  const q=(document.getElementById("filter").value||"").trim().toLowerCase();
  const list=document.getElementById("list");
  list.innerHTML="";
  const filtered = q ? topics.filter(t=>t.toLowerCase().includes(q)) : topics;

  filtered.forEach(t=>{
    const el=document.createElement("div");
    el.className="item";
    el.innerHTML=`
      <div class="itemLeft">
        <div class="itemTitle">${escapeHtml(t)}</div>
        <div class="itemMeta">${selectedCat ? "ì¹´í…Œê³ ë¦¬: "+selectedCat : ""}</div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn" onclick="setSelected('${escapeAttr(t)}')">ì„ íƒ</button>
        <button class="btn" onclick="copyText('${escapeAttr(t)}')">ë³µì‚¬</button>
      </div>
    `;
    list.appendChild(el);
  });
}

function setSelected(t){
  selectedTopic = t;
  setInfo();
}

function copyText(t){
  navigator.clipboard.writeText(t);
  alert("ë³µì‚¬ ì™„ë£Œ!");
}

function copyAll(){
  if(!topics.length){alert("ì£¼ì œ ì—†ìŒ");return;}
  navigator.clipboard.writeText(topics.join("\n"));
  alert("ì „ì²´ ë³µì‚¬ ì™„ë£Œ!");
}

async function aiGenerateSelected(){
  if(!selectedTopic){ alert("ë¨¼ì € ì£¼ì œë¥¼ ì„ íƒí•˜ì„¸ìš”!"); return; }

  const s = JSON.parse(localStorage.getItem(SETTINGS_KEY)||"{}");
  const backend = (s.backend || "http://127.0.0.1:5000").trim();

  // í˜„ì¬ ë‹¨ê³„: ì„œë²„ì—ì„œ í”„ë¡¬í”„íŠ¸ ìƒì„±(í…ŒìŠ¤íŠ¸)
  const payload = {
    topic: selectedTopic,
    category: selectedCat,
    blog: document.getElementById("blogSelect").value || "local",
    textProvider: s.text_provider || "gemini"
  };

  try{
    const res = await fetch(backend + "/api/generate", {
      method:"POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify(payload)
    });

    if(!res.ok){
      const t = await res.text();
      alert("ìƒì„± ì‹¤íŒ¨: " + t);
      return;
    }
    const data = await res.json();
    openModal(data);
  }catch(e){
    alert("ì„œë²„ ì—°ê²° ì‹¤íŒ¨!\n\në¡œì»¬ì—ì„œ server.pyë¥¼ ì¼œê³  ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.");
  }
}

function openModal(data){
  document.getElementById("outTitle").textContent = data.title || "-";
  document.getElementById("outMeta").innerHTML =
    `ì£¼ì œ: <span class="ok">${escapeHtml(data.topic||"")}</span> / ì¹´í…Œê³ ë¦¬: ${escapeHtml(data.category||"")} / ì‹œê°„: ${escapeHtml(data.generated_at||"")}`;
  document.getElementById("outImage").value = data.image_prompt || "";
  document.getElementById("outBody").value = data.body_prompt || "";
  document.getElementById("modalBg").style.display="block";
}
function closeModal(){ document.getElementById("modalBg").style.display="none"; }

function escapeHtml(s){
  return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
}
function escapeAttr(s){
  return String(s).replaceAll("\\","\\\\").replaceAll("'","\\'");
}

renderList();
</script>
</body>
</html>
