<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BaseOne</title>
<style>
  body{margin:0;font-family:sans-serif;background:#0b1020;color:#eef2ff}
  .top{display:flex;justify-content:space-between;align-items:center;padding:16px;gap:10px;flex-wrap:wrap}
  .btn{padding:10px 14px;border-radius:10px;border:1px solid #444;background:#1f2a44;color:white;font-weight:bold;cursor:pointer}
  .btn.blue{background:#4f8cff;border:none}
  .btn.gray{background:#555;border:none}
  .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;padding:16px}
  @media(max-width:900px){.grid{grid-template-columns:repeat(2,1fr)}}
  .cat{background:#1b2238;padding:12px;border-radius:14px;cursor:pointer}
  .box{background:#141a30;margin:16px;padding:14px;border-radius:14px}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:space-between}
  .card{background:#1b2238;padding:10px;border-radius:10px;margin-bottom:8px;display:flex;justify-content:space-between;gap:10px;align-items:center}
  .small{font-size:13px;color:#cfd6ff}
  input{padding:10px;border-radius:10px;border:1px solid #444;background:#0f1530;color:white;min-width:200px}
  .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:#0f1530;border:1px solid rgba(255,255,255,.12);color:#cfd6ff;font-size:12px}
  .modalBg{display:none; position:fixed; inset:0; background:rgba(0,0,0,.6); padding:18px;}
  .modal{max-width:860px;margin:40px auto;background:#141a30;border:1px solid rgba(255,255,255,.12);border-radius:18px;padding:14px}
  textarea{width:100%;min-height:220px;background:#0f1530;border:1px solid #444;border-radius:12px;color:white;padding:10px}
</style>
</head>
<body>

<div class="top">
  <div style="font-size:24px;font-weight:bold">BaseOne <span class="pill">ë¡œì»¬ ìë™í™” ë‹¨ê³„</span></div>
  <div style="display:flex;gap:10px;flex-wrap:wrap">
    <button class="btn blue" onclick="makeMoney()">ğŸ’° ìˆ˜ìµí˜•ê¸€</button>
    <a href="/settings"><button class="btn">ì„¤ì •</button></a>
  </div>
</div>

<div class="box">
  <div class="row">
    <div>
      <b id="titleBox">ì£¼ì œ ëª©ë¡</b>
      <div class="small" id="selInfo">ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
    </div>
    <div style="display:flex;gap:10px;flex-wrap:wrap">
      <input id="filter" placeholder="ì£¼ì œ ê²€ìƒ‰(í•„í„°)" oninput="render()">
      <button class="btn" onclick="copyAll()">ì „ì²´ë³µì‚¬</button>
      <button class="btn blue" onclick="aiGenerateSelected()">âœ¨ AI ê¸€ ìƒì„±(ì„ íƒ ì£¼ì œ)</button>
    </div>
  </div>
</div>

<div class="grid" id="catGrid"></div>

<div class="box">
  <div class="row">
    <div class="small">ì£¼ì œ ì¹´ë“œì—ì„œ <b>ì„ íƒ</b> í›„, ìƒë‹¨ì˜ <b>AI ê¸€ ìƒì„±</b>ì„ ëˆ„ë¥´ì„¸ìš”.</div>
    <div class="small">ì„œë²„: <b>http://127.0.0.1:5000</b> (ì„œë²„ ì¼œì ¸ ìˆì–´ì•¼ í•¨)</div>
  </div>
  <div id="topics"></div>
</div>

<!-- ê²°ê³¼ ëª¨ë‹¬ -->
<div class="modalBg" id="modalBg">
  <div class="modal">
    <div class="row" style="justify-content:space-between">
      <b>AI ìƒì„± ê²°ê³¼</b>
      <button class="btn gray" onclick="closeModal()">ë‹«ê¸°</button>
    </div>

    <div class="box" style="margin:12px 0">
      <div class="row">
        <div class="small">ì œëª©</div>
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <button class="btn" onclick="copyText(document.getElementById('outTitle').textContent)">ì œëª© ë³µì‚¬</button>
          <button class="btn" onclick="copyText(document.getElementById('outImage').value)">ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ ë³µì‚¬</button>
          <button class="btn blue" onclick="copyText(document.getElementById('outBody').value)">ë³¸ë¬¸ í”„ë¡¬í”„íŠ¸ ë³µì‚¬</button>
        </div>
      </div>
      <div style="margin-top:6px;font-weight:bold" id="outTitle">-</div>
      <div class="small" id="outMeta" style="margin-top:6px">-</div>
    </div>

    <div class="box" style="margin:12px 0">
      <div class="small"><b>ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸</b> (Gemini/WISK/Pexels ì—°ê²°ì€ ë‹¤ìŒ ë‹¨ê³„ì—ì„œ)</div>
      <textarea id="outImage"></textarea>
    </div>

    <div class="box" style="margin:12px 0">
      <div class="small"><b>ë³¸ë¬¸ í”„ë¡¬í”„íŠ¸</b> (ë‹¤ìŒ ë‹¨ê³„ì—ì„œ Geminiê°€ â€œì‹¤ì œ ê¸€â€ì„ ìƒì„±í•˜ë„ë¡ ë°”ê¿€ ê±°ì•¼)</div>
      <textarea id="outBody"></textarea>
    </div>
  </div>
</div>

<script>
  const CATS=["ê±´ê°•","ì»´í“¨í„°/IT","ìë™ì°¨","ìƒí™œ/ê°€ì „","ìœ¡ì•„","ëˆ/ì¬í…Œí¬","ì—¬í–‰","ìš”ë¦¬","ìê¸°ê³„ë°œ","ê³µë¶€/ìê²©ì¦","ë°˜ë ¤ë™ë¬¼","íŒ¨ì…˜/ë·°í‹°","ì·¨ë¯¸","ìŠ¤í¬ì¸ ","ê²Œì„","ì˜í™”/ë“œë¼ë§ˆ"];
  let topics=[];
  let selectedTopic = "";
  let selectedCat = "";

  const grid=document.getElementById("catGrid");
  CATS.forEach(c=>{
    const d=document.createElement("div");
    d.className="cat";
    d.textContent=c;
    d.onclick=()=>makeTopics(c);
    grid.appendChild(d);
  });

  function makeTopics(cat){
    selectedCat = cat;
    topics=[];
    for(let i=1;i<=50;i++){
      topics.push(`${cat} ê¸€ ì•„ì´ë””ì–´ ${i}`); // âœ… ìš”ì²­ëŒ€ë¡œ ë³€ê²½
    }
    document.getElementById("titleBox").textContent=`${cat} ì£¼ì œ 50ê°œ`;
    selectedTopic = topics[0] || "";
    updateSel();
    render();
  }

  function makeMoney(){
    topics=[];
    selectedCat = "ìˆ˜ìµí˜•";
    const base=["ë³´í—˜","ì¹´ë“œ","í†µì‹ ë¹„","ì „ê¸°ìš”ê¸ˆ","ëŒ€ì¶œ","ë¶€ì—…","ì„¸ê¸ˆ","ì—°ê¸ˆ","ë‹¤ì´ì–´íŠ¸","ì˜ì–‘ì œ","ê°€ì „","ìœ¡ì•„í…œ","ìë™ì°¨","ì—¬í–‰","ìê²©ì¦","ë…¸íŠ¸ë¶","ì²­ì†Œ","ìƒí™œíŒ"];
    for(let i=1;i<=100;i++){
      topics.push(`ìˆ˜ìµí˜• ì£¼ì œ ${i}: ${base[i%base.length]}`);
    }
    document.getElementById("titleBox").textContent="ğŸ’° ìˆ˜ìµí˜• ê¸€ 100ê°œ";
    selectedTopic = topics[0] || "";
    updateSel();
    render();
  }

  function updateSel(){
    document.getElementById("selInfo").textContent = `ì„ íƒ ì£¼ì œ: ${selectedTopic ? selectedTopic : "-"}`
  }

  function render(){
    const q=(document.getElementById("filter").value||"").trim().toLowerCase();
    const list=document.getElementById("topics");
    list.innerHTML="";
    const filtered = q ? topics.filter(t=>t.toLowerCase().includes(q)) : topics;

    filtered.forEach(t=>{
      const d=document.createElement("div");
      d.className="card";
      d.innerHTML = `
        <div style="flex:1">
          <div>${escapeHtml(t)}</div>
          <div class="small">${selectedCat || ""}</div>
        </div>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn" onclick="setSelected('${escapeAttr(t)}')">ì„ íƒ</button>
          <button class="btn" onclick="copyText('${escapeAttr(t)}')">ë³µì‚¬</button>
        </div>
      `;
      list.appendChild(d);
    });
  }

  function setSelected(t){
    selectedTopic = t;
    updateSel();
    alert("ì„ íƒë¨: " + t);
  }

  function copyText(t){
    navigator.clipboard.writeText(t);
    alert("ë³µì‚¬ ì™„ë£Œ!");
  }

  function copyAll(){
    if(!topics.length){alert("ì£¼ì œ ì—†ìŒ");return;}
    navigator.clipboard.writeText(topics.join("\n"));
    alert("ì „ì²´ ë³µì‚¬ ì™„ë£Œ!");
  }

  async function aiGenerateSelected(){
    if(!selectedTopic){ alert("ë¨¼ì € ì£¼ì œë¥¼ ì„ íƒí•˜ì„¸ìš”!"); return; }

    // settingsì—ì„œ ì €ì¥í•œ ê°’ ì½ê¸°
    const s = JSON.parse(localStorage.getItem("baseone_settings_v2") || "{}");
    const textProvider = s.textProvider || "gemini";

    // ì§€ê¸ˆ ë‹¨ê³„ëŠ” â€œAPI ì—°ê²° í™•ì¸ìš©â€
    // (ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì—¬ê¸°ì„œ Gemini ì‹¤ì œ í˜¸ì¶œë¡œ ë°”ê¿€ ê±°ì•¼)
    const payload = {
      topic: selectedTopic,
      category: selectedCat,
      blog: "local",
      textProvider: textProvider
    };

    try{
      const res = await fetch("http://127.0.0.1:5000/api/generate", {
        method:"POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(payload)
      });

      if(!res.ok){
        const t = await res.text();
        alert("ìƒì„± ì‹¤íŒ¨: " + t);
        return;
      }

      const data = await res.json();
      openModal(data);

    }catch(e){
      alert("ì„œë²„ ì—°ê²° ì‹¤íŒ¨! ì„œë²„ê°€ ì¼œì ¸ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.\n\n(ì„œë²„ ì‹¤í–‰: python server.py)");
    }
  }

  function openModal(data){
    document.getElementById("outTitle").textContent = data.title || "-";
    document.getElementById("outMeta").textContent = `ì£¼ì œ: ${data.topic || ""} / ì¹´í…Œê³ ë¦¬: ${data.category || ""} / ìƒì„±ì‹œê°„: ${data.generated_at || ""}`;
    document.getElementById("outImage").value = data.image_prompt || "";
    document.getElementById("outBody").value = data.body_prompt || "";
    document.getElementById("modalBg").style.display="block";
  }

  function closeModal(){
    document.getElementById("modalBg").style.display="none";
  }

  function escapeHtml(s){
    return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
  }
  function escapeAttr(s){
    return String(s).replaceAll("\\","\\\\").replaceAll("'","\\'");
  }

  // ìµœì´ˆ ë Œë”
  render();
</script>
</body>
</html>
