<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<title>BaseOne</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Noto Sans KR",sans-serif;background:#0f172a;color:#e5e7eb}
.wrap{max-width:1100px;margin:0 auto;padding:20px}
h1{font-size:24px}
.box{background:#111827;border-radius:14px;padding:16px;margin-bottom:16px}
button{background:#2563eb;color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer}
button.gray{background:#374151}
select,input,textarea{width:100%;padding:10px;border-radius:8px;border:none;margin-top:6px;background:#1f2933;color:#fff}
.row{display:flex;gap:12px;flex-wrap:wrap}
.col{flex:1}
.small{opacity:.7;font-size:13px}
pre{white-space:pre-wrap}
</style>
</head>
<body>

<div class="wrap">
  <h1>ğŸš€ BaseOne ìë™ ê¸€ ë°œí–‰</h1>

  <div class="box">
    <b>1ï¸âƒ£ Blogger OAuth</b><br><br>
    <button onclick="oauth()">ğŸ” Google OAuth ì—°ê²°</button>
    <div id="oauthStatus" class="small"></div>
  </div>

  <div class="box">
    <b>2ï¸âƒ£ ë‚´ ë¸”ë¡œê·¸ ì„ íƒ</b>
    <button class="gray" onclick="loadBlogs()">ğŸ“¥ ë¸”ë¡œê·¸ ë¶ˆëŸ¬ì˜¤ê¸°</button>
    <select id="blogSelect"></select>
  </div>

  <div class="box">
    <b>3ï¸âƒ£ ê¸€ ì£¼ì œ</b>
    <input id="topic" placeholder="ì˜ˆ: ìë™ì°¨ ë³´í—˜ ì‹¸ê²Œ ê°€ì…í•˜ëŠ” ë°©ë²•">
    <input id="category" placeholder="ì¹´í…Œê³ ë¦¬ (ì˜ˆ: ë³´í—˜)" value="ì •ë³´">
  </div>

  <div class="box">
    <b>4ï¸âƒ£ ê¸€ ìƒì„± (Gemini)</b><br><br>
    <button onclick="generate()">âœï¸ ê¸€ + ì´ë¯¸ì§€ ìƒì„±</button>
    <div id="genStatus" class="small"></div>
    <pre id="preview"></pre>
  </div>

  <div class="box">
    <b>5ï¸âƒ£ ì¦‰ì‹œ ë°œí–‰</b><br><br>
    <button onclick="publish()">ğŸš€ ë¸”ë¡œê·¸ ë°œí–‰</button>
    <div id="pubStatus" class="small"></div>
  </div>
</div>

<script>
const API = location.origin;
let GENERATED_HTML = "";

function oauth(){
  window.open(API + "/oauth/start","_blank");
}

async function checkOAuth(){
  const r = await fetch(API + "/api/oauth/status");
  const j = await r.json();
  document.getElementById("oauthStatus").innerText =
    j.connected ? "âœ… OAuth ì—°ê²°ë¨" : "âŒ OAuth ë¯¸ì—°ê²°";
}
checkOAuth();

async function loadBlogs(){
  const r = await fetch(API + "/api/blogger/blogs");
  const j = await r.json();
  const sel = document.getElementById("blogSelect");
  sel.innerHTML = "";
  j.items.forEach(b=>{
    const o=document.createElement("option");
    o.value=b.id;
    o.textContent=b.name+" ("+b.url+")";
    sel.appendChild(o);
  });
}

async function generate(){
  document.getElementById("genStatus").innerText="â³ ìƒì„± ì¤‘...";
  const s = JSON.parse(localStorage.getItem("baseone_settings")||"{}");

  const r = await fetch(API+"/api/generate",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      topic:topic.value,
      category:category.value,
      gemini_key:s.gemini_key,
      pexels_key:s.pexels_key
    })
  });

  const j = await r.json();
  GENERATED_HTML = j.html;
  document.getElementById("preview").innerText = j.html.slice(0,2000)+"...";
  document.getElementById("genStatus").innerText="âœ… ìƒì„± ì™„ë£Œ";
}

async function publish(){
  const blog_id = blogSelect.value;
  const title = topic.value;

  document.getElementById("pubStatus").innerText="â³ ë°œí–‰ ì¤‘...";

  const r = await fetch(API+"/api/blogger/post",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      blog_id,
      title,
      html:GENERATED_HTML
    })
  });

  const j = await r.json();
  document.getElementById("pubStatus").innerHTML =
    j.ok ? `âœ… ë°œí–‰ ì™„ë£Œ<br><a href="${j.url}" target="_blank">${j.url}</a>`
         : "âŒ ë°œí–‰ ì‹¤íŒ¨";
}
</script>

</body>
</html>
