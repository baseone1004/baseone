<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BaseOne</title>
<style>
  body{margin:0;font-family:'Pretendard',-apple-system,sans-serif;background:#0a0e27;color:#e8eaf6;min-height:100vh}
  .wrap{max-width:1200px;margin:0 auto;padding:20px}
  
  /* í—¤ë” */
  .top{
    background:rgba(30,35,60,.7);
    backdrop-filter:blur(10px);
    border-radius:20px;
    padding:20px 24px;
    margin-bottom:20px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:16px;
    flex-wrap:wrap;
    box-shadow:0 8px 32px rgba(0,0,0,.3);
    border:1px solid rgba(255,255,255,.08)
  }
  
  .logo{
    width:48px;height:48px;
    border-radius:14px;
    background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display:flex;align-items:center;justify-content:center;
    font-weight:900;font-size:24px;
    box-shadow:0 4px 12px rgba(102,126,234,.4)
  }
  
  .title{font-size:28px;font-weight:900;line-height:1.2;margin-bottom:4px}
  .subtitle{font-size:13px;opacity:.7;font-weight:500}
  
  .btn{
    padding:10px 18px;
    border-radius:12px;
    border:none;
    background:rgba(255,255,255,.1);
    color:#e8eaf6;
    font-weight:700;
    cursor:pointer;
    transition:all .3s;
    font-size:14px;
    backdrop-filter:blur(10px);
    border:1px solid rgba(255,255,255,.1)
  }
  .btn:hover{background:rgba(255,255,255,.15);transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.2)}
  .btn.blue{background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);box-shadow:0 4px 12px rgba(102,126,234,.3);border:none}
  .btn.blue:hover{box-shadow:0 6px 20px rgba(102,126,234,.4)}
  .btn.gray{background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.06)}
  .btn.small{padding:8px 14px;font-size:13px}
  
  .pill{
    display:inline-block;
    padding:8px 16px;
    border-radius:999px;
    background:rgba(255,255,255,.08);
    backdrop-filter:blur(10px);
    font-size:13px;
    font-weight:600;
    border:1px solid rgba(255,255,255,.1)
  }
  
  /* ì¹´ë“œ ë°•ìŠ¤ */
  .box{
    background:rgba(30,35,60,.6);
    backdrop-filter:blur(10px);
    border-radius:20px;
    padding:24px;
    margin-bottom:20px;
    box-shadow:0 8px 32px rgba(0,0,0,.2);
    border:1px solid rgba(255,255,255,.08)
  }
  
  .box-title{font-size:20px;font-weight:900;margin-bottom:8px}
  .box-subtitle{font-size:13px;opacity:.7;font-weight:500}
  
  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap;justify-content:space-between}
  
  input, select, textarea{
    padding:12px 16px;
    border-radius:12px;
    border:1px solid rgba(255,255,255,.15);
    background:rgba(255,255,255,.05);
    backdrop-filter:blur(10px);
    color:#e8eaf6;
    min-width:200px;
    font-size:14px;
    transition:all .3s
  }
  input:focus, select:focus, textarea:focus{
    outline:none;
    border-color:rgba(102,126,234,.6);
    background:rgba(255,255,255,.08)
  }
  input::placeholder{color:rgba(255,255,255,.4)}
  
  /* ì¹´í…Œê³ ë¦¬ ê·¸ë¦¬ë“œ */
  .grid{
    display:grid;
    grid-template-columns:repeat(auto-fill, minmax(160px, 1fr));
    gap:12px;
    margin-top:16px
  }
  
  .cat{
    background:rgba(255,255,255,.05);
    backdrop-filter:blur(10px);
    border:1px solid rgba(255,255,255,.1);
    padding:16px;
    border-radius:16px;
    cursor:pointer;
    transition:all .3s;
    text-align:center;
    position:relative;
    overflow:hidden
  }
  .cat:hover{
    background:rgba(255,255,255,.1);
    transform:translateY(-4px);
    box-shadow:0 8px 24px rgba(0,0,0,.2);
    border-color:rgba(102,126,234,.4)
  }
  .cat b{font-size:16px;display:block;margin-bottom:6px}
  .cat .small{font-size:12px;opacity:.7}
  .badge{
    position:absolute;
    top:8px;right:8px;
    font-size:11px;
    background:rgba(102,126,234,.3);
    padding:4px 10px;
    border-radius:999px;
    font-weight:700
  }
  
  .small{font-size:13px;opacity:.8}
  
  /* ì£¼ì œ ì¹´ë“œ */
  .card{
    background:rgba(255,255,255,.05);
    backdrop-filter:blur(10px);
    border:1px solid rgba(255,255,255,.1);
    padding:14px 18px;
    border-radius:14px;
    margin-bottom:10px;
    display:flex;
    justify-content:space-between;
    gap:12px;
    align-items:center;
    transition:all .3s
  }
  .card:hover{background:rgba(255,255,255,.08);border-color:rgba(102,126,234,.3)}
  
  .topicScroll{
    max-height:320px;
    overflow-y:auto;
    padding-right:8px;
    margin-top:12px
  }
  .topicScroll::-webkit-scrollbar{width:8px}
  .topicScroll::-webkit-scrollbar-thumb{background:rgba(102,126,234,.4);border-radius:10px}
  .topicScroll::-webkit-scrollbar-track{background:rgba(255,255,255,.05);border-radius:10px}
  
  /* ëª¨ë‹¬ */
  .modalBg{
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.85);
    padding:20px;
    z-index:9999;
    backdrop-filter:blur(8px)
  }
  .modal{
    max-width:900px;
    max-height:90vh;
    overflow-y:auto;
    margin:40px auto;
    background:rgba(20,25,45,.98);
    backdrop-filter:blur(20px);
    border-radius:24px;
    padding:28px;
    color:#e8eaf6;
    box-shadow:0 20px 60px rgba(0,0,0,.5);
    border:1px solid rgba(255,255,255,.1)
  }
  .modal textarea{
    width:100%;
    min-height:200px;
    background:rgba(255,255,255,.05);
    border:1px solid rgba(255,255,255,.15);
    color:#e8eaf6;
    padding:14px;
    border-radius:12px;
    font-size:14px;
    line-height:1.6
  }
  
  /* ë°œí–‰ ìš”ì²­ ë¦¬ìŠ¤íŠ¸ */
  .reqCard{
    background:rgba(255,255,255,.05);
    backdrop-filter:blur(10px);
    border:1px solid rgba(255,255,255,.1);
    border-radius:14px;
    padding:14px 18px;
    margin-top:10px;
    transition:all .3s
  }
  .reqCard:hover{background:rgba(255,255,255,.08);border-color:rgba(102,126,234,.3)}
  .reqTop{display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;align-items:center}
  .reqTitle{font-weight:900;font-size:15px}
  .reqMeta{font-size:12px;opacity:.8;margin-top:8px;line-height:1.6}
  .reqBadge{
    font-size:11px;
    background:rgba(102,126,234,.3);
    padding:4px 10px;
    border-radius:999px;
    font-weight:700
  }
  
  /* ë¡œê·¸ ë°•ìŠ¤ */
  #genBox{
    background:rgba(20,25,45,.8);
    backdrop-filter:blur(10px);
    border:1px solid rgba(255,255,255,.1)
  }
  #genLog{
    background:rgba(0,0,0,.3);
    border:1px solid rgba(255,255,255,.1);
    border-radius:12px;
    padding:14px;
    max-height:220px;
    overflow:auto;
    font-size:13px;
    line-height:1.7;
    font-family:monospace;
    margin-top:12px
  }
  
  /* í”„ë¡¬í”„íŠ¸ ë°•ìŠ¤ */
  .prompt-box{
    background:rgba(255,255,255,.05);
    backdrop-filter:blur(10px);
    border-radius:16px;
    padding:20px;
    margin-bottom:16px;
    border:1px solid rgba(255,255,255,.1)
  }
  .prompt-box-title{
    font-size:16px;
    font-weight:800;
    margin-bottom:12px;
    color:#a5b4fc
  }
  
  @media(max-width:768px){
    .grid{grid-template-columns:repeat(2, 1fr)}
    .top{padding:16px}
    .title{font-size:24px}
  }
</style>
</head>
<body>
<div class="wrap">

  <!-- í—¤ë” -->
  <div class="top">
    <div style="display:flex;align-items:center;gap:14px">
      <div class="logo">B</div>
      <div>
        <div class="title">BaseOne</div>
        <div class="subtitle">AI ë¸”ë¡œê·¸ ìë™í™” ì‹œìŠ¤í…œ</div>
      </div>
    </div>
    <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
      <span class="pill">ğŸ–¥ï¸ <b id="sv">-</b></span>
      <a href="/settings"><button class="btn">âš™ï¸ ì„¤ì •</button></a>
    </div>
  </div>

  <!-- ë¸”ë¡œê·¸ ì„ íƒ -->
  <div class="box">
    <div class="box-title">ğŸ“ ë¸”ë¡œê·¸ ì„ íƒ</div>
    <div class="box-subtitle">ì„¤ì •ì—ì„œ ì €ì¥í•œ ë¸”ë¡œê·¸ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
    <div class="row" style="margin-top:16px">
      <select id="blogSelect" style="flex:1;min-width:300px"></select>
      <button class="btn small" onclick="loadBlogsToSelect()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
    </div>
    <div class="small" style="margin-top:12px;padding:10px;background:rgba(255,255,255,.05);border-radius:10px;border:1px solid rgba(255,255,255,.08)">
      í˜„ì¬ ì„ íƒ: <b id="blogNow">-</b>
    </div>
  </div>

  <!-- ì¹´í…Œê³ ë¦¬ ì„ íƒ -->
  <div class="box">
    <div class="row">
      <div>
        <div class="box-title">ğŸ¯ ì¹´í…Œê³ ë¦¬</div>
        <div class="box-subtitle">ì£¼ì œë¥¼ ìƒì„±í•  ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
      </div>
      <button class="btn blue" onclick="makeMoney()">ğŸ’° ìˆ˜ìµí˜• 100ê°œ</button>
    </div>
    <div class="grid" id="catGrid"></div>
  </div>

  <!-- ë„¤ì´ë²„ í”„ë¡¬í”„íŠ¸ -->
  <div class="box">
    <div class="box-title">ğŸ“‹ ë„¤ì´ë²„ ë¸”ë¡œê·¸ í”„ë¡¬í”„íŠ¸</div>
    <div class="box-subtitle">ë„¤ì´ë²„ ë¸”ë¡œê·¸ ì „ìš© ê¸€ì‘ì„± í”„ë¡¬í”„íŠ¸ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤</div>
    
    <div class="prompt-box">
      <textarea id="promptNaver" placeholder="ë„¤ì´ë²„ ë¸”ë¡œê·¸ í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." style="min-height:180px"></textarea>
      <div style="display:flex;gap:8px;margin-top:10px">
        <button class="btn small blue" onclick="savePrompt('naver')">ğŸ’¾ ì €ì¥</button>
        <button class="btn small gray" onclick="resetPrompt('naver')">ğŸ”„ ê¸°ë³¸ê°’ìœ¼ë¡œ</button>
      </div>
    </div>
  </div>

  <!-- í‹°ìŠ¤í† ë¦¬ í”„ë¡¬í”„íŠ¸ -->
  <div class="box">
    <div class="box-title">ğŸ“‹ í‹°ìŠ¤í† ë¦¬ í”„ë¡¬í”„íŠ¸</div>
    <div class="box-subtitle">í‹°ìŠ¤í† ë¦¬ ì „ìš© ê¸€ì‘ì„± í”„ë¡¬í”„íŠ¸ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤</div>
    
    <div class="prompt-box">
      <textarea id="promptTistory" placeholder="í‹°ìŠ¤í† ë¦¬ í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." style="min-height:180px"></textarea>
      <div style="display:flex;gap:8px;margin-top:10px">
        <button class="btn small blue" onclick="savePrompt('tistory')">ğŸ’¾ ì €ì¥</button>
        <button class="btn small gray" onclick="resetPrompt('tistory')">ğŸ”„ ê¸°ë³¸ê°’ìœ¼ë¡œ</button>
      </div>
    </div>
  </div>

  <!-- ë¸”ë¡œê·¸ìŠ¤íŒŸ í”„ë¡¬í”„íŠ¸ -->
  <div class="box">
    <div class="box-title">ğŸ“‹ ë¸”ë¡œê·¸ìŠ¤íŒŸ í”„ë¡¬í”„íŠ¸</div>
    <div class="box-subtitle">ë¸”ë¡œê·¸ìŠ¤íŒŸ ì „ìš© ê¸€ì‘ì„± í”„ë¡¬í”„íŠ¸ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤</div>
    
    <div class="prompt-box">
      <textarea id="promptBlogspot" placeholder="ë¸”ë¡œê·¸ìŠ¤íŒŸ í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." style="min-height:180px"></textarea>
      <div style="display:flex;gap:8px;margin-top:10px">
        <button class="btn small blue" onclick="savePrompt('blogspot')">ğŸ’¾ ì €ì¥</button>
        <button class="btn small gray" onclick="resetPrompt('blogspot')">ğŸ”„ ê¸°ë³¸ê°’ìœ¼ë¡œ</button>
      </div>
    </div>
  </div>

  <!-- ì£¼ì œ ëª©ë¡ -->
  <div class="box">
    <div class="row">
      <div>
        <div class="box-title">ğŸ“š ì£¼ì œ ëª©ë¡</div>
        <div class="box-subtitle" id="selInfo">ì„ íƒ ì£¼ì œ: -</div>
      </div>
      <input id="filter" placeholder="ğŸ” ì£¼ì œ ê²€ìƒ‰..." oninput="render()" style="min-width:200px">
    </div>
    
    <div class="topicScroll" id="topics"></div>
    
    <!-- ê¸€ì‘ì„± ì‹œì‘ ë²„íŠ¼ -->
    <div style="margin-top:16px;display:flex;gap:10px;flex-wrap:wrap;justify-content:center">
      <button class="btn blue" onclick="startWriting()" style="padding:14px 32px;font-size:16px">âœï¸ ê¸€ì‘ì„± ì‹œì‘</button>
      <button class="btn" onclick="copyAll()">ğŸ“‹ ì „ì²´ ë³µì‚¬</button>
    </div>
  </div>

  <!-- ë¡œê·¸ -->
  <div class="box" id="genBox" style="display:none">
    <div class="row">
      <div class="box-title">ğŸ“Š ê¸€ì‘ì„± ì§„í–‰ìƒí™©</div>
      <div style="display:flex;gap:8px">
        <button class="btn small gray" onclick="clearGenLog()">ğŸ—‘ï¸ ì§€ìš°ê¸°</button>
        <button class="btn small" onclick="toggleGenBox()">ğŸ‘ï¸ ìˆ¨ê¸°ê¸°</button>
      </div>
    </div>
    <div id="genLog"></div>
  </div>

  <!-- ë°œí–‰ -->
  <div class="box">
    <div class="box-title">ğŸš€ ë°œí–‰ ê´€ë¦¬</div>
    <div class="box-subtitle">ì˜ˆì•½ ë˜ëŠ” ì¦‰ì‹œ ë°œí–‰ ìš”ì²­ì„ ì €ì¥í•©ë‹ˆë‹¤</div>
    
    <div style="display:flex;gap:10px;margin-top:16px;flex-wrap:wrap">
      <button class="btn blue" onclick="scheduleDaily3()">ğŸ“… í•˜ë£¨ 3ê°œ ì˜ˆì•½</button>
      
      <input id="startTime" type="time" value="09:00" style="min-width:130px">
      <select id="intervalHours" style="min-width:100px">
        <option value="1">1ì‹œê°„</option>
        <option value="2">2ì‹œê°„</option>
        <option value="3">3ì‹œê°„</option>
        <option value="4">4ì‹œê°„</option>
        <option value="5">5ì‹œê°„</option>
        <option value="6">6ì‹œê°„</option>
      </select>
      <button class="btn" onclick="publishNowInterval()">âš¡ ì¦‰ì‹œ ë°œí–‰</button>
    </div>

    <div class="row" style="margin-top:20px">
      <div class="box-title" style="font-size:18px">ğŸ“¦ ë°œí–‰ìš”ì²­ ë¦¬ìŠ¤íŠ¸</div>
      <div style="display:flex;gap:8px">
        <button class="btn small" onclick="loadPublishList()">ğŸ“¥ ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <button class="btn small gray" onclick="clearPublishList()">ğŸ—‘ï¸ ì§€ìš°ê¸°</button>
      </div>
    </div>
    <div id="publishList"></div>
  </div>

</div>

<!-- ê²°ê³¼ ëª¨ë‹¬ -->
<div class="modalBg" id="modalBg" onclick="if(event.target===this) closeModal()">
  <div class="modal">
    <div class="row" style="justify-content:space-between;margin-bottom:20px">
      <div style="font-size:24px;font-weight:900">âœ¨ AI ìƒì„± ê²°ê³¼</div>
      <button class="btn gray" onclick="closeModal()">âŒ ë‹«ê¸°</button>
    </div>

    <div style="background:rgba(102,126,234,.1);border-radius:16px;padding:18px;margin-bottom:16px;border:1px solid rgba(102,126,234,.2)">
      <div style="font-size:13px;opacity:.7;margin-bottom:8px">ì œëª©</div>
      <div style="font-weight:bold;font-size:18px" id="outTitle">-</div>
      <div style="font-size:12px;opacity:.6;margin-top:8px" id="outMeta">-</div>
      
      <div style="display:flex;gap:8px;margin-top:14px;flex-wrap:wrap">
        <button class="btn small" onclick="copyText(document.getElementById('outTitle').textContent)">ğŸ“‹ ì œëª©</button>
        <button class="btn small" onclick="copyText(document.getElementById('outImage').value)">ğŸ–¼ï¸ ì´ë¯¸ì§€</button>
        <button class="btn small blue" onclick="copyText(document.getElementById('outBody').value)">ğŸ“ ë³¸ë¬¸</button>
      </div>
    </div>

    <div style="margin-bottom:16px">
      <div style="font-size:14px;font-weight:700;margin-bottom:8px">ğŸ–¼ï¸ ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸</div>
      <textarea id="outImage"></textarea>
    </div>

    <div>
      <div style="font-size:14px;font-weight:700;margin-bottom:8px">ğŸ“ ë³¸ë¬¸ í”„ë¡¬í”„íŠ¸</div>
      <textarea id="outBody"></textarea>
    </div>
  </div>
</div>

<script>
  // =========================
  // ê¸°ë³¸ ì„¤ì •
  // =========================
  function getApiBase(){
    const d = JSON.parse(localStorage.getItem("baseone_settings_v3") || "{}");
    const base = (d.backend || "http://127.0.0.1:5000").trim();
    return base.replace(/\/+$/,"");
  }
  const API_BASE = getApiBase();

  document.addEventListener("DOMContentLoaded", ()=>{
    const el = document.getElementById("sv");
    if(el) el.textContent = API_BASE;
    loadPrompts();
  });

  function escapeHtml(s){
    return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
  }
  function escapeAttr(s){
    return String(s).replaceAll("\\","\\\\").replaceAll("'","\\'");
  }

  // =========================
  // í”„ë¡¬í”„íŠ¸ ê´€ë¦¬
  // =========================
  const DEFAULT_PROMPTS = {
    naver: `ë‹¹ì‹ ì€ ë„¤ì´ë²„ ê²€ìƒ‰ ìƒìœ„ ë…¸ì¶œ ì „ë¬¸ ë¸”ë¡œê·¸ ì‘ê°€ì…ë‹ˆë‹¤.

ã€ì£¼ì œã€‘: [ì£¼ì œ ì…ë ¥]
ã€ëª©í‘œ í‚¤ì›Œë“œã€‘: [ë©”ì¸ í‚¤ì›Œë“œ, ì—°ê´€ í‚¤ì›Œë“œ]

ã€ë„¤ì´ë²„ ë¸”ë¡œê·¸ ì‘ì„± ì›ì¹™ã€‘
1. êµ¬ì–´ì²´, ì¹œê·¼í•œ ë§íˆ¬ ì‚¬ìš©
2. ì´ëª¨ì§€ ì ì ˆíˆ í™œìš©
3. ì´ë¯¸ì§€ ìµœì†Œ 5ì¥ ì´ìƒ
4. í‚¤ì›Œë“œ ìì—°ìŠ¤ëŸ½ê²Œ ë°°ì¹˜
5. ë‚´ë¶€ ë§í¬ 2-3ê°œ í¬í•¨`,

    tistory: `ë‹¹ì‹ ì€ êµ¬ê¸€ SEOì™€ í‹°ìŠ¤í† ë¦¬ ìµœì í™” ì „ë¬¸ ì½˜í…ì¸  ì‘ê°€ì…ë‹ˆë‹¤.

ã€ì£¼ì œã€‘: [ì£¼ì œ ì…ë ¥]
ã€íƒ€ê²Ÿ í‚¤ì›Œë“œã€‘: [ë©”ì¸ í‚¤ì›Œë“œ, ë¡±í…Œì¼ í‚¤ì›Œë“œ]

ã€í‹°ìŠ¤í† ë¦¬ ì‘ì„± ì›ì¹™ã€‘
1. H1/H2 íƒœê·¸ êµ¬ì¡°í™”
2. ì •ë³´ ì „ë‹¬í˜• ì „ë¬¸ì  í†¤
3. ì™¸ë¶€ ê¶Œìœ„ ë§í¬ 2-3ê°œ
4. ëª©ì°¨(TOC) ì‚½ì…
5. ë©”íƒ€ ì„¤ëª… ìµœì í™”`,

    blogspot: `ë‹¹ì‹ ì€ ê¸€ë¡œë²Œ SEOì™€ ë¸”ë¡œê·¸ìŠ¤íŒŸ ìµœì í™” ì „ë¬¸ ì½˜í…ì¸  í¬ë¦¬ì—ì´í„°ì…ë‹ˆë‹¤.

ã€ì£¼ì œã€‘: [ì£¼ì œ ì…ë ¥]
ã€íƒ€ê²Ÿ ë…ìã€‘: [í•œêµ­ì¸ / ê¸€ë¡œë²Œ ë…ì]

ã€ë¸”ë¡œê·¸ìŠ¤íŒŸ ì‘ì„± ì›ì¹™ã€‘
1. ê¸€ë¡œë²Œ SEO êµ¬ì¡°
2. ê¹”ë”í•˜ê³  ëª…ë£Œí•œ ë¬¸ì¥
3. ì†Œì…œ ë¯¸ë””ì–´ ìµœì í™”
4. ëª¨ë°”ì¼ ê°€ë…ì„± ìš°ì„ 
5. ìŠ¤í‚¤ë§ˆ ë§ˆí¬ì—… ê³ ë ¤`
  };

  function loadPrompts(){
    const saved = JSON.parse(localStorage.getItem("baseone_prompts") || "{}");
    document.getElementById("promptNaver").value = saved.naver || DEFAULT_PROMPTS.naver;
    document.getElementById("promptTistory").value = saved.tistory || DEFAULT_PROMPTS.tistory;
    document.getElementById("promptBlogspot").value = saved.blogspot || DEFAULT_PROMPTS.blogspot;
  }

  function savePrompt(type){
    const saved = JSON.parse(localStorage.getItem("baseone_prompts") || "{}");
    const val = document.getElementById(`prompt${type.charAt(0).toUpperCase() + type.slice(1)}`).value;
    saved[type] = val;
    localStorage.setItem("baseone_prompts", JSON.stringify(saved));
    alert(`âœ… ${type} í”„ë¡¬í”„íŠ¸ ì €ì¥ ì™„ë£Œ!`);
  }

  function resetPrompt(type){
    if(!confirm("ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
    document.getElementById(`prompt${type.charAt(0).toUpperCase() + type.slice(1)}`).value = DEFAULT_PROMPTS[type];
    savePrompt(type);
  }

  // =========================
  // ë¡œê·¸
  // =========================
  function showGenBox(){
    const box = document.getElementById("genBox");
    if(box) box.style.display = "block";
  }
  function toggleGenBox(){
    const box = document.getElementById("genBox");
    if(!box) return;
    box.style.display = (box.style.display === "none" ? "block" : "none");
  }
  function addGenLine(icon, color, msg){
    showGenBox();
    const log = document.getElementById("genLog");
    if(!log) return;
    const t = new Date();
    const time = String(t.getHours()).padStart(2,"0")+":"+String(t.getMinutes()).padStart(2,"0")+":"+String(t.getSeconds()).padStart(2,"0");
    log.innerHTML += `<div style="color:${color}">${icon} <b>[${time}]</b> ${escapeHtml(msg)}</div>`;
    log.scrollTop = log.scrollHeight;
  }
  function addGenLog(msg){ addGenLine("ğŸŸ¦","#a5b4fc",msg); }
  function addGenOk(msg){ addGenLine("âœ…","#86efac",msg); }
  function addGenErr(msg){ addGenLine("âŒ","#fca5a5",msg); }
  function clearGenLog(){ const log=document.getElementById("genLog"); if(log) log.innerHTML=""; }

  function startWriting(){
    if(!selectedTopic){
      alert("ë¨¼ì € ì£¼ì œë¥¼ ì„ íƒí•˜ì„¸ìš”! ğŸ¯");
      return;
    }
    showGenBox();
    addGenLog("ê¸€ì‘ì„± ì‹œì‘ âœï¸");
    addGenLog("AI ìƒì„± ìš”ì²­ ì§„í–‰ì¤‘...");
    aiGenerateSelected();
  }

  // =========================
  // ì¹´í…Œê³ ë¦¬
  // =========================
  const CATS=[
    {k:"ê±´ê°•",s:"ìš´ë™Â·ì˜ì–‘"},
    {k:"IT",s:"ìœ í‹¸Â·ë³´ì•ˆ"},
    {k:"ìë™ì°¨",s:"ì •ë¹„Â·ë³´í—˜"},
    {k:"ìƒí™œ",s:"ì‚´ë¦¼Â·ê°€ì „"},
    {k:"ìœ¡ì•„",s:"ìœ¡ì•„í…œ"},
    {k:"ì¬í…Œí¬",s:"ì ˆì•½Â·íˆ¬ì"},
    {k:"ì—¬í–‰",s:"ì½”ìŠ¤Â·íŒ"},
    {k:"ìš”ë¦¬",s:"ë ˆì‹œí”¼"},
    {k:"ìê¸°ê³„ë°œ",s:"ìŠµê´€"},
    {k:"ìê²©ì¦",s:"ì‹œí—˜"},
    {k:"ë°˜ë ¤ë™ë¬¼",s:"ì¼€ì–´"},
    {k:"ë·°í‹°",s:"ê´€ë¦¬"},
    {k:"ì·¨ë¯¸",s:"DIY"},
    {k:"ìŠ¤í¬ì¸ ",s:"ìš´ë™"},
    {k:"ê²Œì„",s:"ë¦¬ë·°"},
    {k:"ì˜í™”",s:"ì¶”ì²œ"}
  ];

  let topics=[];
  let selectedTopic = "";
  let selectedCat = "";

  const grid=document.getElementById("catGrid");
  CATS.forEach(obj=>{
    const d=document.createElement("div");
    d.className="cat";
    d.onclick=()=>makeTopics(obj.k);
    d.innerHTML = `
      <span class="badge">50</span>
      <b>${obj.k}</b>
      <div class="small">${obj.s}</div>
    `;
    grid.appendChild(d);
  });

  // =========================
  // ë¸”ë¡œê·¸ ëª©ë¡
  // =========================
  function loadBlogsToSelect(){
    const sel = document.getElementById("blogSelect");
    const now = document.getElementById("blogNow");
    sel.innerHTML = "";

    const s = JSON.parse(localStorage.getItem("baseone_settings_v2") || "{}");
    const blogs = s.blogs || { blogspot:[], naver:[], tistory:[] };

    const options = [];
    (blogs.blogspot||[]).filter(Boolean).forEach((u,i)=> options.push({type:"blogspot", url:u, label:`ë¸”ë¡œê·¸ìŠ¤íŒŸ ${i+1} - ${u}`}));
    (blogs.naver||[]).filter(Boolean).forEach((u,i)=> options.push({type:"naver", url:u, label:`ë„¤ì´ë²„ ${i+1} - ${u}`}));
    (blogs.tistory||[]).filter(Boolean).forEach((u,i)=> options.push({type:"tistory", url:u, label:`í‹°ìŠ¤í† ë¦¬ ${i+1} - ${u}`}));

    if(options.length===0){
      const opt=document.createElement("option");
      opt.value="";
      opt.textContent="âš ï¸ ì„¤ì •ì—ì„œ ë¸”ë¡œê·¸ ì£¼ì†Œë¥¼ ì €ì¥í•˜ì„¸ìš”";
      sel.appendChild(opt);
      now.textContent = "-";
      return;
    }

    options.forEach(o=>{
      const opt=document.createElement("option");
      opt.value = JSON.stringify({type:o.type, url:o.url});
      opt.textContent = o.label;
      sel.appendChild(opt);
    });

    const last = localStorage.getItem("baseone_last_blog");
    if(last){
      for(let i=0;i<sel.options.length;i++){
        if(sel.options[i].value === last){
          sel.selectedIndex = i;
          break;
        }
      }
    }
    updateBlogNow();
  }

  function updateBlogNow(){
    const sel = document.getElementById("blogSelect");
    const now = document.getElementById("blogNow");
    const v = sel.value;
    if(!v){ now.textContent="-"; return; }
    localStorage.setItem("baseone_last_blog", v);
    try{
      const obj = JSON.parse(v);
      now.textContent = `${obj.type} / ${obj.url}`;
    }catch(e){
      now.textContent = "-";
    }
  }

  document.addEventListener("change",(e)=>{
    if(e.target && e.target.id==="blogSelect"){
      updateBlogNow();
    }
  });

  loadBlogsToSelect();

  // =========================
  // ì£¼ì œ ìƒì„±
  // =========================
  function makeTopics(cat){
    selectedCat = cat;
    topics=[];
    for(let i=1;i<=50;i++) topics.push(`${cat} ê¸€ ì•„ì´ë””ì–´ ${i}`);
    selectedTopic = topics[0] || "";
    updateSel();
    render();
  }

  function makeMoney(){
    topics=[];
    selectedCat = "ğŸ’° ìˆ˜ìµí˜•";
    const base=[
      "ë³´í—˜","ì¹´ë“œ","í†µì‹ ë¹„","ì „ê¸°ìš”ê¸ˆ","ê°€ìŠ¤ìš”ê¸ˆ","ë Œíƒˆ","ëŒ€ì¶œ","ì´ì","ì„¸ê¸ˆ","ì—°ê¸ˆ",
      "ë‹¤ì´ì–´íŠ¸","ì˜ì–‘ì œ","íƒˆëª¨","í”¼ë¶€","ê±´ê°•ê²€ì§„","ìœ¡ì•„í…œ","ê°€ì „","ì²­ì†Œ","ìë™ì°¨ë³´í—˜","ì¤‘ê³ ì°¨"
    ];
    for(let i=1;i<=100;i++) topics.push(`ğŸ’° ${base[i%base.length]} ìˆ˜ìµí˜• ì£¼ì œ ${i}`);
    selectedTopic = topics[0] || "";
    updateSel();
    render();
  }

  function updateSel(){
    document.getElementById("selInfo").textContent = `ì„ íƒ: ${selectedTopic ? selectedTopic : "ì—†ìŒ"}`;
  }

  function render(){
    const q=(document.getElementById("filter").value||"").trim().toLowerCase();
    const list=document.getElementById("topics");
    list.innerHTML="";
    const filtered = q ? topics.filter(t=>t.toLowerCase().includes(q)) : topics;

    if(filtered.length===0){
      list.innerHTML = `<div class="small" style="text-align:center;padding:40px;opacity:.6">ì£¼ì œê°€ ì—†ìŠµë‹ˆë‹¤ ğŸ¤·â€â™‚ï¸</div>`;
      return;
    }

    filtered.forEach(t=>{
      const d=document.createElement("div");
      d.className="card";
      d.innerHTML = `
        <div style="flex:1">
          <div style="font-weight:600">${escapeHtml(t)}</div>
          <div class="small" style="opacity:.7">${selectedCat || ""}</div>
        </div>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn small blue" onclick="setSelected('${escapeAttr(t)}')">ì„ íƒ</button>
          <button class="btn small" onclick="copyText('${escapeAttr(t)}')">ë³µì‚¬</button>
        </div>
      `;
      list.appendChild(d);
    });
  }

  function setSelected(t){ selectedTopic = t; updateSel(); }
  function copyText(t){ navigator.clipboard.writeText(t); alert("ğŸ“‹ ë³µì‚¬ ì™„ë£Œ!"); }
  function copyAll(){ 
    if(!topics.length){alert("ì£¼ì œê°€ ì—†ìŠµë‹ˆë‹¤!");return;} 
    navigator.clipboard.writeText(topics.join("\n")); 
    alert("ğŸ“‹ ì „ì²´ ë³µì‚¬ ì™„ë£Œ!"); 
  }

  // =========================
  // AI ìƒì„±
  // =========================
  async function aiGenerateSelected(){
    if(!selectedTopic){ alert("ë¨¼ì € ì£¼ì œë¥¼ ì„ íƒí•˜ì„¸ìš”! ğŸ¯"); return; }

    const blog = getSelectedBlog();
    let promptType = "naver";
    if(blog && blog.type){
      promptType = blog.type;
    }

    const prompts = JSON.parse(localStorage.getItem("baseone_prompts") || "{}");
    const selectedPrompt = prompts[promptType] || DEFAULT_PROMPTS[promptType];

    addGenLog(`ì„œë²„: ${API_BASE}`);
    addGenLog(`ì£¼ì œ: ${selectedTopic}`);
    addGenLog(`ì¹´í…Œê³ ë¦¬: ${selectedCat || "-"}`);
    addGenLog(`ì‚¬ìš© í”„ë¡¬í”„íŠ¸: ${promptType}`);

    const s = JSON.parse(localStorage.getItem("baseone_settings_v2") || "{}");
    const payload = {
      topic: selectedTopic,
      category: selectedCat,
      blog: "local",
      img_provider: (s.imgProvider || "pexels"),
      pexels_key: (s.pexelsKey || ""),
      custom_prompt: selectedPrompt
    };

    addGenLog("AI ìƒì„± ìš”ì²­ ì¤‘...");

    try{
      const res = await fetch(API_BASE + "/api/generate", {
        method:"POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(payload)
      });

      if(!res.ok){
        const t = await res.text();
        addGenErr("AI ìƒì„± ì‹¤íŒ¨: " + t);
        alert("âŒ ìƒì„± ì‹¤íŒ¨: " + t);
        return;
      }

      addGenLog("ì‘ë‹µ ìˆ˜ì‹  ì¤‘...");
      const data = await res.json();

      if(data.image_url){
        addGenOk("ì´ë¯¸ì§€ URL ì°¾ìŒ âœ…");
        addGenLog(data.image_url);
      }else{
        addGenLog("ì´ë¯¸ì§€ URL ì—†ìŒ");
      }

      addGenOk("í”„ë¡¬í”„íŠ¸ ìƒì„± ì™„ë£Œ âœ¨");
      openModal(data);

    }catch(e){
      addGenErr("ì„œë²„ ì—°ê²° ì‹¤íŒ¨");
      alert("âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨! ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.");
    }
  }

  function openModal(data){
    document.getElementById("outTitle").textContent = data.title || "-";
    document.getElementById("outMeta").textContent = `ğŸ“Œ ${data.topic || ""} | ğŸ·ï¸ ${data.category || ""} | ğŸ• ${data.generated_at || ""}`;
    document.getElementById("outImage").value = (data.image_url ? `ğŸ–¼ï¸ ì´ë¯¸ì§€ URL: ${data.image_url}\n\n` : "") + (data.image_prompt || "");
    document.getElementById("outBody").value = data.body_prompt || "";
    document.getElementById("modalBg").style.display="block";
  }
  function closeModal(){ document.getElementById("modalBg").style.display="none"; }

  // =========================
  // ë°œí–‰ ìš”ì²­
  // =========================
  function getSelectedBlog(){
    const v = document.getElementById("blogSelect").value;
    if(!v) return null;
    try{ return JSON.parse(v); }catch(e){ return null; }
  }

  async function scheduleDaily3(){
    const blog = getSelectedBlog();
    if(!blog){ alert("âš ï¸ ë¸”ë¡œê·¸ë¥¼ ì„ íƒí•˜ì„¸ìš”!"); return; }
    if(!selectedTopic){ alert("âš ï¸ ì£¼ì œë¥¼ ì„ íƒí•˜ì„¸ìš”!"); return; }

    const payload = {
      blog_type: blog.type,
      blog_url: blog.url,
      category: selectedCat,
      topic: selectedTopic,
      schedule_times: ["08:00","13:00","18:00"]
    };

    try{
      const res = await fetch(API_BASE + "/api/publish/schedule",{
        method:"POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      if(!data.ok){ alert("âŒ " + (data.error || "ì‹¤íŒ¨")); return; }
      alert("âœ… " + (data.message || "ì €ì¥ ì™„ë£Œ"));
      loadPublishList();
    }catch(e){
      alert("âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨!");
    }
  }

  async function publishNowInterval(){
    const blog = getSelectedBlog();
    if(!blog){ alert("âš ï¸ ë¸”ë¡œê·¸ë¥¼ ì„ íƒí•˜ì„¸ìš”!"); return; }
    if(!selectedTopic){ alert("âš ï¸ ì£¼ì œë¥¼ ì„ íƒí•˜ì„¸ìš”!"); return; }

    const start_time = document.getElementById("startTime").value;
    const interval_hours = document.getElementById("intervalHours").value;

    const payload = {
      blog_type: blog.type,
      blog_url: blog.url,
      category: selectedCat,
      topic: selectedTopic,
      start_time,
      interval_hours
    };

    try{
      const res = await fetch(API_BASE + "/api/publish/now",{
        method:"POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      if(!data.ok){ alert("âŒ " + (data.error || "ì‹¤íŒ¨")); return; }
      alert("âœ… " + (data.message || "ì €ì¥ ì™„ë£Œ"));
      loadPublishList();
    }catch(e){
      alert("âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨!");
    }
  }

  // =========================
  // ë°œí–‰ìš”ì²­ ë¦¬ìŠ¤íŠ¸
  // =========================
  function clearPublishList(){
    const box = document.getElementById("publishList");
    if(box) box.innerHTML = "";
  }

  function fmtMaybe(o, keys){
    for(const k of keys){
      if(o && o[k]) return String(o[k]);
    }
    return "-";
  }

  async function loadPublishList(){
    const box = document.getElementById("publishList");
    if(!box) return;

    box.innerHTML = `<div class="small" style="text-align:center;padding:20px;opacity:.7">ğŸ“¥ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>`;

    try{
      const res = await fetch(API_BASE + "/api/publish/list");
      if(!res.ok){
        const t = await res.text();
        box.innerHTML = `<div class="small" style="color:#fca5a5;text-align:center;padding:20px">âŒ ${escapeHtml(t)}</div>`;
        return;
      }
      const data = await res.json();

      const items = data.items || [];
      const count = (typeof data.count === "number") ? data.count : items.length;

      if(!items.length){
        box.innerHTML = `<div class="small" style="text-align:center;padding:40px;opacity:.6">ë°œí–‰ ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤ ğŸ“­</div>`;
        return;
      }

      let html = `<div class="small" style="padding:10px;background:rgba(102,126,234,.15);border-radius:10px;margin-bottom:12px;border:1px solid rgba(102,126,234,.2)">ì´ <b>${count}</b>ê°œì˜ ë°œí–‰ ìš”ì²­</div>`;

      const list = items.slice().reverse();

      list.forEach((it, idx)=>{
        const topic = fmtMaybe(it, ["topic","title","subject"]);
        const cat = fmtMaybe(it, ["category","cat"]);
        const blogType = fmtMaybe(it, ["blog_type","blogType","type"]);
        const blogUrl = fmtMaybe(it, ["blog_url","blogUrl","url"]);
        const created = fmtMaybe(it, ["created_at","createdAt","time","requested_at"]);
        const mode = fmtMaybe(it, ["mode","kind","publish_type"]);
        const when = fmtMaybe(it, ["schedule_times","start_time","when","schedule"]);

        html += `
          <div class="reqCard">
            <div class="reqTop">
              <div class="reqTitle">${escapeHtml(topic)}</div>
              <span class="reqBadge">${escapeHtml(blogType)}</span>
            </div>
            <div class="reqMeta">
              ğŸ·ï¸ ${escapeHtml(cat)} | ğŸ“ ${escapeHtml(blogUrl)}<br/>
              â° ${escapeHtml(mode)} / ${escapeHtml(when)}<br/>
              ğŸ“… ${escapeHtml(created)}
            </div>
          </div>
        `;
      });

      box.innerHTML = html;

    }catch(e){
      box.innerHTML = `<div class="small" style="color:#fca5a5;text-align:center;padding:20px">âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨</div>`;
    }
  }

  render();
  updateSel();
</script>
</body>
</html>
