<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>BaseOne</title>
  <style>
    :root{
      --bg:#121a33;
      --panel:#1c2647;
      --panel2:#24315c;
      --text:#f8faff;
      --muted:#cfd7ff;
      --border:rgba(255,255,255,.18);
      --primary:#7aa7ff;
      --good:#38e1c1;
      --warn:#ffd166;
      --danger:#ff7b7b;
      --shadow:0 12px 28px rgba(0,0,0,.18);
    }
    [data-theme="light"]{
      --bg:#f5f7ff;
      --panel:#ffffff;
      --panel2:#f0f3ff;
      --text:#0f1630;
      --muted:#3a4a7a;
      --border:rgba(15,22,48,.14);
      --primary:#2f6bff;
      --good:#00b894;
      --warn:#f39c12;
      --danger:#e74c3c;
      --shadow:0 10px 22px rgba(15,22,48,.10);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif;
      background:
        radial-gradient(1200px 700px at 10% 0%, rgba(122,167,255,.35), transparent 55%),
        radial-gradient(1200px 700px at 90% 10%, rgba(170,140,255,.22), transparent 55%),
        radial-gradient(900px 520px at 50% 90%, rgba(56,225,193,.18), transparent 55%),
        linear-gradient(180deg,#0f1630,var(--bg));
      color:var(--text);
      font-size:13px;
    }
    a{color:inherit;text-decoration:none}
    .wrap{max-width:1060px;margin:0 auto;padding:10px}

    .top{
      display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
      padding:10px 6px;
    }
    .brand{display:flex;align-items:center;gap:10px}
    .logo{
      width:36px;height:36px;border-radius:14px;
      background:linear-gradient(135deg,var(--primary), var(--good));
      display:flex;align-items:center;justify-content:center;
      font-weight:900;
      box-shadow:var(--shadow);
      color:#fff;
    }
    [data-theme="light"] .logo{color:#fff}
    .title{font-size:18px;font-weight:900;line-height:1}
    .subtitle{font-size:12px;color:var(--muted);opacity:.95;margin-top:4px}

    .pill{
      display:inline-flex;align-items:center;gap:6px;
      padding:6px 10px;border-radius:999px;
      background:rgba(35,49,91,.18);
      border:1px solid var(--border);
      color:var(--muted);font-size:12px;
      backdrop-filter: blur(6px);
    }

    .btn{
      padding:8px 11px;border-radius:12px;border:1px solid var(--border);
      background:rgba(255,255,255,.06);
      color:var(--text);cursor:pointer;font-weight:900;
      transition:transform .05s ease, filter .15s ease;
      font-size:12px;
    }
    [data-theme="light"] .btn{background:rgba(15,22,48,.04)}
    .btn:hover{filter:brightness(1.07)}
    .btn:active{transform:translateY(1px)}
    .btn.primary{
      background:linear-gradient(135deg,var(--primary), #2f6bff);
      border:none;color:#fff;
    }
    .btn.good{
      background:linear-gradient(135deg, var(--good), #1fb6ff);
      border:none;color:#fff;
    }
    .btn.danger{
      background:rgba(255,107,107,.12);
      border:1px solid rgba(255,107,107,.35);
      color:var(--danger);
    }

    .box{
      background:rgba(31,43,77,.38);
      border:1px solid var(--border);
      padding:12px;
      border-radius:18px;
      margin:10px 0;
      box-shadow:var(--shadow);
      backdrop-filter: blur(8px);
    }
    [data-theme="light"] .box{background:rgba(255,255,255,.86)}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:space-between}

    input, select, textarea{
      padding:9px 10px;border-radius:12px;border:1px solid var(--border);
      background:rgba(35,49,91,.28);
      color:var(--text);outline:none;
      font-size:12.5px;
    }
    [data-theme="light"] input,[data-theme="light"] select,[data-theme="light"] textarea{
      background:rgba(15,22,48,.04);
    }
    select{min-width:310px}
    textarea{width:100%;min-height:160px;line-height:1.6}

    .small{font-size:12px;color:var(--muted)}
    .hint{
      padding:8px 10px;border-radius:12px;
      border:1px solid rgba(56,225,193,.28);
      background:rgba(56,225,193,.10);
      color:var(--muted)
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(6,1fr);
      gap:8px;
      margin-top:10px;
    }
    @media(max-width:980px){.grid{grid-template-columns:repeat(4,1fr)}}
    @media(max-width:820px){.grid{grid-template-columns:repeat(2,1fr)}}

    .cat{
      background:rgba(35,49,91,.22);
      border:1px solid rgba(255,255,255,.14);
      padding:10px 10px;
      border-radius:16px;
      cursor:pointer;
      display:flex;justify-content:space-between;align-items:flex-start;gap:8px;
      transition:transform .08s ease, border-color .15s ease, filter .15s ease;
      min-height:56px;
    }
    [data-theme="light"] .cat{background:rgba(15,22,48,.04)}
    .cat:hover{transform:translateY(-1px);border-color:rgba(122,167,255,.60);filter:brightness(1.06)}
    .cat b{font-size:12.8px;letter-spacing:-.2px}
    .cat .desc{font-size:11.5px;color:var(--muted);opacity:.92;margin-top:4px}
    .badge{
      font-size:11.5px;color:var(--muted);
      background:rgba(31,43,77,.20);
      border:1px solid rgba(255,255,255,.14);
      padding:3px 7px;border-radius:999px;
      white-space:nowrap;
    }

    .topicScroll{max-height:360px;overflow:auto;margin-top:10px;padding-right:6px}
    .topicScroll::-webkit-scrollbar{width:10px}
    .topicScroll::-webkit-scrollbar-thumb{background:rgba(122,167,255,.35);border-radius:10px}
    .topicScroll::-webkit-scrollbar-track{background:rgba(35,49,91,.15);border-radius:10px}

    .card{
      background:rgba(35,49,91,.22);
      border:1px solid rgba(255,255,255,.14);
      padding:10px 10px;border-radius:16px;
      display:flex;justify-content:space-between;gap:10px;align-items:center;
      margin-bottom:8px;
    }
    [data-theme="light"] .card{background:rgba(15,22,48,.04)}
    .cardTitle{display:flex;align-items:center;gap:8px;font-weight:900}
    .card .meta{font-size:11.5px;color:var(--muted);opacity:.95;margin-top:4px}
    .chip{
      display:inline-flex;align-items:center;gap:6px;
      padding:5px 9px;border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(35,49,91,.15);
      color:var(--muted);
      font-size:11.5px;
    }
    [data-theme="light"] .chip{background:rgba(15,22,48,.04)}

    .card.selected{
      border-color:rgba(122,167,255,.85);
      box-shadow:0 0 0 2px rgba(122,167,255,.25);
      background:linear-gradient(135deg, rgba(122,167,255,.16), rgba(56,225,193,.12));
    }

    .starBtn{
      border:1px solid rgba(255,255,255,.14);
      background:rgba(31,43,77,.15);
      color:var(--muted);
      border-radius:12px;
      padding:7px 10px;
      font-size:12px;
      cursor:pointer;
      font-weight:900;
    }
    [data-theme="light"] .starBtn{background:rgba(15,22,48,.04)}
    .starBtn.on{
      background:rgba(255,215,0,.12);
      border-color:rgba(255,215,0,.35);
      color:#c08b00;
    }

    /* ë¡œê·¸ */
    #genBox{display:none}
    #genLog{
      margin-top:10px;
      background:rgba(35,49,91,.18);
      border:1px solid rgba(255,255,255,.14);
      border-radius:14px;
      padding:10px;
      max-height:220px;
      overflow:auto;
      font-size:12px;
      line-height:1.6;
    }
    [data-theme="light"] #genLog{background:rgba(15,22,48,.04)}

    /* ë¯¸ë¦¬ë³´ê¸° */
    #finalBox{display:none}
    .finalGrid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
    @media(max-width:900px){.finalGrid{grid-template-columns:1fr}}
    .finalCard{
      background:rgba(35,49,91,.18);
      border:1px solid rgba(255,255,255,.14);
      border-radius:16px;
      padding:10px;
    }
    [data-theme="light"] .finalCard{background:rgba(15,22,48,.04)}
    .finalText{
      margin-top:8px;
      background:rgba(31,43,77,.14);
      border:1px solid rgba(255,255,255,.12);
      border-radius:14px;
      padding:10px;
      min-height:220px;
      white-space:pre-wrap;
      overflow:auto;
      font-size:12.5px;
      line-height:1.7;
    }
    [data-theme="light"] .finalText{background:rgba(15,22,48,.03)}

    /* ë§í¬ */
    .linkRow{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .linkBtn{
      display:inline-flex;align-items:center;gap:6px;
      padding:7px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(31,43,77,.15);
      color:var(--muted);
      font-weight:900;
      font-size:12px;
    }
    [data-theme="light"] .linkBtn{background:rgba(15,22,48,.04)}

    /* ì§„í–‰ë¥  ë°” */
    .progWrap{
      margin-top:10px;
      border:1px solid var(--border);
      border-radius:999px;
      overflow:hidden;
      height:12px;
      background:rgba(255,255,255,.10);
    }
    [data-theme="light"] .progWrap{background:rgba(15,22,48,.06)}
    .progBar{
      height:100%;
      width:0%;
      background:linear-gradient(90deg,var(--primary),var(--good));
      transition:width .2s ease;
    }

    /* ë“œë˜ê·¸ ì•ˆë‚´ */
    .dragHint{font-size:12px;color:var(--muted)}
    .dragHandle{cursor:grab; user-select:none; padding:6px 8px; border-radius:10px; border:1px solid rgba(255,255,255,.14); background:rgba(31,43,77,.12)}
    [data-theme="light"] .dragHandle{background:rgba(15,22,48,.04)}
  </style>
</head>

<body>
<div class="wrap">

  <div class="top">
    <div class="brand">
      <div class="logo">B</div>
      <div>
        <div class="title">BaseOne âœ¨</div>
        <div class="subtitle">ğŸ§  ì£¼ì œ â†’ âœ¨ AI ìƒì„±(ë‹¨ê±´/ì¼ê´„) â†’ ğŸš€ ì €ì¥/ë°œí–‰</div>
      </div>
    </div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
      <span class="pill">ğŸ›°ï¸ ì„œë²„ <b id="sv">-</b></span>
      <button class="btn" onclick="toggleTheme()">ğŸŒ“ ë‹¤í¬/ë¼ì´íŠ¸</button>
      <a href="/settings"><button class="btn">âš™ï¸ ì„¤ì •</button></a>
    </div>
  </div>

  <!-- ë¸”ë¡œê·¸ ì„ íƒ -->
  <div class="box">
    <div class="row">
      <div>
        <b>ğŸ—‚ï¸ ë¸”ë¡œê·¸ ì„ íƒ</b>
        <div class="small">ì„¤ì •ì— ì €ì¥ëœ ì£¼ì†Œê°€ ìë™ìœ¼ë¡œ ëœ¹ë‹ˆë‹¤.</div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
        <select id="blogSelect"></select>
        <button class="btn" onclick="loadBlogsToSelect()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
      </div>
    </div>
    <div class="small" style="margin-top:8px">âœ… í˜„ì¬ ì„ íƒ: <b id="blogNow">-</b></div>
  </div>

  <!-- í…œí”Œë¦¿ -->
  <div class="box" id="templateBox">
    <div class="row">
      <div>
        <b>ğŸ§© í”Œë«í¼ë³„ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿</b>
        <div class="small">í…œí”Œë¦¿ì€ í”Œë«í¼ë³„ë¡œ ì €ì¥ë©ë‹ˆë‹¤.</div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn" onclick="toggleTemplateBox()">ğŸ‘ ìˆ¨ê¸°ê¸°/ë³´ì´ê¸°</button>
        <button class="btn" onclick="saveTemplates()">ğŸ’¾ ì €ì¥</button>
        <button class="btn danger" onclick="resetTemplates()">â™»ï¸ ê¸°ë³¸ê°’</button>
      </div>
    </div>

    <div id="templateInner">
      <div class="small" style="margin-top:10px">
        ë³€ìˆ˜: <span class="chip">{{topic}}</span> <span class="chip">{{category}}</span>
        <span class="chip">{{image_url}}</span> <span class="chip">{{body_prompt}}</span>
      </div>

      <div style="margin-top:10px">
        <div class="small"><b>ğŸ“ ë³¸ë¬¸ í…œí”Œë¦¿</b></div>
        <textarea id="tplBody"></textarea>
      </div>

      <div style="margin-top:10px">
        <div class="small"><b>ğŸ–¼ï¸ ì´ë¯¸ì§€ í…œí”Œë¦¿(ì„ íƒ)</b></div>
        <textarea id="tplImage" style="min-height:120px"></textarea>
      </div>

      <div class="small" style="margin-top:10px">í˜„ì¬ ì ìš©: <b id="tplNow">-</b></div>

      <div class="hint small" style="margin-top:10px">
        ğŸ” OAuth ìë™ ì—…ë¡œë“œ(ë¸”ë¡œê·¸ìŠ¤íŒŸ)ëŠ” ì„œë²„ ì‘ì—…ì´ í•„ìš”í•©ë‹ˆë‹¤. (ì•„ë˜ì— server.py ê³¨ê²©ë„ ì œê³µ)
      </div>
    </div>
  </div>

  <!-- ì£¼ì œ -->
  <div class="box">
    <div class="row">
      <div>
        <b>ğŸ§  ì£¼ì œ ìƒì„±</b>
        <div class="small">ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ë©´ í´ë¦­ ìœ ë„í˜• ì œëª©ì´ 30ê°œ ìƒì„±ë©ë‹ˆë‹¤.</div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
        <input id="filter" placeholder="ğŸ” ê²€ìƒ‰ (â­ë§Œ: star)" oninput="render()">
        <button class="btn" onclick="copyAll()">ğŸ“‹ ì „ì²´ë³µì‚¬</button>
        <button class="btn" onclick="showStarOnly()">â­</button>
        <button class="btn primary" onclick="aiGenerateSelected()">âœ¨ AI ìƒì„±(ì„ íƒ 1ê°œ)</button>
        <button class="btn good" onclick="aiGenerateBulk()">ğŸ§º ì¼ê´„ ìƒì„±</button>
        <button class="btn good" onclick="makeMoney()">ğŸ’° ìˆ˜ìµí˜• 100</button>
      </div>
    </div>

    <div class="grid" id="catGrid"></div>
  </div>

  <!-- ì£¼ì œ ëª©ë¡ -->
  <div class="box">
    <div class="row">
      <div>
        <b>ğŸ“š ì£¼ì œ ëª©ë¡</b>
        <div class="small" id="selInfo">ì„ íƒ ì£¼ì œ: -</div>
        <div class="dragHint">ğŸ§² ì¹´ë“œ ì™¼ìª½ í•¸ë“¤ì„ ë“œë˜ê·¸í•´ì„œ ìˆœì„œë¥¼ ë°”ê¿€ ìˆ˜ ìˆì–´ìš”.</div>
      </div>
      <div class="hint small">âœ… ì²´í¬ ì„ íƒ â†’ â€œì¼ê´„ ìƒì„±â€ ê°€ëŠ¥</div>
    </div>

    <div class="progWrap" style="margin-top:10px">
      <div class="progBar" id="progBar"></div>
    </div>
    <div class="small" style="margin-top:6px" id="progText">ì§„í–‰ë¥ : 0%</div>

    <div class="topicScroll" id="topics"></div>
  </div>

  <!-- ì§„í–‰ìƒí™© -->
  <div class="box" id="genBox">
    <div class="row">
      <b>ğŸ§¾ ì§„í–‰ ë¡œê·¸</b>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn" onclick="toggleGenBox()">ğŸ‘€ í† ê¸€</button>
        <button class="btn danger" onclick="clearGenLog()">ğŸ§¹ ì§€ìš°ê¸°</button>
      </div>
    </div>
    <div id="genLog"></div>
  </div>

  <!-- ìƒì„±ì™„ë£Œ -->
  <div class="box" id="finalBox">
    <div class="row">
      <div>
        <b>âœ… ìƒì„± ì™„ë£Œ ë¯¸ë¦¬ë³´ê¸°(í†µìœ¼ë¡œ)</b>
        <div class="small" id="finalMeta">-</div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn" onclick="copyText(document.getElementById('finalBody').textContent)">ğŸ“‹ ë³¸ë¬¸ ë³µì‚¬</button>
        <button class="btn" onclick="copyText(document.getElementById('finalImage').textContent)">ğŸ–¼ï¸ ì´ë¯¸ì§€ ë³µì‚¬</button>
        <button class="btn primary" onclick="oauthStart()">ğŸ” OAuth ì—°ê²°(ë¸”ë¡œê·¸ìŠ¤íŒŸ)</button>
      </div>
    </div>

    <div class="linkRow" id="linkRow"></div>

    <div class="finalGrid">
      <div class="finalCard">
        <div style="font-weight:900">ğŸ“ ë³¸ë¬¸</div>
        <div class="finalText" id="finalBody"></div>
      </div>
      <div class="finalCard">
        <div style="font-weight:900">ğŸ–¼ï¸ ì´ë¯¸ì§€</div>
        <div class="finalText" id="finalImage"></div>
      </div>
    </div>
  </div>

  <!-- ë°œí–‰ -->
  <div class="box">
    <div class="row">
      <div>
        <b>ğŸš€ ë°œí–‰</b>
        <div class="small">í˜„ì¬ëŠ” ì„œë²„ì— â€œìš”ì²­ ì €ì¥â€ ë‹¨ê³„ì…ë‹ˆë‹¤. (OAuth ë¶™ì´ë©´ ì‹¤ì œ ì—…ë¡œë“œ ê°€ëŠ¥)</div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
        <label class="small">â± ê°„ê²©</label>
        <select id="intervalHours" style="min-width:110px">
          <option value="1">1ì‹œê°„</option><option value="2">2ì‹œê°„</option><option value="3">3ì‹œê°„</option>
          <option value="4">4ì‹œê°„</option><option value="6">6ì‹œê°„</option><option value="12">12ì‹œê°„</option>
        </select>
      </div>
    </div>

    <div class="row" style="margin-top:10px">
      <button class="btn good" onclick="publishInstant()">ğŸš€ ì¦‰ì‹œë°œí–‰(ì €ì¥)</button>
      <button class="btn primary" onclick="publishWithInterval()">â± ì¦‰ì‹œë°œí–‰(ì˜ˆì•½ ì €ì¥)</button>
      <button class="btn" onclick="loadPublishList()">ğŸ“¦ ë°œí–‰ìš”ì²­ ë¦¬ìŠ¤íŠ¸</button>
    </div>

    <div id="publishList" style="margin-top:10px"></div>
  </div>

</div>

<script>
/* ---------------- Theme ---------------- */
const THEME_KEY="baseone_theme_v1";
(function initTheme(){
  const saved = localStorage.getItem(THEME_KEY) || "dark";
  document.documentElement.setAttribute("data-theme", saved);
})();
function toggleTheme(){
  const cur = document.documentElement.getAttribute("data-theme") || "dark";
  const next = (cur === "dark") ? "light" : "dark";
  document.documentElement.setAttribute("data-theme", next);
  localStorage.setItem(THEME_KEY, next);
}

/* ---------------- API Base ---------------- */
function getApiBase(){
  const d = JSON.parse(localStorage.getItem("baseone_settings_v3") || "{}");
  const base = (d.backend || "http://127.0.0.1:5000").trim();
  return base.replace(/\/+$/,"");
}
const API_BASE = getApiBase();
document.addEventListener("DOMContentLoaded", ()=> {
  const el = document.getElementById("sv");
  if(el) el.textContent = API_BASE;
});

/* ---------------- Utils ---------------- */
function escapeHtml(s){
  return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
}
function escapeAttr(s){
  return String(s).replaceAll("\\","\\\\").replaceAll("'","\\'");
}
function safeStr(x){ return (x===undefined || x===null) ? "" : String(x); }
function applyTemplate(tpl, vars){
  let out = safeStr(tpl);
  Object.keys(vars).forEach(k=> out = out.replaceAll(`{{${k}}}`, safeStr(vars[k])) );
  return out;
}
function copyText(t){ navigator.clipboard.writeText(t); alert("ë³µì‚¬ ì™„ë£Œ!"); }

/* ---------------- Logs ---------------- */
function showGenBox(){ document.getElementById("genBox").style.display = "block"; }
function toggleGenBox(){
  const box = document.getElementById("genBox");
  box.style.display = (box.style.display==="none" ? "block" : "none");
}
function addGenLine(icon, color, msg){
  showGenBox();
  const log = document.getElementById("genLog");
  const t = new Date();
  const time = String(t.getHours()).padStart(2,"0")+":"+String(t.getMinutes()).padStart(2,"0")+":"+String(t.getSeconds()).padStart(2,"0");
  log.innerHTML += `<div style="color:${color}">${icon} <b>[${time}]</b> ${escapeHtml(msg)}</div>`;
  log.scrollTop = log.scrollHeight;
}
function addGenLog(msg){ addGenLine("ğŸŸ¦","var(--text)",msg); }
function addGenOk(msg){ addGenLine("âœ…","var(--good)",msg); }
function addGenErr(msg){ addGenLine("âŒ","var(--danger)",msg); }
function clearGenLog(){ document.getElementById("genLog").innerHTML = ""; }

/* ---------------- Template Toggle ---------------- */
function toggleTemplateBox(){
  const inner = document.getElementById("templateInner");
  if(!inner) return;
  inner.style.display = (inner.style.display==="none" ? "block" : "none");
}

/* ---------------- Categories ---------------- */
const CATS=[
  {k:"ê±´ê°•", s:"ğŸƒ ìš´ë™Â·ì˜ì–‘"},
  {k:"ì»´í“¨í„°/IT", s:"ğŸ’» ìœ í‹¸Â·ë³´ì•ˆ"},
  {k:"ìë™ì°¨", s:"ğŸš— ì •ë¹„Â·ë³´í—˜"},
  {k:"ìƒí™œ/ê°€ì „", s:"ğŸ  ì‚´ë¦¼Â·ì ˆì•½"},
  {k:"ìœ¡ì•„", s:"ğŸ¼ ìœ¡ì•„Â·êµìœ¡"},
  {k:"ëˆ/ì¬í…Œí¬", s:"ğŸ’° ì ˆì•½Â·ì„¸ê¸ˆ"},
  {k:"ì—¬í–‰", s:"ğŸ§³ ì½”ìŠ¤Â·ê¿€íŒ"},
  {k:"ìš”ë¦¬", s:"ğŸ³ ë ˆì‹œí”¼"},
  {k:"ìê¸°ê³„ë°œ", s:"ğŸ“ˆ ìŠµê´€"},
  {k:"ê³µë¶€/ìê²©ì¦", s:"ğŸ“š í•©ê²©"},
  {k:"ë°˜ë ¤ë™ë¬¼", s:"ğŸ¶ ì¼€ì–´"},
  {k:"íŒ¨ì…˜/ë·°í‹°", s:"ğŸ’„ ê´€ë¦¬"},
  {k:"ì·¨ë¯¸", s:"ğŸ¨ DIY"},
  {k:"ìŠ¤í¬ì¸ ", s:"ğŸ‹ï¸ ë£¨í‹´"},
  {k:"ê²Œì„", s:"ğŸ® íŒ"},
  {k:"ì˜í™”/ë“œë¼ë§ˆ", s:"ğŸ¬ ë¦¬ë·°"}
];
const grid=document.getElementById("catGrid");
CATS.forEach(obj=>{
  const d=document.createElement("div");
  d.className="cat";
  d.onclick=()=>makeTopics(obj.k);
  d.innerHTML = `
    <div>
      <b>${obj.k}</b>
      <div class="desc">${obj.s}</div>
    </div>
    <span class="badge">30</span>
  `;
  grid.appendChild(d);
});

/* ---------------- Topic State ---------------- */
let topics=[];           // [{id, title}]
let selectedTopicId="";  // active one
let selectedCat="";
const checked = new Set(); // multi-select ids

function setProgress(pct){
  const v = Math.max(0, Math.min(100, Math.round(pct)));
  document.getElementById("progBar").style.width = v + "%";
  document.getElementById("progText").textContent = `ì§„í–‰ë¥ : ${v}%`;
}

/* ---- Star ---- */
const STAR_KEY="baseone_fav_topics_v1";
function getStars(){ try{ const s=JSON.parse(localStorage.getItem(STAR_KEY)||"[]"); return Array.isArray(s)?s:[]; }catch(e){ return []; } }
function setStars(arr){ localStorage.setItem(STAR_KEY, JSON.stringify(arr)); }
function isStar(title){ return getStars().includes(title); }
function toggleStar(title){
  const s=getStars(); const i=s.indexOf(title);
  if(i>=0) s.splice(i,1); else s.unshift(title);
  setStars(s.slice(0,300));
  render();
}
function showStarOnly(){ document.getElementById("filter").value="star"; render(); }

/* ---- Better Topic Generator ---- */
function buildIdeas(cat, n=30){
  const hooks=[
    "ì´ˆë³´ë„ ë°”ë¡œ ë˜ëŠ”", "ì‹¤íŒ¨ ì—†ëŠ”", "í•˜ë£¨ 10ë¶„", "ëˆ ìƒˆëŠ” êµ¬ë© ë§‰ëŠ”", "ê²€ìƒ‰ 1ìœ„ê°€ ìì£¼ ë‚˜ì˜¤ëŠ”",
    "ì˜ì™¸ë¡œ ë‹¤ë“¤ ë†“ì¹˜ëŠ”", "ìš”ì¦˜ ì‚¬ëŒë“¤ì´ ê°€ì¥ ê¶ê¸ˆí•´í•˜ëŠ”", "ì •ë¦¬ í•œ ë²ˆì— ëë‚´ëŠ”", "ì˜¤ëŠ˜ë¶€í„° ì ìš© ê°€ëŠ¥í•œ"
  ];
  const patternsByCat={
    "ê±´ê°•":[
      "ë©´ì—­ë ¥ ì˜¬ë¦¬ëŠ” ìŠµê´€ {x}ê°€ì§€", "í”¼ê³¤ì´ ê³„ì†ë  ë•Œ ì ê²€ ì²´í¬ë¦¬ìŠ¤íŠ¸", "ì  ì˜ ì˜¤ëŠ” í™˜ê²½ ì„¸íŒ…ë²•",
      "í˜ˆë‹¹/í˜ˆì•• ê´€ë¦¬ ì‹ë‹¨ ë£¨í‹´", "ìš´ë™ ì´ˆë³´ê°€ ë§í•˜ëŠ” ì´ìœ ì™€ í•´ê²°ë²•", "ì•„ì¹¨ ì»¨ë””ì…˜ ì¢‹ì•„ì§€ëŠ” ë£¨í‹´"
    ],
    "ëˆ/ì¬í…Œí¬":[
      "ì›” {x}ë§Œì› ì•„ë¼ëŠ” ê³ ì •ë¹„ ì ê²€í‘œ", "í†µì‹ ë¹„/ë³´í—˜ë£Œ ì¤„ì´ëŠ” ìˆœì„œ", "ì´ˆë³´ ì˜ˆì‚°ê´€ë¦¬(ê°€ê³„ë¶€ ì—†ì´)",
      "ì—°ë§ì •ì‚°ì—ì„œ ìì£¼ ë†“ì¹˜ëŠ” í•­ëª©", "ì¹´ë“œ í˜œíƒ 200% ì“°ëŠ” ë°©ë²•", "ë¹„ìƒê¸ˆ í†µì¥ ë§Œë“œëŠ” ë²•"
    ],
    "ì—¬í–‰":[
      "ì£¼ë§ 1ë°•2ì¼ ì½”ìŠ¤ ì¶”ì²œ", "ì‹¤íŒ¨ ì—†ëŠ” ìˆ™ì†Œ ê³ ë¥´ëŠ” ë²•", "ì—¬í–‰ê²½ë¹„ ì¤„ì´ëŠ” ê¿€íŒ",
      "ëŒ€ì¤‘êµí†µë§Œìœ¼ë¡œë„ í¸í•œ ì½”ìŠ¤", "ë¹„ ì˜¤ëŠ” ë‚ ì—ë„ ì¢‹ì€ ì¼ì •", "ì‚¬ì§„ ì˜ ë‚˜ì˜¤ëŠ” ìŠ¤íŒŸ ì¶”ì²œ"
    ]
  };
  const bases = patternsByCat[cat] || [
    "{cat} ì‹œì‘í•  ë•Œ ê¼­ ì•Œì•„ì•¼ í•  ê¸°ë³¸", "{cat}ì—ì„œ ìì£¼ í•˜ëŠ” ì‹¤ìˆ˜ TOP {x}",
    "{cat} ì´ˆë³´ê°€ ë°”ë¡œ ì“°ëŠ” ì²´í¬ë¦¬ìŠ¤íŠ¸", "{cat} ë¹„ìš©/ì‹œê°„ ì•„ë¼ëŠ” ë°©ë²•",
    "{cat} Q&A: ì‚¬ëŒë“¤ì´ ê°€ì¥ ë§ì´ ë¬»ëŠ” ì§ˆë¬¸"
  ];

  const out=new Set();
  let tries=0;
  while(out.size<n && tries<500){
    tries++;
    const h = hooks[Math.floor(Math.random()*hooks.length)];
    const b = bases[Math.floor(Math.random()*bases.length)];
    const x = 5 + Math.floor(Math.random()*6); // 5~10
    let t = (h+" "+b).replaceAll("{x}", String(x)).replaceAll("{cat}", cat);
    t = t.replaceAll("  "," ").trim();
    out.add(t);
  }
  return Array.from(out).slice(0,n);
}

function makeTopics(cat){
  selectedCat=cat;
  const titles = buildIdeas(cat, 30);
  topics = titles.map((t,i)=>({id:`${Date.now()}_${i}`, title:t}));
  selectedTopicId = topics[0]?.id || "";
  checked.clear();
  if(selectedTopicId) checked.add(selectedTopicId);
  updateSel();
  setProgress(0);
  render();
}

function makeMoney(){
  selectedCat="ìˆ˜ìµí˜•";
  const list = [
    "ë³´í—˜ë£Œ ì¤„ì´ê¸° í˜„ì‹¤ ì²´í¬ë¦¬ìŠ¤íŠ¸","ì‹ ìš©ì¹´ë“œ í˜œíƒ ì œëŒ€ë¡œ ë°›ëŠ” ë²•","í†µì‹ ë¹„ ì ˆì•½í•˜ëŠ” ìˆœì„œ",
    "ì „ê¸°ìš”ê¸ˆ ì¤„ì´ëŠ” ìŠµê´€","ê°€ìŠ¤ìš”ê¸ˆ ì ˆì•½ íŒ","ëŒ€ì¶œ ì´ì ì¤„ì´ëŠ” ë°©ë²•","IRP/ì—°ê¸ˆ ê¸°ì´ˆ",
    "ì„¸ê¸ˆ ì•„ë¼ëŠ” ê¸°ë³¸","ìë™ì°¨ë³´í—˜ ë¹„êµ íŒ","ì¤‘ê³ ì°¨ êµ¬ë§¤ ì²´í¬ë¦¬ìŠ¤íŠ¸"
  ];
  const titles = [];
  for(let i=0;i<30;i++){
    const base=list[i%list.length];
    titles.push(`${base} (ì´ˆë³´ìš©) â€“ ì‹¤ìˆ˜ 7ê°€ì§€ì™€ í•´ê²°ë²•`);
  }
  topics = titles.map((t,i)=>({id:`M_${Date.now()}_${i}`, title:t}));
  selectedTopicId = topics[0]?.id || "";
  checked.clear();
  if(selectedTopicId) checked.add(selectedTopicId);
  updateSel();
  setProgress(0);
  render();
}

function getSelectedTitle(){
  return topics.find(x=>x.id===selectedTopicId)?.title || "";
}

function updateSel(){
  document.getElementById("selInfo").textContent = `ì„ íƒ ì£¼ì œ: ${getSelectedTitle() || "-"}`;
}

function setSelected(id){
  selectedTopicId = id;
  checked.add(id);
  updateSel();
  render();
}

/* ---- Drag & Drop (reorder) ---- */
let dragId=null;
function onDragStart(id){ dragId=id; }
function onDrop(targetId){
  if(!dragId || dragId===targetId) return;
  const a = topics.findIndex(x=>x.id===dragId);
  const b = topics.findIndex(x=>x.id===targetId);
  if(a<0 || b<0) return;
  const item = topics.splice(a,1)[0];
  topics.splice(b,0,item);
  dragId=null;
  render();
}

/* ---- Render List ---- */
function render(){
  const q=(document.getElementById("filter").value||"").trim().toLowerCase();
  const list=document.getElementById("topics");
  list.innerHTML="";

  let arr = topics.slice();

  if(q==="star"){
    const stars = getStars();
    arr = stars.map((t,i)=>({id:`S_${i}`, title:t}));
  }else if(q){
    arr = arr.filter(x=>x.title.toLowerCase().includes(q));
  }

  if(!arr.length){
    list.innerHTML = `<div class="small">ëª©ë¡ì´ ë¹„ì—ˆìŠµë‹ˆë‹¤.</div>`;
    return;
  }

  arr.forEach(item=>{
    const title = item.title;
    const starOn = isStar(title);
    const isSel = (item.id===selectedTopicId);
    const isChecked = checked.has(item.id);

    const d=document.createElement("div");
    d.className="card"+(isSel?" selected":"");
    d.setAttribute("draggable","true");
    d.ondragstart=()=>onDragStart(item.id);
    d.ondragover=(e)=>e.preventDefault();
    d.ondrop=()=>onDrop(item.id);

    d.innerHTML=`
      <div style="flex:1;min-width:240px">
        <div class="cardTitle">
          <span class="dragHandle" title="ë“œë˜ê·¸ë¡œ ìˆœì„œ ë³€ê²½">â ¿</span>
          <span>${starOn?"â­":"â˜†"}</span>
          <span>${escapeHtml(title)}</span>
        </div>
        <div class="meta">${selectedCat?`ğŸ·ï¸ ${escapeHtml(selectedCat)}`:""}</div>
      </div>

      <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
        <label class="small" style="display:flex;gap:6px;align-items:center">
          <input type="checkbox" ${isChecked?"checked":""}
            onchange="toggleCheck('${escapeAttr(item.id)}', this.checked)">
          ì„ íƒ
        </label>

        <button class="starBtn ${starOn?"on":""}" onclick="toggleStar('${escapeAttr(title)}')">${starOn?"â­":"â˜†"}</button>
        <button class="btn" onclick="setSelected('${escapeAttr(item.id)}')">í™œì„±</button>
        <button class="btn" onclick="copyText('${escapeAttr(title)}')">ë³µì‚¬</button>
      </div>
    `;
    list.appendChild(d);
  });
}
function toggleCheck(id, on){
  if(on) checked.add(id); else checked.delete(id);
}

/* ---- Copy All ---- */
function copyAll(){
  if(!topics.length){alert("ì£¼ì œ ì—†ìŒ");return;}
  navigator.clipboard.writeText(topics.map(x=>x.title).join("\n"));
  alert("ì „ì²´ ë³µì‚¬ ì™„ë£Œ!");
}

/* ---------------- Blog Select (v2 + v3 fallback) ---------------- */
function loadBlogsToSelect(){
  const sel=document.getElementById("blogSelect");
  const now=document.getElementById("blogNow");
  sel.innerHTML="";

  // 1) v2 ìš°ì„ 
  let v2 = null;
  try{ v2 = JSON.parse(localStorage.getItem("baseone_settings_v2")||"null"); }catch(e){}
  const v3 = JSON.parse(localStorage.getItem("baseone_settings_v3")||"{}");

  const blogs = (v2 && v2.blogs) ? v2.blogs : {
    blogspot: (v3.blogspot||[]),
    naver: (v3.naver||[]),
    tistory: (v3.tistory||[])
  };

  const options=[];
  (blogs.blogspot||[]).filter(Boolean).forEach((u,i)=>options.push({type:"blogspot",url:u,label:`ğŸŸ¦ ë¸”ë¡œê·¸ìŠ¤íŒŸ ${i+1} - ${u}`}));
  (blogs.naver||[]).filter(Boolean).forEach((u,i)=>options.push({type:"naver",url:u,label:`ğŸŸ© ë„¤ì´ë²„ ${i+1} - ${u}`}));
  (blogs.tistory||[]).filter(Boolean).forEach((u,i)=>options.push({type:"tistory",url:u,label:`ğŸŸ§ í‹°ìŠ¤í† ë¦¬ ${i+1} - ${u}`}));

  if(!options.length){
    const opt=document.createElement("option");
    opt.value=""; opt.textContent="ì €ì¥ëœ ë¸”ë¡œê·¸ ì£¼ì†Œ ì—†ìŒ â†’ ì„¤ì •(/settings)ì—ì„œ ì €ì¥";
    sel.appendChild(opt);
    now.textContent="-";
    return;
  }

  options.forEach(o=>{
    const opt=document.createElement("option");
    opt.value=JSON.stringify({type:o.type,url:o.url});
    opt.textContent=o.label;
    sel.appendChild(opt);
  });

  const last=localStorage.getItem("baseone_last_blog");
  if(last){
    for(let i=0;i<sel.options.length;i++){
      if(sel.options[i].value===last){sel.selectedIndex=i;break;}
    }
  }
  updateBlogNow();
}

function updateBlogNow(){
  const sel=document.getElementById("blogSelect");
  const now=document.getElementById("blogNow");
  const v=sel.value;
  if(!v){ now.textContent="-"; return; }
  localStorage.setItem("baseone_last_blog", v);
  try{
    const obj=JSON.parse(v);
    now.textContent=`${obj.type} / ${obj.url}`;
    setPromptTab(obj.type);
  }catch(e){ now.textContent="-"; }
}
document.addEventListener("change",(e)=>{
  if(e.target && e.target.id==="blogSelect") updateBlogNow();
});
loadBlogsToSelect();

/* ---------------- Templates ---------------- */
const PROMPT_KEY="baseone_prompts_v1";
const PLATFORMS=[
  {k:"blogspot",label:"ğŸŸ¦ ë¸”ë¡œê·¸ìŠ¤íŒŸ"},
  {k:"naver",label:"ğŸŸ© ë„¤ì´ë²„"},
  {k:"tistory",label:"ğŸŸ§ í‹°ìŠ¤í† ë¦¬"},
];
let currentPlatform="blogspot";

function defaultTemplates(){
  return {
    blogspot:{ body:`ë„ˆëŠ” ë¸”ë¡œê·¸ìŠ¤íŒŸ ì „ë¬¸ ì‘ê°€ì•¼.\nì£¼ì œ: {{topic}}\nì¹´í…Œê³ ë¦¬: {{category}}\n\n{{body_prompt}}`,
              image:`{{image_prompt}}\n{{image_url}}` },
    naver:{ body:`ë„ˆëŠ” ë„¤ì´ë²„ ë¸”ë¡œê·¸ ì „ë¬¸ ì‘ê°€ì•¼.\nì£¼ì œ: {{topic}}\nì¹´í…Œê³ ë¦¬: {{category}}\n\n{{body_prompt}}`,
            image:`{{image_prompt}}\n{{image_url}}` },
    tistory:{ body:`ë„ˆëŠ” í‹°ìŠ¤í† ë¦¬ ì „ë¬¸ ì‘ê°€ì•¼.\nì£¼ì œ: {{topic}}\nì¹´í…Œê³ ë¦¬: {{category}}\n\n{{body_prompt}}`,
              image:`{{image_prompt}}\n{{image_url}}` }
  };
}
function getTemplates(){
  try{
    const saved=JSON.parse(localStorage.getItem(PROMPT_KEY)||"null");
    if(saved && typeof saved==="object") return saved;
  }catch(e){}
  const d=defaultTemplates();
  localStorage.setItem(PROMPT_KEY, JSON.stringify(d));
  return d;
}
function setTemplates(obj){ localStorage.setItem(PROMPT_KEY, JSON.stringify(obj)); }

function setPromptTab(k){
  currentPlatform=k;
  const tpls=getTemplates();
  const body=(tpls[k]&&tpls[k].body)?tpls[k].body:"";
  const image=(tpls[k]&&tpls[k].image)?tpls[k].image:"";
  document.getElementById("tplBody").value=body;
  document.getElementById("tplImage").value=image;
  document.getElementById("tplNow").textContent = (PLATFORMS.find(p=>p.k===k)?.label || k);
}
function saveTemplates(){
  const t=getTemplates();
  t[currentPlatform]=t[currentPlatform]||{};
  t[currentPlatform].body=document.getElementById("tplBody").value||"";
  t[currentPlatform].image=document.getElementById("tplImage").value||"";
  setTemplates(t);
  alert("ì €ì¥ ì™„ë£Œ!");
}
function resetTemplates(){
  const d=defaultTemplates();
  setTemplates(d);
  setPromptTab(currentPlatform);
  alert("ê¸°ë³¸ê°’ ë³µêµ¬ ì™„ë£Œ!");
}
setPromptTab(currentPlatform);

function getSelectedBlog(){
  const v=document.getElementById("blogSelect").value;
  if(!v) return null;
  try{ return JSON.parse(v); }catch(e){ return null; }
}

/* ---------------- AI Generate (single) ---------------- */
async function aiGenerateSelected(){
  const title = getSelectedTitle();
  if(!title){ alert("ì£¼ì œë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”!"); return; }

  const blog=getSelectedBlog();
  const blogType=blog?.type||"blogspot";
  setPromptTab(blogType);

  document.getElementById("finalBox").style.display="none";

  showGenBox();
  addGenLog(`ğŸ›°ï¸ ì„œë²„: ${API_BASE}`);
  addGenLog(`ğŸ—‚ï¸ ë¸”ë¡œê·¸: ${blogType}`);
  addGenLog(`ğŸ§  ì£¼ì œ: ${title}`);
  addGenLog(`ğŸ·ï¸ ì¹´í…Œê³ ë¦¬: ${selectedCat || "-"}`);

  const sV3 = JSON.parse(localStorage.getItem("baseone_settings_v3")||"{}");
  const v2 = JSON.parse(localStorage.getItem("baseone_settings_v2")||"{}");

  const payload={
    topic:title,
    category:selectedCat,
    blog:blogType,
    img_provider:(v2.imgProvider || sV3.img_provider || "pexels"),
    pexels_key:(v2.pexelsKey || sV3.pexels_key || "")
  };

  try{
    const res=await fetch(API_BASE+"/api/generate",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify(payload)
    });
    if(!res.ok){
      const t=await res.text();
      addGenErr("ìƒì„± ì‹¤íŒ¨: "+t);
      alert("ìƒì„± ì‹¤íŒ¨: "+t);
      return;
    }
    const data=await res.json();
    addGenOk("ìƒì„± ì™„ë£Œ");
    renderFinalPreview(data, blogType);
  }catch(e){
    addGenErr("ì„œë²„ ì—°ê²° ì‹¤íŒ¨");
    alert("ì„œë²„ ì—°ê²° ì‹¤íŒ¨! ì„¤ì •ì˜ ì„œë²„ ì£¼ì†Œ(API_BASE)ë¥¼ í™•ì¸í•˜ì„¸ìš”.");
  }
}

/* ---------------- AI Generate (bulk) ---------------- */
async function aiGenerateBulk(){
  const ids = Array.from(checked);
  if(!ids.length){ alert("ì²´í¬ëœ ì£¼ì œê°€ ì—†ìŠµë‹ˆë‹¤."); return; }

  const blog=getSelectedBlog();
  const blogType=blog?.type||"blogspot";
  setPromptTab(blogType);

  showGenBox();
  addGenLog(`ğŸ§º ì¼ê´„ ìƒì„± ì‹œì‘ (${ids.length}ê°œ)`);

  setProgress(0);

  for(let i=0;i<ids.length;i++){
    const id = ids[i];
    const title = topics.find(x=>x.id===id)?.title || "";
    if(!title) continue;

    selectedTopicId = id;
    updateSel();
    render();

    addGenLog(`(${i+1}/${ids.length}) ìƒì„±: ${title}`);

    const sV3 = JSON.parse(localStorage.getItem("baseone_settings_v3")||"{}");
    const v2 = JSON.parse(localStorage.getItem("baseone_settings_v2")||"{}");
    const payload={
      topic:title,
      category:selectedCat,
      blog:blogType,
      img_provider:(v2.imgProvider || sV3.img_provider || "pexels"),
      pexels_key:(v2.pexelsKey || sV3.pexels_key || "")
    };

    try{
      const res=await fetch(API_BASE+"/api/generate",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify(payload)
      });
      if(!res.ok){
        const t=await res.text();
        addGenErr(`ì‹¤íŒ¨: ${title} / ${t}`);
      }else{
        const data=await res.json();
        addGenOk(`ì™„ë£Œ: ${title}`);
        // ë§ˆì§€ë§‰ ê±´ì€ ë¯¸ë¦¬ë³´ê¸° ë„ì›Œì¤Œ
        if(i===ids.length-1){
          renderFinalPreview(data, blogType);
        }
      }
    }catch(e){
      addGenErr(`ì„œë²„ ì—°ê²° ì‹¤íŒ¨: ${title}`);
    }

    setProgress(((i+1)/ids.length)*100);
  }

  addGenOk("âœ… ì¼ê´„ ìƒì„± ì¢…ë£Œ");
}

function renderFinalPreview(data, blogType){
  const tpls=getTemplates();
  const tpl=(tpls[blogType]||tpls["blogspot"]||{body:"{{body_prompt}}",image:"{{image_prompt}}\n{{image_url}}"});

  const vars={
    topic:data.topic||getSelectedTitle()||"",
    category:data.category||selectedCat||"",
    image_url:data.image_url||"",
    body_prompt:data.body_prompt||"",
    image_prompt:data.image_prompt||""
  };

  const appliedBody=applyTemplate(tpl.body||"{{body_prompt}}",vars);
  const appliedImage=applyTemplate(tpl.image||"{{image_prompt}}\n{{image_url}}",vars);

  document.getElementById("finalMeta").textContent =
    `ğŸ§  ${vars.topic} / ğŸ·ï¸ ${vars.category} / ğŸ—‚ï¸ ${blogType} / â±ï¸ ${data.generated_at || ""}`;

  document.getElementById("finalBody").textContent = appliedBody;
  document.getElementById("finalImage").textContent = appliedImage;

  const q=encodeURIComponent(`${vars.topic} ${vars.category}`.trim());
  const links=[
    {label:"ğŸ” êµ¬ê¸€", url:`https://www.google.com/search?q=${q}`},
    {label:"ğŸ“° ë‰´ìŠ¤", url:`https://www.google.com/search?q=${q}+site:news`},
    {label:"ğŸ“Œ ë„¤ì´ë²„", url:`https://search.naver.com/search.naver?query=${q}`},
    {label:"â–¶ï¸ ìœ íŠœë¸Œ", url:`https://www.youtube.com/results?search_query=${q}`},
    {label:"ğŸ–¼ï¸ ì´ë¯¸ì§€", url:`https://www.google.com/search?tbm=isch&q=${q}`},
  ];
  document.getElementById("linkRow").innerHTML =
    links.map(l=>`<a class="linkBtn" href="${l.url}" target="_blank" rel="noopener noreferrer">${l.label}</a>`).join("");

  document.getElementById("finalBox").style.display="block";
}

/* ---------------- Publish Save ---------------- */
async function publishInstant(){
  const blog=getSelectedBlog();
  const title = getSelectedTitle();
  if(!blog || !title){ alert("ë¸”ë¡œê·¸ì™€ ì£¼ì œë¥¼ ì„ íƒí•˜ì„¸ìš”"); return; }
  showGenBox();
  addGenLog("ğŸš€ ì¦‰ì‹œë°œí–‰(ì €ì¥) í´ë¦­");

  const payload={
    blog_type:blog.type,
    blog_url:blog.url,
    category:selectedCat,
    topic:title,
    start_time:"NOW",
    interval_hours:"0"
  };

  try{
    const res=await fetch(API_BASE+"/api/publish/now",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)});
    const j=await res.json();
    addGenOk("ì €ì¥ ì™„ë£Œ");
    alert(j.message || "ì €ì¥ ì™„ë£Œ");
    loadPublishList();
  }catch(e){
    addGenErr("ì„œë²„ ì—°ê²° ì‹¤íŒ¨");
    alert("ì„œë²„ ì—°ê²° ì‹¤íŒ¨!");
  }
}

async function publishWithInterval(){
  const blog=getSelectedBlog();
  const title = getSelectedTitle();
  if(!blog || !title){ alert("ë¸”ë¡œê·¸ì™€ ì£¼ì œë¥¼ ì„ íƒí•˜ì„¸ìš”"); return; }
  const interval_hours=document.getElementById("intervalHours").value;

  showGenBox();
  addGenLog("â± ì˜ˆì•½ ì €ì¥ í´ë¦­");

  const payload={
    blog_type:blog.type,
    blog_url:blog.url,
    category:selectedCat,
    topic:title,
    start_time:"NOW",
    interval_hours
  };

  try{
    const res=await fetch(API_BASE+"/api/publish/now",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)});
    const j=await res.json();
    addGenOk("ì˜ˆì•½ ì €ì¥ ì™„ë£Œ");
    alert(j.message || "ì €ì¥ ì™„ë£Œ");
    loadPublishList();
  }catch(e){
    addGenErr("ì„œë²„ ì—°ê²° ì‹¤íŒ¨");
    alert("ì„œë²„ ì—°ê²° ì‹¤íŒ¨!");
  }
}

function fmtMaybe(o, keys){ for(const k of keys){ if(o && o[k]) return String(o[k]); } return "-"; }
async function loadPublishList(){
  const box=document.getElementById("publishList");
  box.innerHTML=`<div class="small">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>`;
  try{
    const res=await fetch(API_BASE+"/api/publish/list");
    const data=await res.json();
    const items=data.items||[];
    if(!items.length){ box.innerHTML=`<div class="small">ìš”ì²­ 0ê°œ</div>`; return; }

    let html=`<div class="small">ì´ <b>${items.length}</b>ê°œ</div>`;
    items.slice().reverse().forEach(it=>{
      html += `
        <div class="box" style="margin-top:8px">
          <b>ğŸ“ ${escapeHtml(fmtMaybe(it,["topic"]))}</b>
          <div class="small" style="margin-top:6px;line-height:1.6">
            ğŸ—‚ï¸ ${escapeHtml(fmtMaybe(it,["blog_type"]))} / ğŸ”— ${escapeHtml(fmtMaybe(it,["blog_url"]))}<br/>
            ğŸ·ï¸ ${escapeHtml(fmtMaybe(it,["category"]))} / â±ï¸ ${escapeHtml(fmtMaybe(it,["created_at"]))}
          </div>
        </div>
      `;
    });
    box.innerHTML=html;
  }catch(e){
    box.innerHTML=`<div class="small" style="color:var(--danger)">ì„œë²„ ì—°ê²° ì‹¤íŒ¨</div>`;
  }
}

/* ---------------- OAuth Start (front only) ---------------- */
function oauthStart(){
  // ì„œë²„ì—ì„œ OAuth ì‹œì‘ URLì„ ë§Œë“¤ì–´ì¤˜ì•¼ í•¨
  window.open(API_BASE + "/oauth/start", "_blank");
}

/* ---------------- init ---------------- */
setProgress(0);
render();
updateSel();
</script>
</body>
</html>
