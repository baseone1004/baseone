<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>BaseOne</title>
  <style>
    :root{
      --bg:#0b1020;
      --panel:#141a30;
      --panel2:#0f1530;
      --text:#eef2ff;
      --muted:#cfd6ff;
      --border:rgba(255,255,255,.10);
      --border2:rgba(255,255,255,.12);
      --primary:#4f8cff;
    }

    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif;
      background:
        radial-gradient(1100px 560px at 20% 0%, rgba(79,140,255,.18), transparent 55%),
        radial-gradient(1100px 560px at 85% 10%, rgba(156,115,255,.10), transparent 55%),
        var(--bg);
      color:var(--text);
      font-size:14px;
    }
    .wrap{max-width:1080px;margin:0 auto}

    .top{display:flex;justify-content:space-between;align-items:center;padding:14px;gap:10px;flex-wrap:wrap}

    .btn{
      padding:8px 12px;border-radius:10px;border:1px solid var(--border2);
      background:#1f2a44;color:white;font-weight:800;cursor:pointer;
      transition:transform .05s ease, filter .15s ease;
      font-size:13px;
    }
    .btn:hover{filter:brightness(1.06)}
    .btn:active{transform:translateY(1px)}
    .btn.blue{background:var(--primary);border:none}
    .btn.gray{background:#555;border:none}

    .pill{
      display:inline-block;padding:5px 9px;border-radius:999px;background:var(--panel2);
      border:1px solid var(--border2);color:var(--muted);font-size:12px
    }

    .box{
      background:rgba(20,26,48,.92);
      border:1px solid var(--border);
      margin:12px 14px;
      padding:12px;
      border-radius:16px;
      box-shadow: 0 10px 28px rgba(0,0,0,.20);
      backdrop-filter: blur(6px);
    }

    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:space-between}

    input, select{
      padding:9px 10px;border-radius:10px;border:1px solid rgba(255,255,255,.14);
      background:var(--panel2);color:white;min-width:170px;
      font-size:13px;
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(6,1fr);
      gap:9px;
      padding:0 14px 12px;
    }
    @media(max-width:1100px){.grid{grid-template-columns:repeat(5,1fr)}}
    @media(max-width:980px){.grid{grid-template-columns:repeat(4,1fr)}}
    @media(max-width:820px){.grid{grid-template-columns:repeat(2,1fr)}}

    .cat{
      background:rgba(15,21,48,.75);
      border:1px solid rgba(255,255,255,.10);
      padding:10px 10px;
      border-radius:16px;
      cursor:pointer;
      display:flex;justify-content:space-between;align-items:flex-start;gap:10px;
      transition:transform .08s ease, border-color .15s ease, filter .15s ease;
      min-height:62px;
    }
    .cat:hover{
      transform:translateY(-1px);
      border-color:rgba(79,140,255,.38);
      filter:brightness(1.06);
    }
    .cat b{font-size:13px;letter-spacing:-.2px}
    .cat .small{font-size:12px;color:var(--muted);opacity:.95;margin-top:4px}
    .badge{
      font-size:12px;color:var(--muted);
      background:rgba(20,26,48,.9);
      border:1px solid rgba(255,255,255,.12);
      padding:3px 7px;border-radius:999px;
      white-space:nowrap;
    }

    .small{font-size:12.5px;color:var(--muted)}
    .hintBox{background:var(--panel2);border:1px solid rgba(255,255,255,.10);padding:9px;border-radius:12px}

    .card{
      background:var(--panel2);
      border:1px solid rgba(255,255,255,.10);
      padding:10px 10px;border-radius:14px;margin-bottom:9px;
      display:flex;justify-content:space-between;gap:10px;align-items:center
    }
    .card .btn{padding:7px 10px;font-size:12.5px;border-radius:10px}
    .cardTitle{display:flex;align-items:center;gap:8px}

    .starBtn{
      border:1px solid rgba(255,255,255,.12);
      background:rgba(20,26,48,.55);
      color:var(--muted);
      border-radius:10px;
      padding:7px 10px;
      font-size:12.5px;
      cursor:pointer;
      font-weight:900;
      transition:filter .15s ease, transform .05s ease;
    }
    .starBtn:hover{filter:brightness(1.08)}
    .starBtn:active{transform:translateY(1px)}
    .starBtn.on{
      background:rgba(255,215,0,.12);
      border-color:rgba(255,215,0,.35);
      color:#ffe8a3;
    }

    .topicScroll{
      max-height: 330px;
      overflow-y: auto;
      padding-right: 6px;
      margin-top: 8px;
    }
    .topicScroll::-webkit-scrollbar{width:10px}
    .topicScroll::-webkit-scrollbar-thumb{background:#273455;border-radius:10px}
    .topicScroll::-webkit-scrollbar-track{background:var(--panel2);border-radius:10px}

    .modalBg{display:none; position:fixed; inset:0; background:rgba(0,0,0,.6); padding:16px;}
    .modal{
      max-width:860px;margin:32px auto;background:var(--panel);
      border:1px solid rgba(255,255,255,.12);border-radius:18px;padding:12px;
      box-shadow: 0 20px 60px rgba(0,0,0,.35);
    }
    textarea{
      width:100%;min-height:210px;background:var(--panel2);
      border:1px solid rgba(255,255,255,.14);border-radius:12px;color:white;padding:10px;
      font-size:13px;
    }

    .reqCard{
      background:var(--panel2);
      border:1px solid rgba(255,255,255,.10);
      border-radius:14px;
      padding:10px;
      margin-top:9px;
    }
    .reqTop{display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;align-items:center}
    .reqTitle{font-weight:900}
    .reqMeta{font-size:12px;color:var(--muted);margin-top:6px;line-height:1.5}
    .reqBadge{
      font-size:12px;color:var(--muted);background:#141a30;border:1px solid rgba(255,255,255,.12);
      padding:3px 7px;border-radius:999px
    }

    .tabs{display:flex;gap:7px;flex-wrap:wrap}
    .tab{
      padding:7px 9px;border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(15,21,48,.7);
      color:var(--muted);
      cursor:pointer;font-weight:900;font-size:12px;
    }
    .tab.active{
      background:rgba(79,140,255,.22);
      border-color:rgba(79,140,255,.45);
      color:var(--text);
    }
    .mini{font-size:12px;color:var(--muted);opacity:.95}
    .mini code{
      background:rgba(15,21,48,.8);
      border:1px solid rgba(255,255,255,.10);
      padding:2px 6px;border-radius:8px;
    }

    .secTitle{display:flex;align-items:center;gap:8px}
    .chip{
      display:inline-flex;align-items:center;gap:6px;
      padding:4px 9px;border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(15,21,48,.75);
      color:var(--muted);
      font-size:12px;
    }

    .previewGrid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
      margin-top:10px;
    }
    @media(max-width:900px){.previewGrid{grid-template-columns:1fr}}
    .previewCard{
      background:rgba(15,21,48,.75);
      border:1px solid rgba(255,255,255,.10);
      border-radius:16px;
      padding:10px;
    }
    .previewHead{
      display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
      margin-bottom:8px;
    }
    .previewTitle{font-weight:900}
    .previewMeta{font-size:12px;color:var(--muted);opacity:.95}
    .previewText{
      width:100%;
      min-height:180px;
      background:var(--panel2);
      border:1px solid rgba(255,255,255,.12);
      border-radius:12px;
      padding:10px;
      color:var(--text);
      font-size:13px;
      line-height:1.6;
      white-space:pre-wrap;
      overflow:auto;
    }
  </style>
</head>

<body>
  <div class="wrap">

    <div class="top">
      <div style="display:flex;align-items:center;gap:10px">
        <div style="width:32px;height:32px;border-radius:10px;background:var(--primary);display:flex;align-items:center;justify-content:center;font-weight:900">B</div>
        <div>
          <div style="font-size:20px;font-weight:900;line-height:1">BaseOne âœ¨</div>
          <div class="small">ğŸ§  ì£¼ì œ ì¹´ë“œ â†’ âœï¸ í”„ë¡¬í”„íŠ¸ ìƒì„± â†’ ğŸ“¦ ë°œí–‰ìš”ì²­ ì €ì¥</div>
        </div>
      </div>
      <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
        <span class="pill">ğŸ›°ï¸ ì„œë²„: <b id="sv">-</b></span>
        <a href="/settings"><button class="btn">âš™ï¸ ì„¤ì •</button></a>
        <button class="btn blue" onclick="makeMoney()">ğŸ’° ìˆ˜ìµí˜• ì£¼ì œ 100</button>
      </div>
    </div>

    <div class="box">
      <div class="row">
        <div>
          <div class="secTitle">
            <b>ğŸ—‚ï¸ ë¸”ë¡œê·¸ ì„ íƒ</b>
            <span class="chip">blogspot / naver / tistory</span>
          </div>
          <div class="small">ì„ íƒí•œ ë¸”ë¡œê·¸ í”Œë«í¼ì— ë§ê²Œ í…œí”Œë¦¿ì´ ìë™ ì ìš©ë¼ìš”.</div>
        </div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
          <select id="blogSelect" style="min-width:320px"></select>
          <button class="btn" onclick="loadBlogsToSelect()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        </div>
      </div>
      <div class="small" style="margin-top:8px">
        âœ… í˜„ì¬ ì„ íƒ: <b id="blogNow">-</b>
      </div>
    </div>

    <div class="box">
      <div class="row">
        <div>
          <div class="secTitle">
            <b>ğŸ§© í”Œë«í¼ë³„ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿</b>
            <span class="chip">ì €ì¥/ìˆ˜ì • ê°€ëŠ¥</span>
          </div>
          <div class="small">í‹°ìŠ¤í† ë¦¬/ë„¤ì´ë²„/ë¸”ë¡œê·¸ìŠ¤íŒŸ í…œí”Œë¦¿ì„ ê°ê° ì €ì¥í•´ë‘ê³  ì“°ì„¸ìš”.</div>
        </div>
        <div class="tabs" id="promptTabs"></div>
      </div>

      <div class="mini" style="margin-top:10px">
        ë³€ìˆ˜:
        <code>{{topic}}</code> <code>{{category}}</code> <code>{{title}}</code>
        <code>{{image_url}}</code> <code>{{image_prompt}}</code> <code>{{body_prompt}}</code>
      </div>

      <div style="margin-top:10px">
        <div class="small"><b>ğŸ“ ë³¸ë¬¸ í…œí”Œë¦¿</b></div>
        <textarea id="tplBody" style="min-height:150px"></textarea>
      </div>

      <div style="margin-top:10px">
        <div class="small"><b>ğŸ–¼ï¸ ì´ë¯¸ì§€ í…œí”Œë¦¿(ì„ íƒ)</b></div>
        <textarea id="tplImage" style="min-height:105px"></textarea>
      </div>

      <div class="row" style="margin-top:10px">
        <div class="small">í˜„ì¬ ì ìš©: <b id="tplNow">-</b></div>
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <button class="btn" onclick="saveTemplates()">ğŸ’¾ ì €ì¥</button>
          <button class="btn gray" onclick="resetTemplates()">â™»ï¸ ê¸°ë³¸ê°’</button>
        </div>
      </div>
    </div>

    <div class="box">
      <div class="row">
        <div>
          <div class="secTitle">
            <b>ğŸ§  ì£¼ì œ ìƒì„±</b>
            <span class="chip">ê²€ìƒ‰/ë³µì‚¬/ì¦ê²¨ì°¾ê¸°</span>
          </div>
          <div class="small">ì•„ë˜ ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ë©´ ì£¼ì œ ëª©ë¡ì´ ìƒì„±ë©ë‹ˆë‹¤.</div>
        </div>

        <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
          <input id="filter" placeholder="ğŸ” ì£¼ì œ ê²€ìƒ‰ (â­ë§Œ: star)" oninput="render()">
          <button class="btn" onclick="copyAll()">ğŸ“‹ ì „ì²´ë³µì‚¬</button>
          <button class="btn" onclick="showStarOnly()">â­ ì¦ê²¨ì°¾ê¸°ë§Œ</button>
          <button class="btn blue" onclick="aiGenerateSelected()">âœ¨ AI ìƒì„±</button>
        </div>
      </div>
    </div>

    <div class="grid" id="catGrid"></div>

    <div class="box">
      <div class="row">
        <div>
          <div class="secTitle">
            <b>ğŸ“š ì£¼ì œ ëª©ë¡</b>
            <span class="chip">ì¹´ë“œí˜•</span>
          </div>
          <div class="small" id="selInfo">ì„ íƒ ì£¼ì œ: -</div>
        </div>
        <div class="hintBox small">âœ… ë¸”ë¡œê·¸ ë°”ê¾¸ê³  ë‹¤ë¥¸ ì£¼ì œ ì„ íƒ â†’ ë˜ ë°œí–‰ ê°€ëŠ¥!</div>
      </div>

      <div class="topicScroll" id="topics"></div>

      <!-- âœ… ì£¼ì œëª©ë¡ ì•„ë˜ ê¸€ì‘ì„± ì‹œì‘ -->
      <div class="row" style="margin-top:10px">
        <div class="small">âœï¸ ì•„ë˜ ë²„íŠ¼ â†’ ë¡œê·¸ í‘œì‹œ + í…œí”Œë¦¿ ì ìš© ê²°ê³¼ ìƒì„±</div>
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <button class="btn blue" onclick="startWriting()">âœï¸ ê¸€ì‘ì„± ì‹œì‘</button>
        </div>
      </div>

      <!-- âœ… ë¯¸ë¦¬ë³´ê¸° -->
      <div id="previewBox" style="display:none; margin-top:10px;">
        <div class="previewGrid">
          <div class="previewCard">
            <div class="previewHead">
              <div>
                <div class="previewTitle">ğŸ“ ë³¸ë¬¸ í”„ë¡¬í”„íŠ¸ ë¯¸ë¦¬ë³´ê¸°</div>
                <div class="previewMeta" id="previewMeta">-</div>
              </div>
              <button class="btn" onclick="copyText(document.getElementById('previewBody').textContent)">ğŸ“‹ ë³¸ë¬¸ ë³µì‚¬</button>
            </div>
            <div class="previewText" id="previewBody"></div>
          </div>

          <div class="previewCard">
            <div class="previewHead">
              <div>
                <div class="previewTitle">ğŸ–¼ï¸ ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ ë¯¸ë¦¬ë³´ê¸°</div>
                <div class="previewMeta" id="previewMeta2">-</div>
              </div>
              <button class="btn" onclick="copyText(document.getElementById('previewImage').textContent)">ğŸ“‹ ì´ë¯¸ì§€ ë³µì‚¬</button>
            </div>
            <div class="previewText" id="previewImage"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="box" id="genBox" style="display:none; margin-top:12px;">
      <div class="row">
        <b>ğŸ§¾ ê¸€ì‘ì„± ì§„í–‰ìƒí™©</b>
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <button class="btn gray" onclick="clearGenLog()">ğŸ§¹ ì§€ìš°ê¸°</button>
          <button class="btn" onclick="toggleGenBox()">ğŸ‘€ ìˆ¨ê¸°ê¸°/ë³´ì´ê¸°</button>
        </div>
      </div>
      <div class="small" style="margin-top:8px;opacity:.9">ë¡œê·¸ëŠ” â€œê¸€ì‘ì„± ì‹œì‘ / AI ìƒì„±â€ ì‹œ ìë™ìœ¼ë¡œ ìŒ“ì…ë‹ˆë‹¤.</div>
      <div id="genLog" style="
          margin-top:10px;
          background:#0f1530;
          border:1px solid rgba(255,255,255,.10);
          border-radius:14px;
          padding:12px;
          max-height:210px;
          overflow:auto;
          font-size:12.8px;
          line-height:1.6;
      "></div>
    </div>

    <div class="box">
      <div class="secTitle">
        <b>ğŸš€ ë°œí–‰</b>
        <span class="chip">ìš”ì²­ ì €ì¥</span>
      </div>
      <div class="small" style="margin-top:6px">â€» ì§€ê¸ˆì€ â€œì‹¤ì œ ì—…ë¡œë“œâ€ê°€ ì•„ë‹ˆë¼, ì„œë²„ì— â€œë°œí–‰ ìš”ì²­ì„ ì €ì¥â€í•©ë‹ˆë‹¤.</div>

      <div class="row" style="margin-top:10px">
        <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
          <button class="btn blue" onclick="scheduleDaily3()">ğŸ“… í•˜ë£¨ 3ê°œ ì˜ˆì•½(08/13/18)</button>
          <span class="small">â° 08:00 / 13:00 / 18:00</span>
        </div>
      </div>

      <div class="row" style="margin-top:12px">
        <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
          <label class="small">â±ï¸ ì‹œì‘</label>
          <input id="startTime" type="time" value="09:00" style="min-width:130px">
          <label class="small">â†”ï¸ ê°„ê²©</label>
          <select id="intervalHours" style="min-width:110px">
            <option value="1">1ì‹œê°„</option><option value="2">2ì‹œê°„</option><option value="3">3ì‹œê°„</option>
            <option value="4">4ì‹œê°„</option><option value="5">5ì‹œê°„</option><option value="6">6ì‹œê°„</option>
          </select>
          <button class="btn" onclick="publishNowInterval()">ğŸš€ ì¦‰ì‹œ ë°œí–‰(ê°„ê²©)</button>
        </div>
        <div class="small">ì˜ˆ) 09:00 ì‹œì‘ + 2ì‹œê°„ ê°„ê²©</div>
      </div>

      <div class="row" style="margin-top:14px">
        <div>
          <div class="secTitle">
            <b>ğŸ“¦ ë°œí–‰ìš”ì²­ ë¦¬ìŠ¤íŠ¸</b>
            <span class="chip">ì„œë²„ ì €ì¥ë¶„</span>
          </div>
          <div class="small">ì €ì¥ëœ ìš”ì²­ì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.</div>
        </div>
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <button class="btn" onclick="loadPublishList()">ğŸ“¥ ë¶ˆëŸ¬ì˜¤ê¸°</button>
          <button class="btn gray" onclick="clearPublishList()">ğŸ§¹ ì§€ìš°ê¸°</button>
        </div>
      </div>
      <div id="publishList" style="margin-top:10px"></div>
    </div>

  </div>

  <!-- ëª¨ë‹¬ -->
  <div class="modalBg" id="modalBg">
    <div class="modal">
      <div class="row" style="justify-content:space-between">
        <b>âœ¨ AI ìƒì„± ê²°ê³¼</b>
        <button class="btn gray" onclick="closeModal()">ë‹«ê¸°</button>
      </div>

      <div class="box" style="margin:10px 0">
        <div class="row">
          <div class="small">ì œëª©</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn" onclick="copyText(document.getElementById('outTitle').textContent)">ğŸ“‹ ì œëª© ë³µì‚¬</button>
            <button class="btn" onclick="copyText(document.getElementById('outImage').value)">ğŸ–¼ï¸ ì´ë¯¸ì§€ ë³µì‚¬</button>
            <button class="btn blue" onclick="copyText(document.getElementById('outBody').value)">ğŸ“ ë³¸ë¬¸ ë³µì‚¬</button>
          </div>
        </div>
        <div style="margin-top:6px;font-weight:bold" id="outTitle">-</div>
        <div class="small" id="outMeta" style="margin-top:6px">-</div>
      </div>

      <div class="box" style="margin:10px 0">
        <div class="small"><b>ğŸ–¼ï¸ ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸(í…œí”Œë¦¿ ì ìš©)</b></div>
        <textarea id="outImage"></textarea>
      </div>

      <div class="box" style="margin:10px 0">
        <div class="small"><b>ğŸ“ ë³¸ë¬¸ í”„ë¡¬í”„íŠ¸(í…œí”Œë¦¿ ì ìš©)</b></div>
        <textarea id="outBody"></textarea>
      </div>
    </div>
  </div>

  <script>
    // API_BASE
    function getApiBase(){
      const d = JSON.parse(localStorage.getItem("baseone_settings_v3") || "{}");
      const base = (d.backend || "http://127.0.0.1:5000").trim();
      return base.replace(/\/+$/,"");
    }
    const API_BASE = getApiBase();
    document.addEventListener("DOMContentLoaded", ()=>{
      const el = document.getElementById("sv");
      if(el) el.textContent = API_BASE;
    });

    // Utils
    function escapeHtml(s){
      return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
    }
    function escapeAttr(s){
      return String(s).replaceAll("\\","\\\\").replaceAll("'","\\'");
    }
    function safeStr(x){ return (x===undefined || x===null) ? "" : String(x); }
    function applyTemplate(tpl, vars){
      let out = safeStr(tpl);
      Object.keys(vars).forEach(k=>{
        out = out.replaceAll(`{{${k}}}`, safeStr(vars[k]));
      });
      return out;
    }
    function copyText(t){ navigator.clipboard.writeText(t); alert("ë³µì‚¬ ì™„ë£Œ!"); }

    // Logs
    function showGenBox(){
      const box = document.getElementById("genBox");
      if(box) box.style.display = "block";
    }
    function toggleGenBox(){
      const box = document.getElementById("genBox");
      if(!box) return;
      box.style.display = (box.style.display === "none" ? "block" : "none");
    }
    function addGenLine(icon, color, msg){
      showGenBox();
      const log = document.getElementById("genLog");
      if(!log) return;
      const t = new Date();
      const time = String(t.getHours()).padStart(2,"0")+":"+String(t.getMinutes()).padStart(2,"0")+":"+String(t.getSeconds()).padStart(2,"0");
      log.innerHTML += `<div style="color:${color}">${icon} <b>[${time}]</b> ${escapeHtml(msg)}</div>`;
      log.scrollTop = log.scrollHeight;
    }
    function addGenLog(msg){ addGenLine("ğŸŸ¦","#eef2ff",msg); }
    function addGenOk(msg){ addGenLine("âœ…","#9ff5d2",msg); }
    function addGenErr(msg){ addGenLine("âŒ","#ffb4b4",msg); }
    function clearGenLog(){ const log=document.getElementById("genLog"); if(log) log.innerHTML=""; }

    // Categories
    const CATS=[
      {k:"ê±´ê°•", s:"ğŸƒ ìš´ë™Â·ì˜ì–‘Â·ìƒí™œ"},
      {k:"ì»´í“¨í„°/IT", s:"ğŸ’» ìœ í‹¸Â·ë³´ì•ˆÂ·ê°€ì´ë“œ"},
      {k:"ìë™ì°¨", s:"ğŸš— ì •ë¹„Â·ë³´í—˜Â·íŒ"},
      {k:"ìƒí™œ/ê°€ì „", s:"ğŸ  ì‚´ë¦¼Â·ê°€ì „Â·ì ˆì•½"},
      {k:"ìœ¡ì•„", s:"ğŸ¼ ìœ¡ì•„í…œÂ·êµìœ¡"},
      {k:"ëˆ/ì¬í…Œí¬", s:"ğŸ’° ì ˆì•½Â·íˆ¬ìÂ·ì„¸ê¸ˆ"},
      {k:"ì—¬í–‰", s:"ğŸ§³ ì½”ìŠ¤Â·ê¿€íŒ"},
      {k:"ìš”ë¦¬", s:"ğŸ³ ë ˆì‹œí”¼Â·ì¥ë³´ê¸°"},
      {k:"ìê¸°ê³„ë°œ", s:"ğŸ“ˆ ìŠµê´€Â·ëª©í‘œ"},
      {k:"ê³µë¶€/ìê²©ì¦", s:"ğŸ“š ì‹œí—˜Â·í•©ê²©"},
      {k:"ë°˜ë ¤ë™ë¬¼", s:"ğŸ¶ ì¼€ì–´Â·ìš©í’ˆ"},
      {k:"íŒ¨ì…˜/ë·°í‹°", s:"ğŸ’„ ê´€ë¦¬Â·ì¶”ì²œ"},
      {k:"ì·¨ë¯¸", s:"ğŸ¨ DIYÂ·ì·¨ë¯¸"},
      {k:"ìŠ¤í¬ì¸ ", s:"ğŸ‹ï¸ ë£¨í‹´Â·ìš´ë™"},
      {k:"ê²Œì„", s:"ğŸ® ë¦¬ë·°Â·íŒ"},
      {k:"ì˜í™”/ë“œë¼ë§ˆ", s:"ğŸ¬ ì¶”ì²œÂ·ë¦¬ë·°"}
    ];

    let topics=[];
    let selectedTopic="";
    let selectedCat="";

    // Stars
    const STAR_KEY = "baseone_fav_topics_v1";
    function getStars(){
      try{
        const s = JSON.parse(localStorage.getItem(STAR_KEY) || "[]");
        return Array.isArray(s) ? s : [];
      }catch(e){ return []; }
    }
    function setStars(arr){ localStorage.setItem(STAR_KEY, JSON.stringify(arr)); }
    function isStar(t){ return getStars().includes(t); }
    function toggleStar(t){
      const s = getStars();
      const idx = s.indexOf(t);
      if(idx>=0) s.splice(idx,1);
      else s.unshift(t);
      setStars(s.slice(0,300));
      render();
    }
    function showStarOnly(){
      document.getElementById("filter").value = "star";
      render();
    }

    // Build category grid
    const grid = document.getElementById("catGrid");
    CATS.forEach(obj=>{
      const d=document.createElement("div");
      d.className="cat";
      d.onclick=()=>makeTopics(obj.k);
      d.innerHTML = `
        <div>
          <b>${obj.k}</b>
          <div class="small">${obj.s}</div>
        </div>
        <span class="badge">50</span>
      `;
      grid.appendChild(d);
    });

    function makeTopics(cat){
      selectedCat = cat;
      topics=[];
      for(let i=1;i<=50;i++) topics.push(`${cat} ê¸€ ì•„ì´ë””ì–´ ${i}`);
      selectedTopic = topics[0] || "";
      updateSel();
      render();
    }

    function makeMoney(){
      topics=[];
      selectedCat = "ìˆ˜ìµí˜•";
      const base=[
        "ë³´í—˜","ì¹´ë“œ","í†µì‹ ë¹„","ì „ê¸°ìš”ê¸ˆ","ê°€ìŠ¤ìš”ê¸ˆ","ë Œíƒˆ","ëŒ€ì¶œ","ì´ì","ì„¸ê¸ˆ","ì—°ê¸ˆ",
        "ë‹¤ì´ì–´íŠ¸","ì˜ì–‘ì œ","íƒˆëª¨","í”¼ë¶€","ê±´ê°•ê²€ì§„","ìœ¡ì•„í…œ","ê°€ì „","ì²­ì†Œ","ìë™ì°¨ë³´í—˜","ì¤‘ê³ ì°¨"
      ];
      for(let i=1;i<=100;i++) topics.push(`ìˆ˜ìµí˜• ì£¼ì œ ${i}: ${base[i%base.length]}`);
      selectedTopic = topics[0] || "";
      updateSel();
      render();
    }

    function updateSel(){
      document.getElementById("selInfo").textContent = `ì„ íƒ ì£¼ì œ: ${selectedTopic ? selectedTopic : "-"}`;
    }

    function setSelected(t){ selectedTopic = t; updateSel(); }

    function render(){
      const q=(document.getElementById("filter").value||"").trim().toLowerCase();
      const list=document.getElementById("topics");
      list.innerHTML="";

      let filtered = topics;

      if(q === "star"){
        const s = getStars();
        filtered = s.slice();
        if(!filtered.length){
          list.innerHTML = `<div class="small">â­ ì¦ê²¨ì°¾ê¸°í•œ ì£¼ì œê°€ ì•„ì§ ì—†ì–´ìš”. ì£¼ì œ ì¹´ë“œì—ì„œ â­ ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”.</div>`;
          return;
        }
      }else if(q){
        filtered = topics.filter(t=>t.toLowerCase().includes(q));
      }

      filtered.forEach(t=>{
        const starOn = isStar(t);
        const d=document.createElement("div");
        d.className="card";
        d.innerHTML = `
          <div style="flex:1">
            <div class="cardTitle">
              <span>${starOn ? "â­" : "â˜†"}</span>
              <div>${escapeHtml(t)}</div>
            </div>
            <div class="small">${selectedCat ? `ğŸ·ï¸ ${selectedCat}` : ""}</div>
          </div>
          <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
            <button class="starBtn ${starOn ? "on":""}" onclick="toggleStar('${escapeAttr(t)}')">${starOn ? "â­ ì €ì¥ë¨" : "â˜† ì¦ê²¨ì°¾ê¸°"}</button>
            <button class="btn" onclick="setSelected('${escapeAttr(t)}')">âœ… ì„ íƒ</button>
            <button class="btn" onclick="copyText('${escapeAttr(t)}')">ğŸ“‹ ë³µì‚¬</button>
          </div>
        `;
        list.appendChild(d);
      });
    }

    function copyAll(){
      if(!topics.length){alert("ì£¼ì œ ì—†ìŒ");return;}
      navigator.clipboard.writeText(topics.join("\n"));
      alert("ì „ì²´ ë³µì‚¬ ì™„ë£Œ!");
    }

    // Blogs select
    function loadBlogsToSelect(){
      const sel = document.getElementById("blogSelect");
      const now = document.getElementById("blogNow");
      sel.innerHTML = "";

      const s = JSON.parse(localStorage.getItem("baseone_settings_v2") || "{}");
      const blogs = s.blogs || { blogspot:[], naver:[], tistory:[] };

      const options = [];
      (blogs.blogspot||[]).filter(Boolean).forEach((u,i)=> options.push({type:"blogspot", url:u, label:`ğŸŸ¦ ë¸”ë¡œê·¸ìŠ¤íŒŸ ${i+1} - ${u}`}));
      (blogs.naver||[]).filter(Boolean).forEach((u,i)=> options.push({type:"naver", url:u, label:`ğŸŸ© ë„¤ì´ë²„ ${i+1} - ${u}`}));
      (blogs.tistory||[]).filter(Boolean).forEach((u,i)=> options.push({type:"tistory", url:u, label:`ğŸŸ§ í‹°ìŠ¤í† ë¦¬ ${i+1} - ${u}`}));

      if(options.length===0){
        const opt=document.createElement("option");
        opt.value="";
        opt.textContent="ì €ì¥ëœ ë¸”ë¡œê·¸ ì£¼ì†Œ ì—†ìŒ â†’ ì„¤ì •ì—ì„œ ì €ì¥í•˜ì„¸ìš”";
        sel.appendChild(opt);
        now.textContent = "-";
        return;
      }

      options.forEach(o=>{
        const opt=document.createElement("option");
        opt.value = JSON.stringify({type:o.type, url:o.url});
        opt.textContent = o.label;
        sel.appendChild(opt);
      });

      const last = localStorage.getItem("baseone_last_blog");
      if(last){
        for(let i=0;i<sel.options.length;i++){
          if(sel.options[i].value === last){ sel.selectedIndex = i; break; }
        }
      }
      updateBlogNow();
    }

    function updateBlogNow(){
      const sel = document.getElementById("blogSelect");
      const now = document.getElementById("blogNow");
      const v = sel.value;
      if(!v){ now.textContent="-"; return; }
      localStorage.setItem("baseone_last_blog", v);
      try{
        const obj = JSON.parse(v);
        now.textContent = `${obj.type} / ${obj.url}`;
        setPromptTab(obj.type);
      }catch(e){
        now.textContent = "-";
      }
    }

    document.addEventListener("change",(e)=>{
      if(e.target && e.target.id==="blogSelect"){ updateBlogNow(); }
    });

    loadBlogsToSelect();

    // Prompt templates
    const PROMPT_KEY = "baseone_prompts_v1";
    const PLATFORMS = [
      {k:"blogspot", label:"ğŸŸ¦ ë¸”ë¡œê·¸ìŠ¤íŒŸ"},
      {k:"naver", label:"ğŸŸ© ë„¤ì´ë²„"},
      {k:"tistory", label:"ğŸŸ§ í‹°ìŠ¤í† ë¦¬"},
    ];
    let currentPlatform = "blogspot";

    function defaultTemplates(){
      return {
        blogspot:{
          body:
`ë„ˆëŠ” ë¸”ë¡œê·¸ìŠ¤íŒŸ ì „ë¬¸ ì‘ê°€ì•¼.
ì£¼ì œ: {{topic}}
ì¹´í…Œê³ ë¦¬: {{category}}

ì•„ë˜ í”„ë¡¬í”„íŠ¸ë¥¼ ë°”íƒ•ìœ¼ë¡œ SEOì— ê°•í•œ í•œêµ­ì–´ ê¸€ì„ ì‘ì„±í•´ì¤˜.
- ë„ì… 3~5ë¬¸ì¥(í›„í‚¹)
- ì†Œì œëª©(H2) 5~7ê°œ
- ì²´í¬ë¦¬ìŠ¤íŠ¸/í‘œ 1ê°œ
- ê²°ë¡  + CTA 2ë¬¸ì¥
- ê³¼ì¥/í—ˆìœ„ ê¸ˆì§€

[ê¸°ë³¸ ë³¸ë¬¸ í”„ë¡¬í”„íŠ¸]
{{body_prompt}}`,
          image:
`ëŒ€í‘œ ì´ë¯¸ì§€ ì•ˆë‚´:
- 16:9 ê¶Œì¥, ë°ê³  ê¹”ë”í•œ ì¸ë„¤ì¼
- í…ìŠ¤íŠ¸ ìµœì†Œ

[ê¸°ë³¸ ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸/URL]
{{image_prompt}}
{{image_url}}`
        },
        naver:{
          body:
`ë„ˆëŠ” ë„¤ì´ë²„ ë¸”ë¡œê·¸ ì „ë¬¸ ì‘ê°€ì•¼.
ì£¼ì œ: {{topic}}
ì¹´í…Œê³ ë¦¬: {{category}}

ë„¤ì´ë²„ ìŠ¤íƒ€ì¼ë¡œ ê°€ë…ì„± ìˆê²Œ ì‘ì„±í•´ì¤˜.
- ì§§ì€ ë¬¸ì¥/ì¤„ë°”ê¿ˆ ìì£¼
- ì†Œì œëª©(H2) 5~7ê°œ
- í•µì‹¬ ìš”ì•½ ë°•ìŠ¤ 1ê°œ
- ë§ˆì§€ë§‰ì— Q&A 3ê°œ

[ê¸°ë³¸ ë³¸ë¬¸ í”„ë¡¬í”„íŠ¸]
{{body_prompt}}`,
          image:
`ë„¤ì´ë²„ìš© ëŒ€í‘œ ì´ë¯¸ì§€:
- ê¹”ë”í•œ ì‚¬ì§„ ëŠë‚Œ
- ê³¼í•œ íš¨ê³¼ ê¸ˆì§€

[ê¸°ë³¸ ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸/URL]
{{image_prompt}}
{{image_url}}`
        },
        tistory:{
          body:
`ë„ˆëŠ” í‹°ìŠ¤í† ë¦¬ ì „ë¬¸ ì‘ê°€ì•¼.
ì£¼ì œ: {{topic}}
ì¹´í…Œê³ ë¦¬: {{category}}

í‹°ìŠ¤í† ë¦¬/êµ¬ê¸€ ê²€ìƒ‰ì— ê°•í•œ êµ¬ì„±ìœ¼ë¡œ ì‘ì„±í•´ì¤˜.
- ëª©ì°¨(TOC) ë§Œë“¤ ìˆ˜ ìˆê²Œ êµ¬ì¡°í™”
- ì†Œì œëª©(H2) 6ê°œ ë‚´ì™¸
- ì¤‘ê°„ì— "ìš”ì•½" ì„¹ì…˜
- ë§ˆì§€ë§‰ì— ë‚´ë¶€ë§í¬ ìœ ë„

[ê¸°ë³¸ ë³¸ë¬¸ í”„ë¡¬í”„íŠ¸]
{{body_prompt}}`,
          image:
`í‹°ìŠ¤í† ë¦¬ ëŒ€í‘œ ì´ë¯¸ì§€:
- ì‹¬í”Œ/ê³ ê¸‰/ì—¬ë°±
- 1200px ì´ìƒ ê¶Œì¥

[ê¸°ë³¸ ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸/URL]
{{image_prompt}}
{{image_url}}`
        }
      };
    }

    function getTemplates(){
      try{
        const saved = JSON.parse(localStorage.getItem(PROMPT_KEY) || "null");
        if(saved && typeof saved === "object") return saved;
      }catch(e){}
      const d = defaultTemplates();
      localStorage.setItem(PROMPT_KEY, JSON.stringify(d));
      return d;
    }
    function setTemplates(obj){ localStorage.setItem(PROMPT_KEY, JSON.stringify(obj)); }

    function renderPromptTabs(){
      const wrap = document.getElementById("promptTabs");
      wrap.innerHTML = "";
      PLATFORMS.forEach(p=>{
        const b = document.createElement("button");
        b.className = "tab" + (p.k===currentPlatform ? " active": "");
        b.textContent = p.label;
        b.onclick = ()=> setPromptTab(p.k);
        wrap.appendChild(b);
      });
    }

    function setPromptTab(k){
      if(!PLATFORMS.some(p=>p.k===k)) return;
      currentPlatform = k;
      const tpls = getTemplates();
      const body = (tpls[k] && tpls[k].body) ? tpls[k].body : "";
      const image = (tpls[k] && tpls[k].image) ? tpls[k].image : "";
      document.getElementById("tplBody").value = body;
      document.getElementById("tplImage").value = image;
      document.getElementById("tplNow").textContent = PLATFORMS.find(p=>p.k===k)?.label || k;
      renderPromptTabs();
    }

    function saveTemplates(){
      const tpls = getTemplates();
      tpls[currentPlatform] = tpls[currentPlatform] || {};
      tpls[currentPlatform].body = document.getElementById("tplBody").value || "";
      tpls[currentPlatform].image = document.getElementById("tplImage").value || "";
      setTemplates(tpls);
      alert("ì €ì¥ ì™„ë£Œ!");
    }

    function resetTemplates(){
      const d = defaultTemplates();
      setTemplates(d);
      setPromptTab(currentPlatform);
      alert("ê¸°ë³¸ê°’ìœ¼ë¡œ ë³µêµ¬ ì™„ë£Œ!");
    }

    renderPromptTabs();
    setPromptTab(currentPlatform);

    function getSelectedBlog(){
      const v = document.getElementById("blogSelect").value;
      if(!v) return null;
      try{ return JSON.parse(v); }catch(e){ return null; }
    }

    // Writing
    function startWriting(){
      if(!selectedTopic){
        alert("ë¨¼ì € ì£¼ì œë¥¼ ì„ íƒí•˜ì„¸ìš”!");
        return;
      }
      showGenBox();
      addGenLog("âœï¸ ê¸€ì‘ì„± ì‹œì‘ í´ë¦­");
      addGenLog("ğŸ§© ì„ íƒ ë¸”ë¡œê·¸ íƒ€ì… í…œí”Œë¦¿ ì ìš© í›„ ìƒì„±í•©ë‹ˆë‹¤â€¦");
      aiGenerateSelected();
    }

    async function aiGenerateSelected(){
      if(!selectedTopic){ alert("ë¨¼ì € ì£¼ì œë¥¼ ì„ íƒí•˜ì„¸ìš”!"); return; }

      const blog = getSelectedBlog();
      const blogType = blog?.type || "blogspot";
      setPromptTab(blogType);

      addGenLog(`ğŸ›°ï¸ ì„œë²„: ${API_BASE}`);
      addGenLog(`ğŸ—‚ï¸ ë¸”ë¡œê·¸: ${blogType}`);
      addGenLog(`ğŸ§  ì£¼ì œ: ${selectedTopic}`);
      addGenLog(`ğŸ·ï¸ ì¹´í…Œê³ ë¦¬: ${selectedCat || "-"}`);

      const s = JSON.parse(localStorage.getItem("baseone_settings_v2") || "{}");
      const payload = {
        topic: selectedTopic,
        category: selectedCat,
        blog: blogType,
        img_provider: (s.imgProvider || "pexels"),
        pexels_key: (s.pexelsKey || "")
      };

      addGenLog("ğŸ“¡ /api/generate ìš”ì²­ ì¤‘â€¦");

      try{
        const res = await fetch(API_BASE + "/api/generate", {
          method:"POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify(payload)
        });

        if(!res.ok){
          const t = await res.text();
          addGenErr("âŒ AI ìƒì„± ì‹¤íŒ¨: " + t);
          alert("ìƒì„± ì‹¤íŒ¨: " + t);
          return;
        }

        addGenLog("ğŸ“¥ ì‘ë‹µ ìˆ˜ì‹  ì¤‘â€¦");
        const data = await res.json();

        if(data.image_url){
          addGenOk("ğŸ–¼ï¸ ì´ë¯¸ì§€ URL ì°¾ìŒ");
          addGenLog(data.image_url);
        }else{
          addGenLog("ğŸ–¼ï¸ ì´ë¯¸ì§€ URL ì—†ìŒ(ê²€ìƒ‰ 0ê±´ì¼ ìˆ˜ ìˆìŒ)");
        }

        addGenOk("âœ… í”„ë¡¬í”„íŠ¸ ìƒì„± ì™„ë£Œ(í…œí”Œë¦¿ ì ìš©)");
        openModalWithTemplates(data, blogType);
        renderPreviewWithTemplates(data, blogType);

      }catch(e){
        addGenErr("âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨");
        alert("ì„œë²„ ì—°ê²° ì‹¤íŒ¨! ì„¤ì •ì˜ ì„œë²„ ì£¼ì†Œ(API_BASE)ê°€ ë§ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.");
      }
    }

    function openModalWithTemplates(data, blogType){
      const tpls = getTemplates();
      const tpl = (tpls[blogType] || tpls["blogspot"] || {body:"{{body_prompt}}", image:"{{image_prompt}}\n{{image_url}}"});

      const vars = {
        topic: data.topic || selectedTopic || "",
        category: data.category || selectedCat || "",
        title: data.title || "",
        image_url: data.image_url || "",
        image_prompt: data.image_prompt || "",
        body_prompt: data.body_prompt || ""
      };

      const appliedBody = applyTemplate(tpl.body || "{{body_prompt}}", vars);
      const appliedImage = applyTemplate(tpl.image || "{{image_prompt}}\n{{image_url}}", vars);

      document.getElementById("outTitle").textContent = data.title || "-";
      document.getElementById("outMeta").textContent =
        `ğŸ§  ${vars.topic} / ğŸ·ï¸ ${vars.category} / ğŸ—‚ï¸ ${blogType} / â±ï¸ ${data.generated_at || ""}`;

      document.getElementById("outImage").value = appliedImage;
      document.getElementById("outBody").value = appliedBody;
      document.getElementById("modalBg").style.display="block";
    }

    function renderPreviewWithTemplates(data, blogType){
      const box = document.getElementById("previewBox");
      if(!box) return;

      const tpls = getTemplates();
      const tpl = (tpls[blogType] || tpls["blogspot"] || {body:"{{body_prompt}}", image:"{{image_prompt}}\n{{image_url}}"});

      const vars = {
        topic: data.topic || selectedTopic || "",
        category: data.category || selectedCat || "",
        title: data.title || "",
        image_url: data.image_url || "",
        image_prompt: data.image_prompt || "",
        body_prompt: data.body_prompt || ""
      };

      const appliedBody = applyTemplate(tpl.body || "{{body_prompt}}", vars);
      const appliedImage = applyTemplate(tpl.image || "{{image_prompt}}\n{{image_url}}", vars);

      document.getElementById("previewMeta").textContent = `ğŸ—‚ï¸ ${blogType} / â±ï¸ ${data.generated_at || ""}`;
      document.getElementById("previewMeta2").textContent = `ğŸ—‚ï¸ ${blogType} / â±ï¸ ${data.generated_at || ""}`;
      document.getElementById("previewBody").textContent = appliedBody;
      document.getElementById("previewImage").textContent = appliedImage;

      box.style.display = "block";
    }

    function closeModal(){ document.getElementById("modalBg").style.display="none"; }

    // Publish
    async function scheduleDaily3(){
      const blog = getSelectedBlog();
      if(!blog){ alert("ë¸”ë¡œê·¸ ì„ íƒì´ í•„ìš”í•©ë‹ˆë‹¤. (ì„¤ì •ì—ì„œ ì£¼ì†Œ ì €ì¥)"); return; }
      if(!selectedTopic){ alert("ì£¼ì œë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”!"); return; }

      const payload = {
        blog_type: blog.type,
        blog_url: blog.url,
        category: selectedCat,
        topic: selectedTopic,
        schedule_times: ["08:00","13:00","18:00"]
      };

      try{
        const res = await fetch(API_BASE + "/api/publish/schedule",{
          method:"POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify(payload)
        });
        const data = await res.json();
        if(!data.ok){ alert("ì‹¤íŒ¨: " + (data.error || "unknown")); return; }
        alert(data.message || "ì €ì¥ ì™„ë£Œ");
        loadPublishList();
      }catch(e){
        alert("ì„œë²„ ì—°ê²° ì‹¤íŒ¨!");
      }
    }

    async function publishNowInterval(){
      const blog = getSelectedBlog();
      if(!blog){ alert("ë¸”ë¡œê·¸ ì„ íƒì´ í•„ìš”í•©ë‹ˆë‹¤. (ì„¤ì •ì—ì„œ ì£¼ì†Œ ì €ì¥)"); return; }
      if(!selectedTopic){ alert("ì£¼ì œë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”!"); return; }

      const start_time = document.getElementById("startTime").value;
      const interval_hours = document.getElementById("intervalHours").value;

      const payload = {
        blog_type: blog.type,
        blog_url: blog.url,
        category: selectedCat,
        topic: selectedTopic,
        start_time,
        interval_hours
      };

      try{
        const res = await fetch(API_BASE + "/api/publish/now",{
          method:"POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify(payload)
        });
        const data = await res.json();
        if(!data.ok){ alert("ì‹¤íŒ¨: " + (data.error || "unknown")); return; }
        alert(data.message || "ì €ì¥ ì™„ë£Œ");
        loadPublishList();
      }catch(e){
        alert("ì„œë²„ ì—°ê²° ì‹¤íŒ¨!");
      }
    }

    function clearPublishList(){
      const box = document.getElementById("publishList");
      if(box) box.innerHTML = "";
    }
    function fmtMaybe(o, keys){
      for(const k of keys){
        if(o && o[k]) return String(o[k]);
      }
      return "-";
    }

    async function loadPublishList(){
      const box = document.getElementById("publishList");
      if(!box) return;

      box.innerHTML = `<div class="small">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>`;

      try{
        const res = await fetch(API_BASE + "/api/publish/list");
        if(!res.ok){
          const t = await res.text();
          box.innerHTML = `<div class="small" style="color:#ffb4b4">ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ${escapeHtml(t)}</div>`;
          return;
        }
        const data = await res.json();

        const items = data.items || [];
        const count = (typeof data.count === "number") ? data.count : items.length;

        if(!items.length){
          box.innerHTML = `<div class="small">ìš”ì²­ 0ê°œ (ë¹ˆ ë¦¬ìŠ¤íŠ¸)</div>`;
          return;
        }

        let html = `<div class="small">ì´ <b>${count}</b>ê°œ</div>`;

        items.slice().forEach((it)=>{
          const topic = fmtMaybe(it, ["topic","title","subject"]);
          const cat = fmtMaybe(it, ["category","cat"]);
          const blogType = fmtMaybe(it, ["blog_type","blogType","type"]);
          const blogUrl = fmtMaybe(it, ["blog_url","blogUrl","url"]);
          const created = fmtMaybe(it, ["created_at","createdAt","time","requested_at"]);
          const when = fmtMaybe(it, ["schedule_times","start_time","when","schedule"]);
          const mode = fmtMaybe(it, ["type","mode","kind","publish_type"]);

          html += `
            <div class="reqCard">
              <div class="reqTop">
                <div class="reqTitle">ğŸ“ ${escapeHtml(topic)}</div>
                <span class="reqBadge">ğŸ—‚ï¸ ${escapeHtml(blogType)}</span>
              </div>
              <div class="reqMeta">
                ğŸ·ï¸ ì¹´í…Œê³ ë¦¬: <b>${escapeHtml(cat)}</b><br/>
                ğŸ”— ë¸”ë¡œê·¸: ${escapeHtml(blogUrl)}<br/>
                âš™ï¸ ë°©ì‹: ${escapeHtml(mode)} / â° ì‹œê°„: ${escapeHtml(when)}<br/>
                ğŸ•’ ìƒì„±: ${escapeHtml(created)}
              </div>
            </div>
          `;
        });

        box.innerHTML = html;

      }catch(e){
        box.innerHTML = `<div class="small" style="color:#ffb4b4">ì„œë²„ ì—°ê²° ì‹¤íŒ¨</div>`;
      }
    }

    // init
    render();
    updateSel();
  </script>
</body>
</html>
