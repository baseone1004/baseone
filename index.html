<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BaseOne</title>
<style>
  body{margin:0;font-family:sans-serif;background:#0b1020;color:#eef2ff}
  .top{display:flex;justify-content:space-between;align-items:center;padding:16px;gap:10px;flex-wrap:wrap}
  .btn{padding:10px 14px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:#1f2a44;color:white;font-weight:bold;cursor:pointer}
  .btn.blue{background:#4f8cff;border:none}
  .btn.gray{background:#555;border:none}
  .wrap{max-width:1100px;margin:0 auto}
  .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;padding:0 16px 16px}
  @media(max-width:900px){.grid{grid-template-columns:repeat(2,1fr)}}
  .cat{background:#141a30;border:1px solid rgba(255,255,255,.10);padding:14px;border-radius:16px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;gap:12px}
  .cat b{font-size:15px}
  .badge{font-size:12px;color:#cfd6ff;background:#0f1530;border:1px solid rgba(255,255,255,.12);padding:4px 8px;border-radius:999px}
  .box{background:#141a30;border:1px solid rgba(255,255,255,.10);margin:16px;padding:14px;border-radius:16px}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:space-between}
  .card{background:#0f1530;border:1px solid rgba(255,255,255,.10);padding:12px;border-radius:14px;margin-bottom:10px;display:flex;justify-content:space-between;gap:10px;align-items:center}
  .small{font-size:13px;color:#cfd6ff}
  input, select{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.14);background:#0f1530;color:white;min-width:200px}
  .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:#0f1530;border:1px solid rgba(255,255,255,.12);color:#cfd6ff;font-size:12px}
  .modalBg{display:none; position:fixed; inset:0; background:rgba(0,0,0,.6); padding:18px;}
  .modal{max-width:860px;margin:40px auto;background:#141a30;border:1px solid rgba(255,255,255,.12);border-radius:18px;padding:14px}
  textarea{width:100%;min-height:220px;background:#0f1530;border:1px solid rgba(255,255,255,.14);border-radius:12px;color:white;padding:10px}
</style>
</head>
<body>
<div class="wrap">

  <div class="top">
    <div style="display:flex;align-items:center;gap:10px">
      <div style="width:34px;height:34px;border-radius:10px;background:#4f8cff;display:flex;align-items:center;justify-content:center;font-weight:900">B</div>
      <div>
        <div style="font-size:22px;font-weight:900;line-height:1">BaseOne</div>
        <div class="small">ì¹´í…Œê³ ë¦¬/ìˆ˜ìµí˜• ì£¼ì œë¥¼ ì¹´ë“œë¡œ ë§Œë“¤ê³ , ë³µì‚¬í•˜ê±°ë‚˜(ë˜ëŠ” ë¡œì»¬ ì„œë²„ë¡œ) AI ìƒì„± í…ŒìŠ¤íŠ¸ë¥¼ í•  ìˆ˜ ìˆì–´ìš”.</div>
      </div>
    </div>
    <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
      <span class="pill">ì„œë²„: <b id="sv">-</b></span>
      <a href="/settings"><button class="btn">ì„¤ì •</button></a>
      <button class="btn blue" onclick="makeMoney()">ğŸ’° ìˆ˜ìµí˜• ì£¼ì œ 100</button>
    </div>
  </div>

  <div class="box">
    <div class="row">
      <div>
        <b id="titleBox">ì£¼ì œ ìƒì„±</b>
        <div class="small">ì•„ë˜ì—ì„œ ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”.</div>
      </div>
      <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
        <input id="filter" placeholder="ì£¼ì œ ê²€ìƒ‰(í•„í„°)" oninput="render()">
        <button class="btn" onclick="copyAll()">ì „ì²´ë³µì‚¬</button>
        <button class="btn blue" onclick="aiGenerateSelected()">âœ¨ AI ìƒì„±(ì„ íƒ ì£¼ì œ)</button>
      </div>
    </div>
  </div>

  <div class="grid" id="catGrid"></div>

  <div class="box">
    <div class="row">
      <div>
        <b>ì£¼ì œ ëª©ë¡</b>
        <div class="small" id="selInfo">ì„ íƒí•œ ì£¼ì œê°€ ì—¬ê¸° ì¹´ë“œë¡œ ë‚˜ì™€ìš”.</div>
      </div>

      <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
        <select id="blogSelect"></select>
      </div>
    </div>

    <div id="topics" style="margin-top:10px"></div>
  </div>

  <div class="box">
    <b>ë°œí–‰</b>
    <div class="small" style="margin-top:6px">â€» ì§€ê¸ˆì€ â€œì‹¤ì œ ì—…ë¡œë“œâ€ê°€ ì•„ë‹ˆë¼, ì„œë²„ì— â€œë°œí–‰ ìš”ì²­ì„ ì €ì¥â€í•©ë‹ˆë‹¤. (queue íŒŒì¼ì— ê¸°ë¡ë¨)</div>

    <div class="row" style="margin-top:10px">
      <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
        <button class="btn blue" onclick="scheduleDaily3()">ğŸ“… í•˜ë£¨ 3ê°œ ì˜ˆì•½(08/13/18)</button>
        <span class="small">ì‹œê°„ ê³ ì •: 08:00 / 13:00 / 18:00</span>
      </div>
    </div>

    <div class="row" style="margin-top:12px">
      <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
        <label class="small">ì‹œì‘ ì‹œê°„</label>
        <input id="startTime" type="time" value="09:00" style="min-width:140px">
        <label class="small">ê°„ê²©(ì‹œê°„)</label>
        <select id="intervalHours" style="min-width:120px">
          <option value="1">1ì‹œê°„</option>
          <option value="2">2ì‹œê°„</option>
          <option value="3">3ì‹œê°„</option>
          <option value="4">4ì‹œê°„</option>
          <option value="5">5ì‹œê°„</option>
          <option value="6">6ì‹œê°„</option>
        </select>
        <button class="btn" onclick="publishNowInterval()">ğŸš€ ì¦‰ì‹œ ë°œí–‰(ê°„ê²© ì ìš©)</button>
      </div>
      <div class="small">ì˜ˆ) 09:00 ì‹œì‘ + 2ì‹œê°„ ê°„ê²©</div>
    </div>
  </div>

</div>

<!-- ê²°ê³¼ ëª¨ë‹¬ -->
<div class="modalBg" id="modalBg">
  <div class="modal">
    <div class="row" style="justify-content:space-between">
      <b>AI ìƒì„± ê²°ê³¼</b>
      <button class="btn gray" onclick="closeModal()">ë‹«ê¸°</button>
    </div>

    <div class="box" style="margin:12px 0">
      <div class="row">
        <div class="small">ì œëª©</div>
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <button class="btn" onclick="copyText(document.getElementById('outTitle').textContent)">ì œëª© ë³µì‚¬</button>
          <button class="btn" onclick="copyText(document.getElementById('outImage').value)">ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ ë³µì‚¬</button>
          <button class="btn blue" onclick="copyText(document.getElementById('outBody').value)">ë³¸ë¬¸ í”„ë¡¬í”„íŠ¸ ë³µì‚¬</button>
        </div>
      </div>
      <div style="margin-top:6px;font-weight:bold" id="outTitle">-</div>
      <div class="small" id="outMeta" style="margin-top:6px">-</div>
    </div>

    <div class="box" style="margin:12px 0">
      <div class="small"><b>ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸</b></div>
      <textarea id="outImage"></textarea>
    </div>

    <div class="box" style="margin:12px 0">
      <div class="small"><b>ë³¸ë¬¸ í”„ë¡¬í”„íŠ¸</b></div>
      <textarea id="outBody"></textarea>
    </div>
  </div>
</div>

<script>
  // ====== ì¹´í…Œê³ ë¦¬ ======
  const CATS=[
    {k:"ê±´ê°•", s:"ìš´ë™Â·ì˜ì–‘Â·ìƒí™œê´€ë¦¬"},
    {k:"ì»´í“¨í„°/IT", s:"ìœ í‹¸Â·ë³´ì•ˆÂ·ê°€ì´ë“œ"},
    {k:"ìë™ì°¨", s:"ì •ë¹„Â·ë³´í—˜Â·íŒ"},
    {k:"ìƒí™œ/ê°€ì „", s:"ì‚´ë¦¼Â·ê°€ì „Â·ì ˆì•½"},
    {k:"ìœ¡ì•„", s:"ìœ¡ì•„í…œÂ·êµìœ¡"},
    {k:"ëˆ/ì¬í…Œí¬", s:"ì ˆì•½Â·íˆ¬ìÂ·ì„¸ê¸ˆ"},
    {k:"ì—¬í–‰", s:"ì½”ìŠ¤Â·ê¿€íŒ"},
    {k:"ìš”ë¦¬", s:"ë ˆì‹œí”¼Â·ì¥ë³´ê¸°"},
    {k:"ìê¸°ê³„ë°œ", s:"ìŠµê´€Â·ëª©í‘œ"},
    {k:"ê³µë¶€/ìê²©ì¦", s:"ì‹œí—˜Â·í•©ê²©"},
    {k:"ë°˜ë ¤ë™ë¬¼", s:"ì¼€ì–´Â·ìš©í’ˆ"},
    {k:"íŒ¨ì…˜/ë·°í‹°", s:"ê´€ë¦¬Â·ì¶”ì²œ"},
    {k:"ì·¨ë¯¸", s:"ì·¨ë¯¸Â·DIY"},
    {k:"ìŠ¤í¬ì¸ ", s:"ìš´ë™Â·ë£¨í‹´"},
    {k:"ê²Œì„", s:"ë¦¬ë·°Â·íŒ"},
    {k:"ì˜í™”/ë“œë¼ë§ˆ", s:"ì¶”ì²œÂ·ë¦¬ë·°"}
  ];

  let topics=[];
  let selectedTopic = "";
  let selectedCat = "";

  const grid=document.getElementById("catGrid");
  CATS.forEach(obj=>{
    const d=document.createElement("div");
    d.className="cat";
    d.onclick=()=>makeTopics(obj.k);
    d.innerHTML = `
      <div>
        <b>${obj.k}</b>
        <div class="small">${obj.s}</div>
      </div>
      <span class="badge">50ê°œ</span>
    `;
    grid.appendChild(d);
  });

  // ====== ì„œë²„ í‘œì‹œ ======
  document.getElementById("sv").textContent = "http://127.0.0.1:5000";

  // ====== ë¸”ë¡œê·¸ ëª©ë¡(ì„¤ì •ì—ì„œ ì½ê¸°) ======
  function loadBlogsToSelect(){
    const sel = document.getElementById("blogSelect");
    sel.innerHTML = "";

    const s = JSON.parse(localStorage.getItem("baseone_settings_v2") || "{}");
    const blogs = s.blogs || { blogspot:[], naver:[], tistory:[] };

    const options = [];
    (blogs.blogspot||[]).forEach((u,i)=> options.push({type:"blogspot", url:u, label:`ë¸”ë¡œê·¸ìŠ¤íŒŸ ${i+1} - ${u}`}));
    (blogs.naver||[]).forEach((u,i)=> options.push({type:"naver", url:u, label:`ë„¤ì´ë²„ ${i+1} - ${u}`}));
    (blogs.tistory||[]).forEach((u,i)=> options.push({type:"tistory", url:u, label:`í‹°ìŠ¤í† ë¦¬ ${i+1} - ${u}`}));

    if(options.length===0){
      const opt=document.createElement("option");
      opt.value="";
      opt.textContent="ë¸”ë¡œê·¸ ì„ íƒ(ì €ì¥ëœ ì£¼ì†Œ ì—†ìŒ) â†’ ì„¤ì •ì—ì„œ ì €ì¥í•˜ì„¸ìš”";
      sel.appendChild(opt);
      return;
    }

    const first=document.createElement("option");
    first.value="";
    first.textContent="ë¸”ë¡œê·¸ ì„ íƒ(ì €ì¥ëœ ì£¼ì†Œ)";
    sel.appendChild(first);

    options.forEach(o=>{
      const opt=document.createElement("option");
      opt.value = JSON.stringify({type:o.type, url:o.url});
      opt.textContent = o.label;
      sel.appendChild(opt);
    });
  }
  loadBlogsToSelect();

  // ====== ì£¼ì œ ìƒì„± ======
  function makeTopics(cat){
    selectedCat = cat;
    topics=[];
    for(let i=1;i<=50;i++){
      topics.push(`${cat} ê¸€ ì•„ì´ë””ì–´ ${i}`);
    }
    selectedTopic = topics[0] || "";
    updateSel();
    render();
  }

  function makeMoney(){
    topics=[];
    selectedCat = "ìˆ˜ìµí˜•";
    const base=[
      "ë³´í—˜", "ì¹´ë“œ", "í†µì‹ ë¹„", "ì „ê¸°ìš”ê¸ˆ", "ê°€ìŠ¤ìš”ê¸ˆ", "ë Œíƒˆ", "ëŒ€ì¶œ", "ì´ì", "ì„¸ê¸ˆ", "ì—°ê¸ˆ",
      "ë‹¤ì´ì–´íŠ¸", "ì˜ì–‘ì œ", "íƒˆëª¨", "í”¼ë¶€", "ê±´ê°•ê²€ì§„", "ìœ¡ì•„í…œ", "ê°€ì „", "ì²­ì†Œ", "ìë™ì°¨ë³´í—˜", "ì¤‘ê³ ì°¨"
    ];
    for(let i=1;i<=100;i++){
      topics.push(`ìˆ˜ìµí˜• ì£¼ì œ ${i}: ${base[i%base.length]}`);
    }
    selectedTopic = topics[0] || "";
    updateSel();
    render();
  }

  function updateSel(){
    document.getElementById("selInfo").textContent = `ì„ íƒ ì£¼ì œ: ${selectedTopic ? selectedTopic : "-"}`;
  }

  function render(){
    const q=(document.getElementById("filter").value||"").trim().toLowerCase();
    const list=document.getElementById("topics");
    list.innerHTML="";
    const filtered = q ? topics.filter(t=>t.toLowerCase().includes(q)) : topics;

    filtered.forEach(t=>{
      const d=document.createElement("div");
      d.className="card";
      d.innerHTML = `
        <div style="flex:1">
          <div>${escapeHtml(t)}</div>
          <div class="small">${selectedCat || ""}</div>
        </div>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn" onclick="setSelected('${escapeAttr(t)}')">ì„ íƒ</button>
          <button class="btn" onclick="copyText('${escapeAttr(t)}')">ë³µì‚¬</button>
        </div>
      `;
      list.appendChild(d);
    });
  }

  function setSelected(t){
    selectedTopic = t;
    updateSel();
  }

  function copyText(t){
    navigator.clipboard.writeText(t);
    alert("ë³µì‚¬ ì™„ë£Œ!");
  }

  function copyAll(){
    if(!topics.length){alert("ì£¼ì œ ì—†ìŒ");return;}
    navigator.clipboard.writeText(topics.join("\n"));
    alert("ì „ì²´ ë³µì‚¬ ì™„ë£Œ!");
  }

  // ====== AI ìƒì„±(ì„œë²„ í˜¸ì¶œ) ======
  async function aiGenerateSelected(){
    if(!selectedTopic){ alert("ë¨¼ì € ì£¼ì œë¥¼ ì„ íƒí•˜ì„¸ìš”!"); return; }

    const s = JSON.parse(localStorage.getItem("baseone_settings_v2") || "{}");
    const payload = {
      topic: selectedTopic,
      category: selectedCat,
      blog: "local",
      img_provider: (s.imgProvider || "pexels"),
      pexels_key: (s.pexelsKey || "")
    };

    try{
      const res = await fetch("http://127.0.0.1:5000/api/generate", {
        method:"POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(payload)
      });

      if(!res.ok){
        const t = await res.text();
        alert("ìƒì„± ì‹¤íŒ¨: " + t);
        return;
      }

      const data = await res.json();
      openModal(data);

    }catch(e){
      alert("ì„œë²„ ì—°ê²° ì‹¤íŒ¨! ì„œë²„ê°€ ì¼œì ¸ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.\n\n(ì„œë²„ ì‹¤í–‰: python server.py)");
    }
  }

  function openModal(data){
    document.getElementById("outTitle").textContent = data.title || "-";
    document.getElementById("outMeta").textContent = `ì£¼ì œ: ${data.topic || ""} / ì¹´í…Œê³ ë¦¬: ${data.category || ""} / ìƒì„±ì‹œê°„: ${data.generated_at || ""}`;
    document.getElementById("outImage").value = (data.image_url ? `ì´ë¯¸ì§€ URL: ${data.image_url}\n\n` : "") + (data.image_prompt || "");
    document.getElementById("outBody").value = data.body_prompt || "";
    document.getElementById("modalBg").style.display="block";
  }

  function closeModal(){
    document.getElementById("modalBg").style.display="none";
  }

  // ====== ë°œí–‰ ê¸°ëŠ¥ (ì„œë²„ì— ì €ì¥) ======
  function getSelectedBlog(){
    const v = document.getElementById("blogSelect").value;
    if(!v) return null;
    try{
      return JSON.parse(v); // {type, url}
    }catch(e){
      return null;
    }
  }

  async function scheduleDaily3(){
    const blog = getSelectedBlog();
    if(!blog){ alert("ë¨¼ì € ë¸”ë¡œê·¸ë¥¼ ì„ íƒí•˜ì„¸ìš”(ì„¤ì •ì—ì„œ ì£¼ì†Œ ì €ì¥ í•„ìš”)"); return; }
    if(!selectedTopic){ alert("ë¨¼ì € ì£¼ì œë¥¼ ì„ íƒí•˜ì„¸ìš”!"); return; }

    const payload = {
      blog_type: blog.type,
      blog_url: blog.url,
      category: selectedCat,
      topic: selectedTopic,
      schedule_times: ["08:00","13:00","18:00"]
    };

    try{
      const res = await fetch("http://127.0.0.1:5000/api/publish/schedule",{
        method:"POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      if(!data.ok){ alert("ì‹¤íŒ¨: " + (data.error || "unknown")); return; }
      alert(data.message);
    }catch(e){
      alert("ì„œë²„ ì—°ê²° ì‹¤íŒ¨! (python server.py ì‹¤í–‰ í•„ìš”)");
    }
  }

  async function publishNowInterval(){
    const blog = getSelectedBlog();
    if(!blog){ alert("ë¨¼ì € ë¸”ë¡œê·¸ë¥¼ ì„ íƒí•˜ì„¸ìš”(ì„¤ì •ì—ì„œ ì£¼ì†Œ ì €ì¥ í•„ìš”)"); return; }
    if(!selectedTopic){ alert("ë¨¼ì € ì£¼ì œë¥¼ ì„ íƒí•˜ì„¸ìš”!"); return; }

    const start_time = document.getElementById("startTime").value;
    const interval_hours = document.getElementById("intervalHours").value;

    const payload = {
      blog_type: blog.type,
      blog_url: blog.url,
      category: selectedCat,
      topic: selectedTopic,
      start_time,
      interval_hours
    };

    try{
      const res = await fetch("http://127.0.0.1:5000/api/publish/now",{
        method:"POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      if(!data.ok){ alert("ì‹¤íŒ¨: " + (data.error || "unknown")); return; }
      alert(data.message);
    }catch(e){
      alert("ì„œë²„ ì—°ê²° ì‹¤íŒ¨! (python server.py ì‹¤í–‰ í•„ìš”)");
    }
  }

  function escapeHtml(s){
    return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
  }
  function escapeAttr(s){
    return String(s).replaceAll("\\","\\\\").replaceAll("'","\\'");
  }

  // ìµœì´ˆ ë Œë”
  render();
  updateSel();
</script>
</body>
</html>
