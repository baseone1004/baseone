<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>BaseOne</title>
  <style>
    :root{--bg:#0f1630;--panel:rgba(255,255,255,.06);--panel2:rgba(255,255,255,.08);--text:#f8faff;--muted:rgba(248,250,255,.75);--border:rgba(255,255,255,.14);--primary:#7aa7ff;--good:#38e1c1;--danger:#ff7b7b;--shadow:0 10px 24px rgba(0,0,0,.22);}
    body{margin:0;font-family:system-ui,-apple-system,"Noto Sans KR",Segoe UI,Roboto,sans-serif;background:linear-gradient(180deg,var(--bg),#0a1022);color:var(--text);font-size:13px}
    .wrap{max-width:980px;margin:0 auto;padding:12px}
    .top{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;padding:8px 4px}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:34px;height:34px;border-radius:12px;background:linear-gradient(135deg,var(--primary),var(--good));display:flex;align-items:center;justify-content:center;font-weight:900;color:#fff;box-shadow:var(--shadow)}
    .title{font-size:18px;font-weight:900;line-height:1}
    .subtitle{font-size:12px;color:var(--muted);margin-top:4px}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid var(--border);color:var(--muted);font-size:12px}
    .box{background:var(--panel);border:1px solid var(--border);padding:12px;border-radius:16px;margin:10px 0;box-shadow:var(--shadow);backdrop-filter: blur(8px)}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:space-between}
    input, select, textarea{padding:9px 10px;border-radius:12px;border:1px solid var(--border);background:rgba(255,255,255,.06);color:var(--text);outline:none;font-size:12.5px}
    select{min-width:280px}
    textarea{width:100%;min-height:160px;line-height:1.6}
    .btn{padding:8px 11px;border-radius:12px;border:1px solid var(--border);background:rgba(255,255,255,.06);color:var(--text);cursor:pointer;font-weight:900;font-size:12px}
    .btn.primary{background:linear-gradient(135deg,var(--primary),#2f6bff);border:none;color:#fff}
    .btn.good{background:linear-gradient(135deg,var(--good),#1fb6ff);border:none;color:#fff}
    .btn.danger{background:rgba(255,107,107,.10);border:1px solid rgba(255,107,107,.35);color:var(--danger)}
    .small{font-size:12px;color:var(--muted)}
    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:10px}
    @media(max-width:900px){.grid{grid-template-columns:repeat(2,1fr)}}
    .cat{background:var(--panel2);border:1px solid var(--border);padding:10px;border-radius:14px;cursor:pointer}
    .list{max-height:320px;overflow:auto;margin-top:10px;padding-right:6px}
    .item{background:var(--panel2);border:1px solid var(--border);padding:10px;border-radius:14px;display:flex;justify-content:space-between;gap:10px;align-items:center;margin-bottom:8px;cursor:pointer}
    .item.active{border-color:rgba(122,167,255,.85);box-shadow:0 0 0 2px rgba(122,167,255,.18);background:linear-gradient(135deg, rgba(122,167,255,.12), rgba(56,225,193,.10))}
    .itemTitle{font-weight:900}
    .progWrap{margin-top:10px;border:1px solid var(--border);border-radius:999px;overflow:hidden;height:12px;background:rgba(255,255,255,.08)}
    .progBar{height:100%;width:0%;background:linear-gradient(90deg,var(--primary),var(--good));transition:width .2s ease}
    .two{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
    @media(max-width:900px){.two{grid-template-columns:1fr}}
    .card{background:var(--panel2);border:1px solid var(--border);border-radius:14px;padding:10px}
    .pre{margin-top:8px;border:1px solid var(--border);border-radius:12px;padding:10px;min-height:180px;white-space:pre-wrap;overflow:auto;background:rgba(0,0,0,.10)}
    .iframeWrap{margin-top:8px;background:#fff;border-radius:12px;overflow:hidden;border:1px solid var(--border);min-height:320px}
    iframe{width:100%;height:320px;border:0}
    #log{margin-top:10px;background:var(--panel2);border:1px solid var(--border);border-radius:12px;padding:10px;max-height:220px;overflow:auto;font-size:12px;line-height:1.6}
  </style>
</head>

<body>
<div class="wrap">
  <div class="top">
    <div class="brand">
      <div class="logo">B</div>
      <div>
        <div class="title">BaseOne</div>
        <div class="subtitle">ìˆ˜ìµí˜• ì£¼ì œ â†’ Gemini ê¸€ìƒì„± â†’ ë¸”ìŠ¤ ì¦‰ì‹œ/ì˜ˆì•½ë°œí–‰</div>
      </div>
    </div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
      <span class="pill">ğŸ›°ï¸ ì„œë²„ <b id="sv">-</b></span>
      <a href="/settings"><button class="btn">âš™ï¸ ì„¤ì •</button></a>
    </div>
  </div>

  <!-- ë¸”ë¡œê·¸ ì„ íƒ -->
  <div class="box">
    <div class="row">
      <div>
        <b>1) ë¸”ë¡œê·¸ ì„ íƒ</b>
        <div class="small">ì„¤ì •(v4)ì— ì €ì¥í•œ ë¸”ë¡œê·¸ê°€ ëœ¹ë‹ˆë‹¤.</div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
        <select id="blogSelect"></select>
        <button class="btn" onclick="loadBlogs()">ğŸ”„</button>
      </div>
    </div>
    <div class="small" style="margin-top:8px">âœ… í˜„ì¬ ì„ íƒ: <b id="blogNow">-</b></div>
    <div class="small" style="margin-top:6px" id="blogHint"></div>
  </div>

  <!-- ì£¼ì œ -->
  <div class="box">
    <div class="row">
      <div>
        <b>2) ìˆ˜ìµí˜• ì£¼ì œ</b>
        <div class="small">ì¹´í…Œê³ ë¦¬ í´ë¦­ ë˜ëŠ” â€œğŸ’° ìˆ˜ìµí˜• ì£¼ì œ ë½‘ê¸°â€</div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
        <input id="filter" placeholder="ğŸ” ê²€ìƒ‰" oninput="renderTopics()">
        <button class="btn" onclick="copyAll()">ğŸ“‹ ì „ì²´ë³µì‚¬</button>
        <button class="btn good" onclick="profitTopics()">ğŸ’° ìˆ˜ìµí˜• ì£¼ì œ ë½‘ê¸°</button>
        <button class="btn primary" onclick="aiGenerate()">âœ¨ Gemini ê¸€ ìƒì„±</button>
      </div>
    </div>

    <div class="grid" id="catGrid"></div>

    <div class="progWrap">
      <div class="progBar" id="progBar"></div>
    </div>
    <div class="small" id="progText" style="margin-top:6px">ì§„í–‰ë¥ : 0%</div>

    <div class="list" id="topicList"></div>
  </div>

  <!-- ë¯¸ë¦¬ë³´ê¸° + ë°œí–‰ -->
  <div class="box" id="previewBox" style="display:none">
    <div class="row">
      <div>
        <b>3) ë¯¸ë¦¬ë³´ê¸° / ë°œí–‰</b>
        <div class="small" id="previewMeta">-</div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
        <input id="runAt" placeholder="ì˜ˆì•½: 2026-01-22 14:30 (ë¹„ìš°ë©´ NOW)" style="min-width:280px"/>
        <button class="btn" onclick="openPreviewWindow()">ğŸ§¾ ìƒˆì°½</button>
        <button class="btn good" onclick="publishNow()">ğŸš€ ì¦‰ì‹œë°œí–‰/ì˜ˆì•½</button>
      </div>
    </div>

    <div class="two">
      <div class="card">
        <div style="font-weight:900">ğŸ“ ë³¸ë¬¸(HTML)</div>
        <div class="pre" id="finalBody"></div>
      </div>
      <div class="card">
        <div style="font-weight:900">ğŸ–¼ï¸ ì´ë¯¸ì§€</div>
        <div class="pre" id="finalImage"></div>
        <div style="margin-top:10px">
          <img id="previewImg" alt="preview" style="width:100%;border-radius:12px;border:1px solid var(--border);display:none"/>
          <div class="small" id="imgHint" style="margin-top:8px">ì´ë¯¸ì§€ URLì´ ìˆìœ¼ë©´ ì•„ë˜ì— ë³´ì…ë‹ˆë‹¤.</div>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top:10px">
      <div style="font-weight:900">ğŸ‘€ HTML ë¯¸ë¦¬ë³´ê¸°</div>
      <div class="iframeWrap"><iframe id="previewIframe"></iframe></div>
    </div>

    <div class="card" style="margin-top:10px">
      <div class="row">
        <b>ğŸ§¾ ë¡œê·¸</b>
        <button class="btn danger" onclick="clearLog()">ğŸ§¹ ì§€ìš°ê¸°</button>
      </div>
      <div id="log"></div>
    </div>
  </div>
</div>

<script>
const SETTINGS_KEY="baseone_settings_v4";
function S(){ return JSON.parse(localStorage.getItem(SETTINGS_KEY) || "{}"); }
function apiBase(){ return (S().backend || "http://127.0.0.1:5000").trim().replace(/\/+$/,""); }
const API_BASE = apiBase();
document.getElementById("sv").textContent = API_BASE;

function escapeHtml(s){return String(s||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");}
function setProgress(p){const v=Math.max(0,Math.min(100,Math.round(Number(p)||0)));document.getElementById("progBar").style.width=v+"%";document.getElementById("progText").textContent="ì§„í–‰ë¥ : "+v+"%";}
function logLine(icon,color,msg){
  const el=document.getElementById("log");
  const t=new Date(); const time=[t.getHours(),t.getMinutes(),t.getSeconds()].map(x=>String(x).padStart(2,"0")).join(":");
  el.innerHTML += `<div style="color:${color}">${icon} <b>[${time}]</b> ${escapeHtml(msg)}</div>`;
  el.scrollTop = el.scrollHeight;
}
function logInfo(m){logLine("ğŸŸ¦","var(--text)",m);}
function logOk(m){logLine("âœ…","var(--good)",m);}
function logErr(m){logLine("âŒ","var(--danger)",m);}
function clearLog(){document.getElementById("log").innerHTML="";setProgress(0);}

/* ---- Blogs ---- */
let BLOGSPOT_REMOTE = []; // serverì—ì„œ ê°€ì ¸ì˜¨ blog_id/url/name
function getAllBlogsFromSettings(){
  const d=S();
  return {
    blogspot: (d.blogspot||[]).filter(Boolean),
    naver: (d.naver||[]).filter(Boolean),
    tistory: (d.tistory||[]).filter(Boolean),
  };
}

async function tryLoadBloggerBlogs(){
  // OAuth ì—°ê²°ëœ ê²½ìš°ë§Œ
  try{
    const r = await fetch(API_BASE + "/api/blogger/blogs");
    if(!r.ok) return;
    const j = await r.json();
    BLOGSPOT_REMOTE = j.items || [];
  }catch(e){}
}

function loadBlogs(){
  const sel=document.getElementById("blogSelect");
  const now=document.getElementById("blogNow");
  const hint=document.getElementById("blogHint");
  sel.innerHTML="";

  const b = getAllBlogsFromSettings();
  const options=[];

  // blogspot: server list ìš°ì„  ë§¤ì¹­(ê°€ëŠ¥í•˜ë©´ blog_id í¬í•¨)
  b.blogspot.forEach((url,i)=>{
    const found = BLOGSPOT_REMOTE.find(x=>x.url===url);
    options.push({
      type:"blogspot",
      url,
      blog_id: found ? found.id : "",
      name: found ? found.name : "",
      label:`ğŸŸ¦ ë¸”ìŠ¤ ${i+1} - ${url}${found?(" ("+found.name+")"):" (OAuth ë¯¸ì—°ê²°/ë¯¸ë§¤ì¹­)"}`
    });
  });

  b.naver.forEach((url,i)=>options.push({type:"naver",url,label:`ğŸŸ© ë„¤ì´ë²„ ${i+1} - ${url}`}));
  b.tistory.forEach((url,i)=>options.push({type:"tistory",url,label:`ğŸŸ§ í‹°ìŠ¤í† ë¦¬ ${i+1} - ${url}`}));

  if(!options.length){
    const opt=document.createElement("option");
    opt.value="";
    opt.textContent="ì„¤ì •(/settings)ì—ì„œ ë¸”ë¡œê·¸ ì£¼ì†Œ ì €ì¥í•˜ì„¸ìš”";
    sel.appendChild(opt);
    now.textContent="-";
    hint.textContent="";
    return;
  }

  options.forEach(o=>{
    const opt=document.createElement("option");
    opt.value = JSON.stringify(o);
    opt.textContent = o.label;
    sel.appendChild(opt);
  });

  const last=localStorage.getItem("baseone_last_blog_v4");
  if(last){
    for(let i=0;i<sel.options.length;i++){
      if(sel.options[i].value===last){ sel.selectedIndex=i; break; }
    }
  }
  updateBlogNow();
}

function updateBlogNow(){
  const sel=document.getElementById("blogSelect");
  const now=document.getElementById("blogNow");
  const hint=document.getElementById("blogHint");
  const v=sel.value;
  if(!v){ now.textContent="-"; hint.textContent=""; return; }
  localStorage.setItem("baseone_last_blog_v4", v);
  const obj=JSON.parse(v);
  now.textContent = `${obj.type} / ${obj.url}`;

  if(obj.type==="blogspot"){
    hint.textContent = obj.blog_id
      ? "âœ… ë¸”ë¡œê·¸ìŠ¤íŒŸì€ OAuth ì—°ê²° ì‹œ ì¦‰ì‹œë°œí–‰/ì˜ˆì•½ë°œí–‰ì´ ìë™ìœ¼ë¡œ ë©ë‹ˆë‹¤."
      : "âš ï¸ blog_idê°€ ë¹„ì–´ìˆì–´ìš”. /settingsì—ì„œ OAuth ì—°ê²° í›„ ìƒˆë¡œê³ ì¹¨(ğŸ”„)í•˜ì„¸ìš”.";
  }else{
    hint.textContent = "âš ï¸ ë„¤ì´ë²„/í‹°ìŠ¤í† ë¦¬ëŠ” ì„œë²„ ìë™ë°œí–‰ì´ ë°”ë¡œ ë˜ì§€ ì•Šì„ ìˆ˜ ìˆì–´ìš”. (í ì €ì¥ì€ ê°€ëŠ¥)";
  }
}
document.addEventListener("change",(e)=>{ if(e.target && e.target.id==="blogSelect") updateBlogNow(); });
function getSelectedBlog(){ try{ return JSON.parse(document.getElementById("blogSelect").value||"null"); }catch(e){ return null; } }

/* ---- Topics ---- */
const CATS=[
  {k:"ëˆ/ì¬í…Œí¬", s:"ğŸ’° ê³ ì •ë¹„/ì„¸ê¸ˆ/ë³´í—˜"},
  {k:"ìƒí™œ/ê°€ì „", s:"ğŸ  ìš”ê¸ˆ/ì ˆì•½"},
  {k:"ì»´í“¨í„°/IT", s:"ğŸ’» ì†ë„/ë³´ì•ˆ"},
  {k:"ìë™ì°¨", s:"ğŸš— ë³´í—˜/ì •ë¹„ë¹„"},
  {k:"ê±´ê°•", s:"ğŸƒ ê²€ì§„/ì‹¤ë¹„"},
  {k:"ìê²©ì¦", s:"ğŸ“š ì·¨ì—…/ë¶€ì—…"},
  {k:"ì •ë¶€ì§€ì›", s:"ğŸ›ï¸ ì§€ì›ê¸ˆ/í˜œíƒ"},
  {k:"ì—¬í–‰", s:"ğŸ§³ ê²½ë¹„ì ˆê°"},
];
const catGrid=document.getElementById("catGrid");
let topics=[]; let selectedCat=""; let selectedTopicId="";
CATS.forEach(obj=>{
  const d=document.createElement("div");
  d.className="cat";
  d.onclick=()=>makeTopicsLocal(obj.k);
  d.innerHTML = `<b>${obj.k}</b><div class="small" style="margin-top:4px">${obj.s}</div>`;
  catGrid.appendChild(d);
});

function buildIdeas(cat,n=24){
  const hooks=["ì´ˆë³´ë„ ë°”ë¡œ ë˜ëŠ”","ì‹¤ìˆ˜ ì¤„ì´ëŠ”","ëˆ ì•„ë¼ëŠ”","ì˜¤ëŠ˜ë¶€í„° ì ìš©","ì²´í¬ë¦¬ìŠ¤íŠ¸ë¡œ ë","ëª¨ë¥´ë©´ ì†í•´ ë³´ëŠ”"];
  const bases={
    "ëˆ/ì¬í…Œí¬":["ì›” {x}ë§Œì› ê³ ì •ë¹„ ì¤„ì´ëŠ” ìˆœì„œ","ì—°ë§ì •ì‚° í™˜ê¸‰ ëŠ˜ë¦¬ëŠ” ê³µì œ í•­ëª©","ì‹ ìš©ì¹´ë“œ í˜œíƒ ìµœëŒ€ë¡œ ì“°ëŠ” ë²•","í†µì‹ ë¹„ ì¤„ì´ëŠ” 5ë‹¨ê³„","ë³´í—˜ë£Œ ì¤„ì´ëŠ” ì ê²€í‘œ"],
    "ìƒí™œ/ê°€ì „":["ì „ê¸°ìš”ê¸ˆ ì¤„ì´ëŠ” ì„¤ì • 10ë¶„ ì ê²€","ê°€ìŠ¤ìš”ê¸ˆ ì ˆì•½ ìŠµê´€","ì •ìˆ˜ê¸°/ë Œíƒˆ ë¹„ìš© ì¤„ì´ëŠ” ë²•","ì¥ë³´ê¸° ë¹„ìš© ì¤„ì´ëŠ” ë£¨í‹´","ì²­ì†Œë¹„ìš©/ì‹œê°„ ì¤„ì´ëŠ” íŒ"],
    "ì»´í“¨í„°/IT":["PC ëŠë¦´ ë•Œ í•´ê²° ìˆœì„œ","ìœˆë„ìš° í•„ìˆ˜ ìµœì í™”","í”¼ì‹±/í•´í‚¹ ì˜ˆë°© ì²´í¬","í¬ë¡¬ ëŠë¦¼ í•´ê²°","íœ´ëŒ€í° ìš©ëŸ‰ ì¤„ì´ê¸°"],
    "ìë™ì°¨":["ìë™ì°¨ë³´í—˜ ì‹¸ê²Œ ë“œëŠ” ë¹„êµ íŒ","ì •ë¹„ë¹„ ì•„ë¼ëŠ” ê´€ë¦¬ë²•","ì¤‘]()
