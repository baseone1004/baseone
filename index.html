<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>BaseOne</title>
  <style>
:root{
  --bg:#121a33;
  --panel:#1c2647;
  --panel2:#24315c;
  --text:#f8faff;
  --muted:#cfd7ff;
  --border:rgba(255,255,255,.18);
  --primary:#7aa7ff;
  --good:#38e1c1;
  --warn:#ffd166;
  --danger:#ff7b7b;
}

    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif;
background:
  radial-gradient(1200px 700px at 10% 0%, rgba(122,167,255,.35), transparent 55%),
  radial-gradient(1200px 700px at 90% 10%, rgba(170,140,255,.22), transparent 55%),
  radial-gradient(900px 520px at 50% 90%, rgba(56,225,193,.18), transparent 55%),
  linear-gradient(180deg,#0f1630,#121a33);
,
        var(--bg);
      color:var(--text);
      font-size:13px;
    }
    a{color:inherit;text-decoration:none}
    .wrap{max-width:1020px;margin:0 auto;padding:10px}
    .top{
      display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
      padding:10px 6px;
    }
    .brand{display:flex;align-items:center;gap:10px}
    .logo{
      width:34px;height:34px;border-radius:12px;
      background:linear-gradient(135deg,var(--primary), var(--good));
      display:flex;align-items:center;justify-content:center;
      font-weight:900;
      box-shadow:0 10px 24px rgba(0,0,0,.22);
    }
    .title{font-size:18px;font-weight:900;line-height:1}
    .subtitle{font-size:12px;color:var(--muted);opacity:.95;margin-top:4px}

    .pill{
      display:inline-flex;align-items:center;gap:6px;
      padding:6px 10px;border-radius:999px;
      background:rgba(35,49,91,.72);
      border:1px solid var(--border);
      color:var(--muted);font-size:12px
    }

    .btn{
      padding:7px 10px;border-radius:12px;border:1px solid var(--border);
      background:rgba(255,255,255,.06);
      color:var(--text);cursor:pointer;font-weight:900;
      transition:transform .05s ease, filter .15s ease;
      font-size:12px;
    }
    .btn:hover{filter:brightness(1.07)}
    .btn:active{transform:translateY(1px)}
    .btn.primary{
      background:linear-gradient(135deg,var(--primary), #2f6bff);
      border:none;
    }
    .btn.good{
      background:linear-gradient(135deg, var(--good), #1fb6ff);
      border:none;
    }
    .btn.danger{
      background:rgba(255,107,107,.12);
      border:1px solid rgba(255,107,107,.35);
      color:#ffd1d1;
    }

    .box{
      background:rgba(31,43,77,.78);
      border:1px solid var(--border);
      padding:10px;
      border-radius:16px;
      margin:8px 0;
      box-shadow:0 12px 28px rgba(0,0,0,.18);
      backdrop-filter: blur(7px);
    }
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:space-between}

    input, select, textarea{
      padding:9px 10px;border-radius:12px;border:1px solid var(--border);
      background:rgba(35,49,91,.8);color:var(--text);outline:none;
      font-size:12.5px;
    }
    select{min-width:290px}
    textarea{width:100%;min-height:170px;line-height:1.6}

    .small{font-size:12px;color:var(--muted)}
    .hint{padding:8px 10px;border-radius:12px;border:1px solid rgba(45,212,191,.26);background:rgba(45,212,191,.08);color:var(--muted)}

    .grid{
      display:grid;
      grid-template-columns:repeat(6,1fr);
      gap:8px;
      margin-top:8px;
    }
    @media(max-width:980px){.grid{grid-template-columns:repeat(4,1fr)}}
    @media(max-width:820px){.grid{grid-template-columns:repeat(2,1fr)}}

    .cat{
      background:rgba(35,49,91,.62);
      border:1px solid rgba(255,255,255,.14);
      padding:9px;
      border-radius:16px;
      cursor:pointer;
      display:flex;justify-content:space-between;align-items:flex-start;gap:8px;
      transition:transform .08s ease, border-color .15s ease, filter .15s ease;
      min-height:54px;
    }
    .cat:hover{
      transform:translateY(-1px);
      border-color:rgba(106,163,255,.55);
      filter:brightness(1.06);
    }
    .cat b{font-size:12.5px;letter-spacing:-.2px}
    .cat .desc{font-size:11.5px;color:var(--muted);opacity:.92;margin-top:4px}
    .badge{
      font-size:11.5px;color:var(--muted);
      background:rgba(31,43,77,.9);
      border:1px solid rgba(255,255,255,.14);
      padding:3px 7px;border-radius:999px;
      white-space:nowrap;
    }

    .topicScroll{max-height:320px;overflow:auto;margin-top:8px;padding-right:6px}
    .topicScroll::-webkit-scrollbar{width:10px}
    .topicScroll::-webkit-scrollbar-thumb{background:#2a3a68;border-radius:10px}
    .topicScroll::-webkit-scrollbar-track{background:rgba(35,49,91,.7);border-radius:10px}

    .card{
      background:rgba(35,49,91,.75);
      border:1px solid rgba(255,255,255,.14);
      padding:9px 10px;border-radius:14px;
      display:flex;justify-content:space-between;gap:10px;align-items:center;
      margin-bottom:8px;
    }
    .cardTitle{display:flex;align-items:center;gap:8px;font-weight:900}
    .card .meta{font-size:11.5px;color:var(--muted);opacity:.95;margin-top:4px}
    .chip{
      display:inline-flex;align-items:center;gap:6px;
      padding:5px 9px;border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(35,49,91,.6);
      color:var(--muted);
      font-size:11.5px;
    }

    .starBtn{
      border:1px solid rgba(255,255,255,.14);
      background:rgba(31,43,77,.6);
      color:var(--muted);
      border-radius:12px;
      padding:7px 10px;
      font-size:12px;
      cursor:pointer;
      font-weight:900;
    }
    .starBtn.on{
      background:rgba(255,215,0,.12);
      border-color:rgba(255,215,0,.35);
      color:#ffe8a3;
    }

    /* âœ… ì§„í–‰ ë¡œê·¸ */
    #genBox{display:none}
    #genLog{
      margin-top:10px;
      background:rgba(35,49,91,.78);
      border:1px solid rgba(255,255,255,.14);
      border-radius:14px;
      padding:10px;
      max-height:210px;
      overflow:auto;
      font-size:12px;
      line-height:1.6;
    }

    /* âœ… ìƒì„±ì™„ë£Œ â€œí†µ ë¯¸ë¦¬ë³´ê¸°â€ */
    #finalBox{display:none}
    .finalGrid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
      margin-top:10px;
    }
    @media(max-width:900px){.finalGrid{grid-template-columns:1fr}}
    .finalCard{
      background:rgba(35,49,91,.78);
      border:1px solid rgba(255,255,255,.14);
      border-radius:16px;
      padding:10px;
    }
    .finalHead{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap}
    .finalTitle{font-weight:900}
    .finalText{
      margin-top:8px;
      background:rgba(31,43,77,.75);
      border:1px solid rgba(255,255,255,.12);
      border-radius:14px;
      padding:10px;
      min-height:220px;
      white-space:pre-wrap;
      overflow:auto;
      font-size:12.5px;
      line-height:1.7;
    }

    /* âœ… ê´€ë ¨ ë§í¬ ë²„íŠ¼ */
    .linkRow{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .linkBtn{
      display:inline-flex;align-items:center;gap:6px;
      padding:7px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(31,43,77,.55);
      color:var(--muted);
      font-weight:900;
      font-size:12px;
    }
  </style>
</head>

<body>
<div class="wrap">

  <div class="top">
    <div class="brand">
      <div class="logo">B</div>
      <div>
        <div class="title">BaseOne âœ¨</div>
        <div class="subtitle">ğŸ§  ì£¼ì œ ì„ íƒ â†’ âœ¨ AI ìƒì„± â†’ ğŸš€ ì¦‰ì‹œ/ì˜ˆì•½ ë°œí–‰</div>
      </div>
    </div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
      <span class="pill">ğŸ›°ï¸ ì„œë²„ <b id="sv">-</b></span>
      <a href="/settings"><button class="btn">âš™ï¸ ì„¤ì •</button></a>
    </div>
  </div>

  <!-- ë¸”ë¡œê·¸ ì„ íƒ -->
  <div class="box">
    <div class="row">
      <div>
        <b>ğŸ—‚ï¸ ë¸”ë¡œê·¸ ì„ íƒ</b>
        <div class="small">ì„ íƒí•œ í”Œë«í¼(ë¸”ë¡œê·¸ìŠ¤íŒŸ/ë„¤ì´ë²„/í‹°ìŠ¤í† ë¦¬)ì— ë§ê²Œ í…œí”Œë¦¿ì´ ìë™ ì ìš©ë¼ìš”.</div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
        <select id="blogSelect"></select>
        <button class="btn" onclick="loadBlogsToSelect()">ğŸ”„</button>
      </div>
    </div>
    <div class="small" style="margin-top:8px">âœ… í˜„ì¬ ì„ íƒ: <b id="blogNow">-</b></div>
  </div>

  <!-- í…œí”Œë¦¿ -->
  <div class="box">
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>BaseOne</title>
  <style>
    :root{
      --bg:#18223d;
      --panel:#1f2b4d;
      --panel2:#23315b;
      --text:#f6f8ff;
      --muted:#d8defe;
      --border:rgba(255,255,255,.16);
      --primary:#6aa3ff;
      --good:#2dd4bf;
      --warn:#fbbf24;
      --danger:#ff6b6b;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif;
      background:
        radial-gradient(1200px 700px at 18% 0%, rgba(106,163,255,.35), transparent 55%),
        radial-gradient(1200px 700px at 85% 10%, rgba(200,160,255,.22), transparent 55%),
        radial-gradient(900px 520px at 55% 90%, rgba(45,212,191,.18), transparent 55%),
        var(--bg);
      color:var(--text);
      font-size:13px;
    }
    a{color:inherit;text-decoration:none}
    .wrap{max-width:1020px;margin:0 auto;padding:10px}
    .top{
      display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
      padding:10px 6px;
    }
    .brand{display:flex;align-items:center;gap:10px}
    .logo{
      width:34px;height:34px;border-radius:12px;
      background:linear-gradient(135deg,var(--primary), var(--good));
      display:flex;align-items:center;justify-content:center;
      font-weight:900;
      box-shadow:0 10px 24px rgba(0,0,0,.22);
    }
    .title{font-size:18px;font-weight:900;line-height:1}
    .subtitle{font-size:12px;color:var(--muted);opacity:.95;margin-top:4px}

    .pill{
      display:inline-flex;align-items:center;gap:6px;
      padding:6px 10px;border-radius:999px;
      background:rgba(35,49,91,.72);
      border:1px solid var(--border);
      color:var(--muted);font-size:12px
    }

    .btn{
      padding:7px 10px;border-radius:12px;border:1px solid var(--border);
      background:rgba(255,255,255,.06);
      color:var(--text);cursor:pointer;font-weight:900;
      transition:transform .05s ease, filter .15s ease;
      font-size:12px;
    }
    .btn:hover{filter:brightness(1.07)}
    .btn:active{transform:translateY(1px)}
    .btn.primary{
      background:linear-gradient(135deg,var(--primary), #2f6bff);
      border:none;
    }
    .btn.good{
      background:linear-gradient(135deg, var(--good), #1fb6ff);
      border:none;
    }
    .btn.danger{
      background:rgba(255,107,107,.12);
      border:1px solid rgba(255,107,107,.35);
      color:#ffd1d1;
    }

    .box{
      background:rgba(31,43,77,.78);
      border:1px solid var(--border);
      padding:10px;
      border-radius:16px;
      margin:8px 0;
      box-shadow:0 12px 28px rgba(0,0,0,.18);
      backdrop-filter: blur(7px);
    }
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:space-between}

    input, select, textarea{
      padding:9px 10px;border-radius:12px;border:1px solid var(--border);
      background:rgba(35,49,91,.8);color:var(--text);outline:none;
      font-size:12.5px;
    }
    select{min-width:290px}
    textarea{width:100%;min-height:170px;line-height:1.6}

    .small{font-size:12px;color:var(--muted)}
    .hint{padding:8px 10px;border-radius:12px;border:1px solid rgba(45,212,191,.26);background:rgba(45,212,191,.08);color:var(--muted)}

    .grid{
      display:grid;
      grid-template-columns:repeat(6,1fr);
      gap:8px;
      margin-top:8px;
    }
    @media(max-width:980px){.grid{grid-template-columns:repeat(4,1fr)}}
    @media(max-width:820px){.grid{grid-template-columns:repeat(2,1fr)}}

    .cat{
      background:rgba(35,49,91,.62);
      border:1px solid rgba(255,255,255,.14);
      padding:9px;
      border-radius:16px;
      cursor:pointer;
      display:flex;justify-content:space-between;align-items:flex-start;gap:8px;
      transition:transform .08s ease, border-color .15s ease, filter .15s ease;
      min-height:54px;
    }
    .cat:hover{
      transform:translateY(-1px);
      border-color:rgba(106,163,255,.55);
      filter:brightness(1.06);
    }
    .cat b{font-size:12.5px;letter-spacing:-.2px}
    .cat .desc{font-size:11.5px;color:var(--muted);opacity:.92;margin-top:4px}
    .badge{
      font-size:11.5px;color:var(--muted);
      background:rgba(31,43,77,.9);
      border:1px solid rgba(255,255,255,.14);
      padding:3px 7px;border-radius:999px;
      white-space:nowrap;
    }

    .topicScroll{max-height:320px;overflow:auto;margin-top:8px;padding-right:6px}
    .topicScroll::-webkit-scrollbar{width:10px}
    .topicScroll::-webkit-scrollbar-thumb{background:#2a3a68;border-radius:10px}
    .topicScroll::-webkit-scrollbar-track{background:rgba(35,49,91,.7);border-radius:10px}

    .card{
      background:rgba(35,49,91,.75);
      border:1px solid rgba(255,255,255,.14);
      padding:9px 10px;border-radius:14px;
      display:flex;justify-content:space-between;gap:10px;align-items:center;
      margin-bottom:8px;
    }
    .cardTitle{display:flex;align-items:center;gap:8px;font-weight:900}
    .card .meta{font-size:11.5px;color:var(--muted);opacity:.95;margin-top:4px}
    .chip{
      display:inline-flex;align-items:center;gap:6px;
      padding:5px 9px;border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(35,49,91,.6);
      color:var(--muted);
      font-size:11.5px;
    }

    .starBtn{
      border:1px solid rgba(255,255,255,.14);
      background:rgba(31,43,77,.6);
      color:var(--muted);
      border-radius:12px;
      padding:7px 10px;
      font-size:12px;
      cursor:pointer;
      font-weight:900;
    }
    .starBtn.on{
      background:rgba(255,215,0,.12);
      border-color:rgba(255,215,0,.35);
      color:#ffe8a3;
    }

    /* âœ… ì§„í–‰ ë¡œê·¸ */
    #genBox{display:none}
    #genLog{
      margin-top:10px;
      background:rgba(35,49,91,.78);
      border:1px solid rgba(255,255,255,.14);
      border-radius:14px;
      padding:10px;
      max-height:210px;
      overflow:auto;
      font-size:12px;
      line-height:1.6;
    }

    /* âœ… ìƒì„±ì™„ë£Œ â€œí†µ ë¯¸ë¦¬ë³´ê¸°â€ */
    #finalBox{display:none}
    .finalGrid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
      margin-top:10px;
    }
    @media(max-width:900px){.finalGrid{grid-template-columns:1fr}}
    .finalCard{
      background:rgba(35,49,91,.78);
      border:1px solid rgba(255,255,255,.14);
      border-radius:16px;
      padding:10px;
    }
    .finalHead{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap}
    .finalTitle{font-weight:900}
    .finalText{
      margin-top:8px;
      background:rgba(31,43,77,.75);
      border:1px solid rgba(255,255,255,.12);
      border-radius:14px;
      padding:10px;
      min-height:220px;
      white-space:pre-wrap;
      overflow:auto;
      font-size:12.5px;
      line-height:1.7;
    }

    /* âœ… ê´€ë ¨ ë§í¬ ë²„íŠ¼ */
    .linkRow{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .linkBtn{
      display:inline-flex;align-items:center;gap:6px;
      padding:7px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(31,43,77,.55);
      color:var(--muted);
      font-weight:900;
      font-size:12px;
    }
  </style>
</head>

<body>
<div class="wrap">

  <div class="top">
    <div class="brand">
      <div class="logo">B</div>
      <div>
        <div class="title">BaseOne âœ¨</div>
        <div class="subtitle">ğŸ§  ì£¼ì œ ì„ íƒ â†’ âœ¨ AI ìƒì„± â†’ ğŸš€ ì¦‰ì‹œ/ì˜ˆì•½ ë°œí–‰</div>
      </div>
    </div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
      <span class="pill">ğŸ›°ï¸ ì„œë²„ <b id="sv">-</b></span>
      <a href="/settings"><button class="btn">âš™ï¸ ì„¤ì •</button></a>
      <button class="btn primary" onclick="makeMoney()">ğŸ’° ìˆ˜ìµí˜• 100</button>
    </div>
  </div>

  <!-- ë¸”ë¡œê·¸ ì„ íƒ -->
  <div class="box">
    <div class="row">
      <div>
        <b>ğŸ—‚ï¸ ë¸”ë¡œê·¸ ì„ íƒ</b>
        <div class="small">ì„ íƒí•œ í”Œë«í¼(ë¸”ë¡œê·¸ìŠ¤íŒŸ/ë„¤ì´ë²„/í‹°ìŠ¤í† ë¦¬)ì— ë§ê²Œ í…œí”Œë¦¿ì´ ìë™ ì ìš©ë¼ìš”.</div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
        <select id="blogSelect"></select>
        <button class="btn" onclick="loadBlogsToSelect()">ğŸ”„</button>
      </div>
    </div>
    <div class="small" style="margin-top:8px">âœ… í˜„ì¬ ì„ íƒ: <b id="blogNow">-</b></div>
  </div>

  <!-- í…œí”Œë¦¿ -->
  <div class="box">
    <div class="row">
      <div>
        <b>ğŸ§© í”Œë«í¼ë³„ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿</b>
        <div class="small">ìœ„ì—ì„œ í…œí”Œë¦¿ ìˆ˜ì •/ì €ì¥í•˜ë©´, ìƒì„± ê²°ê³¼ì— ìë™ ì ìš©ë¼ìš”.</div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn" onclick="saveTemplates()">ğŸ’¾ ì €ì¥</button>
        <button class="btn danger" onclick="resetTemplates()">â™»ï¸ ê¸°ë³¸ê°’</button>
      </div>
    </div>

    <div class="small" style="margin-top:10px">
      ë³€ìˆ˜: <span class="chip">{{topic}}</span> <span class="chip">{{category}}</span>
      <span class="chip">{{image_url}}</span> <span class="chip">{{body_prompt}}</span>
    </div>

    <div style="margin-top:10px">
      <div class="small"><b>ğŸ“ ë³¸ë¬¸ í…œí”Œë¦¿</b></div>
      <textarea id="tplBody"></textarea>
    </div>

    <div style="margin-top:10px">
      <div class="small"><b>ğŸ–¼ï¸ ì´ë¯¸ì§€ í…œí”Œë¦¿(ì„ íƒ)</b></div>
      <textarea id="tplImage" style="min-height:120px"></textarea>
    </div>

    <div class="small" style="margin-top:10px">í˜„ì¬ ì ìš©: <b id="tplNow">-</b></div>
  </div>

  <!-- ì£¼ì œ -->
  <div class="box">
    <div class="row">
      <div>
        <b>ğŸ§  ì£¼ì œ ìƒì„±</b>
        <div class="small">ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ë©´, ì‚¬ëŒì´ í´ë¦­í•˜ê³  ì‹¶ì€ ì œëª©ìœ¼ë¡œ ëª©ë¡ì´ ìƒì„±ë¼ìš”.</div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
        <input id="filter" placeholder="ğŸ” ê²€ìƒ‰ (â­ë§Œ: star)" oninput="render()">
        <button class="btn" onclick="copyAll()">ğŸ“‹ ì „ì²´ë³µì‚¬</button>
        <button class="btn" onclick="showStarOnly()">â­</button>
        <button class="btn primary" onclick="aiGenerateSelected()">âœ¨ AI ìƒì„±</button>
        <button class="btn good" onclick="makeMoney()">ğŸ’° ìˆ˜ìµí˜• 100</button>

      </div>
    </div>

    <div class="grid" id="catGrid"></div>
  </div>

  <!-- ì£¼ì œ ëª©ë¡ -->
  <div class="box">
    <div class="row">
      <div>
        <b>ğŸ“š ì£¼ì œ ëª©ë¡</b>
        <div class="small" id="selInfo">ì„ íƒ ì£¼ì œ: -</div>
      </div>
      <div class="hint small">âœ… ì£¼ì œë¥¼ ì„ íƒí•œ ë’¤ â€œAI ìƒì„±â€ì„ ëˆ„ë¥´ì„¸ìš”.</div>
    </div>

    <div class="topicScroll" id="topics"></div>
  </div>

  <!-- ì§„í–‰ìƒí™© -->
  <div class="box" id="genBox">
    <div class="row">
      <b>ğŸ§¾ ì§„í–‰ ë¡œê·¸</b>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn" onclick="toggleGenBox()">ğŸ‘€ í† ê¸€</button>
        <button class="btn danger" onclick="clearGenLog()">ğŸ§¹ ì§€ìš°ê¸°</button>
      </div>
    </div>
    <div id="genLog"></div>
  </div>
  .card.selected{
  border-color:#6aa3ff;
  box-shadow:0 0 0 2px rgba(106,163,255,.35);
  background:linear-gradient(135deg, rgba(106,163,255,.15), rgba(45,212,191,.12));
}


  <!-- âœ… ìƒì„±ì™„ë£Œ â€œí†µ ë¯¸ë¦¬ë³´ê¸°â€ -->
  <div class="box" id="finalBox">
    <div class="row">
      <div>
        <b>âœ… ìƒì„± ì™„ë£Œ ë¯¸ë¦¬ë³´ê¸°(í†µìœ¼ë¡œ)</b>
        <div class="small" id="finalMeta">-</div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn" onclick="copyText(document.getElementById('finalBody').textContent)">ğŸ“‹ ë³¸ë¬¸ ë³µì‚¬</button>
        <button class="btn" onclick="copyText(document.getElementById('finalImage').textContent)">ğŸ–¼ï¸ ì´ë¯¸ì§€ ë³µì‚¬</button>
      </div>
    </div>

    <div class="linkRow" id="linkRow"></div>

    <div class="finalGrid">
      <div class="finalCard">
        <div class="finalHead">
          <div class="finalTitle">ğŸ“ ë³¸ë¬¸ í”„ë¡¬í”„íŠ¸</div>
        </div>
        <div class="finalText" id="finalBody"></div>
      </div>
      <div class="finalCard">
        <div class="finalHead">
          <div class="finalTitle">ğŸ–¼ï¸ ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸</div>
        </div>
        <div class="finalText" id="finalImage"></div>
      </div>
    </div>
  </div>

  <!-- ë°œí–‰ -->
  <div class="box">
    <div class="row">
      <div>
        <b>ğŸš€ ë°œí–‰</b>
        <div class="small">ì§€ê¸ˆì€ â€œì‹¤ì œ ì—…ë¡œë“œâ€ê°€ ì•„ë‹ˆë¼ ì„œë²„ì— ìš”ì²­ ì €ì¥ ë‹¨ê³„ì…ë‹ˆë‹¤(ì‹¤ì œ ì—…ë¡œë“œëŠ” OAuth ë¶™ì´ëŠ” ë‹¨ê³„ í•„ìš”).</div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
        <label class="small">â± ê°„ê²©</label>
        <select id="intervalHours" style="min-width:110px">
          <option value="1">1ì‹œê°„</option><option value="2">2ì‹œê°„</option><option value="3">3ì‹œê°„</option>
          <option value="4">4ì‹œê°„</option><option value="5">5ì‹œê°„</option><option value="6">6ì‹œê°„</option>
        </select>
      </div>
    </div>

    <div class="row" style="margin-top:10px">
      <button class="btn good" onclick="publishInstant()">ğŸš€ ì¦‰ì‹œë°œí–‰</button>
      <button class="btn primary" onclick="publishWithInterval()">â± ì¦‰ì‹œë°œí–‰(ì˜ˆì•½)</button>
      <button class="btn" onclick="loadPublishList()">ğŸ“¦ ë°œí–‰ìš”ì²­ ë¦¬ìŠ¤íŠ¸</button>
    </div>

    <div id="publishList" style="margin-top:10px"></div>
  </div>

</div>

<script>
  // API_BASE
  function getApiBase(){
    const d = JSON.parse(localStorage.getItem("baseone_settings_v3") || "{}");
    const base = (d.backend || "http://127.0.0.1:5000").trim();
    return base.replace(/\/+$/,"");
  }
  const API_BASE = getApiBase();
  document.addEventListener("DOMContentLoaded", ()=> {
    const el = document.getElementById("sv");
    if(el) el.textContent = API_BASE;
  });

  // Utils
  function escapeHtml(s){
    return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
  }
  function escapeAttr(s){
    return String(s).replaceAll("\\","\\\\").replaceAll("'","\\'");
  }
  function safeStr(x){ return (x===undefined || x===null) ? "" : String(x); }
  function applyTemplate(tpl, vars){
    let out = safeStr(tpl);
    Object.keys(vars).forEach(k=>{
      out = out.replaceAll(`{{${k}}}`, safeStr(vars[k]));
    });
    return out;
  }
  function copyText(t){ navigator.clipboard.writeText(t); alert("ë³µì‚¬ ì™„ë£Œ!"); }

  // Logs
  function showGenBox(){ document.getElementById("genBox").style.display = "block"; }
  function toggleGenBox(){
    const box = document.getElementById("genBox");
    box.style.display = (box.style.display==="none" ? "block" : "none");
  }
  function addGenLine(icon, color, msg){
    showGenBox();
    const log = document.getElementById("genLog");
    const t = new Date();
    const time = String(t.getHours()).padStart(2,"0")+":"+String(t.getMinutes()).padStart(2,"0")+":"+String(t.getSeconds()).padStart(2,"0");
    log.innerHTML += `<div style="color:${color}">${icon} <b>[${time}]</b> ${escapeHtml(msg)}</div>`;
    log.scrollTop = log.scrollHeight;
  }
  function addGenLog(msg){ addGenLine("ğŸŸ¦","#f6f8ff",msg); }
  function addGenOk(msg){ addGenLine("âœ…","#9ff5d2",msg); }
  function addGenErr(msg){ addGenLine("âŒ","#ffb4b4",msg); }
  function clearGenLog(){ document.getElementById("genLog").innerHTML = ""; }

  // Categories
  const CATS=[
    {k:"ê±´ê°•", s:"ğŸƒ ìš´ë™Â·ì˜ì–‘"},
    {k:"ì»´í“¨í„°/IT", s:"ğŸ’» ìœ í‹¸Â·ë³´ì•ˆ"},
    {k:"ìë™ì°¨", s:"ğŸš— ì •ë¹„Â·ë³´í—˜"},
    {k:"ìƒí™œ/ê°€ì „", s:"ğŸ  ì‚´ë¦¼Â·ì ˆì•½"},
    {k:"ìœ¡ì•„", s:"ğŸ¼ ìœ¡ì•„Â·êµìœ¡"},
    {k:"ëˆ/ì¬í…Œí¬", s:"ğŸ’° ì ˆì•½Â·ì„¸ê¸ˆ"},
    {k:"ì—¬í–‰", s:"ğŸ§³ ì½”ìŠ¤Â·ê¿€íŒ"},
    {k:"ìš”ë¦¬", s:"ğŸ³ ë ˆì‹œí”¼"},
    {k:"ìê¸°ê³„ë°œ", s:"ğŸ“ˆ ìŠµê´€"},
    {k:"ê³µë¶€/ìê²©ì¦", s:"ğŸ“š í•©ê²©"},
    {k:"ë°˜ë ¤ë™ë¬¼", s:"ğŸ¶ ì¼€ì–´"},
    {k:"íŒ¨ì…˜/ë·°í‹°", s:"ğŸ’„ ê´€ë¦¬"},
    {k:"ì·¨ë¯¸", s:"ğŸ¨ DIY"},
    {k:"ìŠ¤í¬ì¸ ", s:"ğŸ‹ï¸ ë£¨í‹´"},
    {k:"ê²Œì„", s:"ğŸ® íŒ"},
    {k:"ì˜í™”/ë“œë¼ë§ˆ", s:"ğŸ¬ ë¦¬ë·°"}
  ];

  let topics=[];
  let selectedTopic="";
  let selectedCat="";

  // Stars
  const STAR_KEY="baseone_fav_topics_v1";
  function getStars(){ try{ const s=JSON.parse(localStorage.getItem(STAR_KEY)||"[]"); return Array.isArray(s)?s:[]; }catch(e){ return []; } }
  function setStars(arr){ localStorage.setItem(STAR_KEY, JSON.stringify(arr)); }
  function isStar(t){ return getStars().includes(t); }
  function toggleStar(t){
    const s=getStars(); const i=s.indexOf(t);
    if(i>=0) s.splice(i,1); else s.unshift(t);
    setStars(s.slice(0,300)); render();
  }
  function showStarOnly(){ document.getElementById("filter").value="star"; render(); }

  // Build grid
  const grid=document.getElementById("catGrid");
  CATS.forEach(obj=>{
    const d=document.createElement("div");
    d.className = "card" + (t === selectedTopic ? " selected" : "");
    d.onclick=()=>makeTopics(obj.k);
    d.innerHTML = `
      <div>
        <b>${obj.k}</b>
        <div class="desc">${obj.s}</div>
      </div>
      <span class="badge">30</span>
    `;
    grid.appendChild(d);
  });

  // âœ… ì‚¬ëŒë‹µê²Œ ì£¼ì œ ìƒì„±
  const SAMPLE={
    "ê±´ê°•":[
      "ë©´ì—­ë ¥ ë†’ì´ëŠ” ìƒí™œìŠµê´€ 7ê°€ì§€",
      "í”¼ë¡œê°€ ì•ˆ í’€ë¦´ ë•Œ ê¼­ í™•ì¸í•  ê²ƒ",
      "ì•„ì¹¨ì— ê°œìš´í•´ì§€ëŠ” ë£¨í‹´ ë§Œë“¤ê¸°",
      "ì¥ ê±´ê°• ì¢‹ì•„ì§€ëŠ” ì‹ìŠµê´€",
      "ìŠ¤íŠ¸ë ˆìŠ¤ ì¤„ì´ëŠ” ìƒí™œ íŒ",
      "í˜ˆì••/í˜ˆë‹¹ ê´€ë¦¬ì— ë„ì›€ ë˜ëŠ” ì‹ë‹¨",
      "ê±´ê°•ê²€ì§„ ê²°ê³¼í‘œ ë³´ëŠ” í•µì‹¬ í¬ì¸íŠ¸",
      "ìˆ˜ë©´ì˜ ì§ˆ ì˜¬ë¦¬ëŠ” í™˜ê²½ ì„¸íŒ…ë²•"
    ],
    "ìœ¡ì•„":[
      "ì•„ì´ ìˆ˜ë©´ìŠµê´€ ì¡ëŠ” í˜„ì‹¤ íŒ",
      "ë–¼ì“°ëŠ” ì•„ì´ ëŒ€ì²˜ë²•(ìƒí™©ë³„)",
      "ì´ˆë³´ ë¶€ëª¨ ì²´í¬ë¦¬ìŠ¤íŠ¸(í•„ìˆ˜í…œ/ì£¼ì˜ì )",
      "í¸ì‹ ì¤„ì´ëŠ” ì‹ì‚¬ ë£¨í‹´",
      "ì–´ë¦°ì´ì§‘ ì ì‘ì„ ë•ëŠ” ëŒ€í™”ë²•",
      "ìœ¡ì•„ ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ ë£¨í‹´",
      "ì•„ì´ ê°ê¸° ìì£¼ ê±¸ë¦´ ë•Œ í™•ì¸í•  ê²ƒ"
    ],
    "ëˆ/ì¬í…Œí¬":[
      "í†µì‹ ë¹„/ë³´í—˜ë£Œ ì¤„ì´ëŠ” ìˆœì„œ",
      "ì´ˆë³´ê°€ í•˜ê¸° ì‰¬ìš´ ì˜ˆì‚°ê´€ë¦¬ ë°©ë²•",
      "ì¹´ë“œ í˜œíƒ ìµœëŒ€ë¡œ ë°›ëŠ” ì‚¬ìš©ë²•",
      "ì—°ë§ì •ì‚°ì—ì„œ ë†“ì¹˜ê¸° ì‰¬ìš´ í•­ëª©",
      "ë¹„ìƒê¸ˆ í†µì¥ ë§Œë“œëŠ” ê°€ì¥ ì‰¬ìš´ ë°©ë²•"
    ]
  };

  function makeTopics(cat){
    selectedCat=cat;
    topics=[];
    if(SAMPLE[cat]){
      topics = SAMPLE[cat].slice();
      // ìƒ˜í”Œì´ ì ìœ¼ë©´ ìë™ í™•ì¥
      while(topics.length<30){
        topics.push(`${cat}ì—ì„œ ì‚¬ëŒë“¤ì´ ê°€ì¥ ë§ì´ ê²€ìƒ‰í•˜ëŠ” ì£¼ì œ ${topics.length+1}`);
      }
    }else{
      for(let i=1;i<=30;i++){
        topics.push(`${cat}ì—ì„œ ì‚¬ëŒë“¤ì´ ê°€ì¥ ë§ì´ ê²€ìƒ‰í•˜ëŠ” ì£¼ì œ ${i}`);
      }
    }
    selectedTopic = topics[0] || "";
    updateSel(); render();
  }

  function makeMoney(){
    selectedCat="ìˆ˜ìµí˜•";
    const base=[
      "ë³´í—˜ë£Œ ì¤„ì´ê¸°","ì‹ ìš©ì¹´ë“œ ì¶”ì²œ","í†µì‹ ë¹„ ì ˆì•½","ì „ê¸°ìš”ê¸ˆ ì ˆì•½","ê°€ìŠ¤ìš”ê¸ˆ ì ˆì•½",
      "ëŒ€ì¶œ ì´ì","ì—°ê¸ˆ/IRP","ì„¸ê¸ˆ ì ˆì•½","ìë™ì°¨ë³´í—˜","ì¤‘ê³ ì°¨"
    ];
    topics=[];
    for(let i=1;i<=30;i++){
      topics.push(`${base[i%base.length]}: ì‚¬ëŒë“¤ì´ ê°€ì¥ ë§ì´ ë¬»ëŠ” ê²ƒ ${i}`);
    }
    selectedTopic=topics[0]||"";
    updateSel(); render();
  }

  function updateSel(){
    document.getElementById("selInfo").textContent = `ì„ íƒ ì£¼ì œ: ${selectedTopic || "-"}`;
  }
  function setSelected(t){ selectedTopic=t; updateSel(); }

  function render(){
    const q=(document.getElementById("filter").value||"").trim().toLowerCase();
    const list=document.getElementById("topics");
    list.innerHTML="";

    let filtered=topics;
    if(q==="star"){
      filtered=getStars().slice();
      if(!filtered.length){
        list.innerHTML=`<div class="small">â­ ì¦ê²¨ì°¾ê¸° ì—†ìŒ</div>`;
        return;
      }
    }else if(q){
      filtered = topics.filter(t=>t.toLowerCase().includes(q));
    }

    filtered.forEach(t=>{
      const starOn=isStar(t);
      const d=document.createElement("div");
      d.className="card";
      d.innerHTML=`
        <div style="flex:1">
          <div class="cardTitle">${starOn?"â­":"â˜†"} ${escapeHtml(t)}</div>
          <div class="meta">${selectedCat?`ğŸ·ï¸ ${escapeHtml(selectedCat)}`:""}</div>
        </div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
          <button class="starBtn ${starOn?"on":""}" onclick="toggleStar('${escapeAttr(t)}')">${starOn?"â­":"â˜†"}</button>
          <button class="btn" onclick="setSelected('${escapeAttr(t)}')">ì„ íƒ</button>
          <button class="btn" onclick="copyText('${escapeAttr(t)}')">ë³µì‚¬</button>
        </div>
      `;
      list.appendChild(d);
    });
  }

  function copyAll(){
    if(!topics.length){alert("ì£¼ì œ ì—†ìŒ");return;}
    navigator.clipboard.writeText(topics.join("\n"));
    alert("ì „ì²´ ë³µì‚¬ ì™„ë£Œ!");
  }

  // Blogs select
  function loadBlogsToSelect(){
    const sel=document.getElementById("blogSelect");
    const now=document.getElementById("blogNow");
    sel.innerHTML="";

    const s=JSON.parse(localStorage.getItem("baseone_settings_v2")||"{}");
    const blogs=s.blogs||{blogspot:[],naver:[],tistory:[]};

    const options=[];
    (blogs.blogspot||[]).filter(Boolean).forEach((u,i)=>options.push({type:"blogspot",url:u,label:`ğŸŸ¦ ë¸”ë¡œê·¸ìŠ¤íŒŸ ${i+1} - ${u}`}));
    (blogs.naver||[]).filter(Boolean).forEach((u,i)=>options.push({type:"naver",url:u,label:`ğŸŸ© ë„¤ì´ë²„ ${i+1} - ${u}`}));
    (blogs.tistory||[]).filter(Boolean).forEach((u,i)=>options.push({type:"tistory",url:u,label:`ğŸŸ§ í‹°ìŠ¤í† ë¦¬ ${i+1} - ${u}`}));

    if(!options.length){
      const opt=document.createElement("option");
      opt.value=""; opt.textContent="ì €ì¥ëœ ë¸”ë¡œê·¸ ì£¼ì†Œ ì—†ìŒ â†’ ì„¤ì •ì—ì„œ ì €ì¥";
      sel.appendChild(opt); now.textContent="-";
      return;
    }

    options.forEach(o=>{
      const opt=document.createElement("option");
      opt.value=JSON.stringify({type:o.type,url:o.url});
      opt.textContent=o.label;
      sel.appendChild(opt);
    });

    const last=localStorage.getItem("baseone_last_blog");
    if(last){
      for(let i=0;i<sel.options.length;i++){
        if(sel.options[i].value===last){sel.selectedIndex=i;break;}
      }
    }
    updateBlogNow();
  }

  function updateBlogNow(){
    const sel=document.getElementById("blogSelect");
    const now=document.getElementById("blogNow");
    const v=sel.value;
    if(!v){ now.textContent="-"; return; }
    localStorage.setItem("baseone_last_blog", v);
    try{
      const obj=JSON.parse(v);
      now.textContent=`${obj.type} / ${obj.url}`;
      setPromptTab(obj.type);
    }catch(e){ now.textContent="-"; }
  }

  document.addEventListener("change",(e)=>{
    if(e.target && e.target.id==="blogSelect") updateBlogNow();
  });

  loadBlogsToSelect();

  // Templates
  const PROMPT_KEY="baseone_prompts_v1";
  const PLATFORMS=[
    {k:"blogspot",label:"ğŸŸ¦ ë¸”ë¡œê·¸ìŠ¤íŒŸ"},
    {k:"naver",label:"ğŸŸ© ë„¤ì´ë²„"},
    {k:"tistory",label:"ğŸŸ§ í‹°ìŠ¤í† ë¦¬"},
  ];
  let currentPlatform="blogspot";

  function defaultTemplates(){
    return {
      blogspot:{
        body:`ë„ˆëŠ” ë¸”ë¡œê·¸ìŠ¤íŒŸ ì „ë¬¸ ì‘ê°€ì•¼.
ì£¼ì œ: {{topic}}
ì¹´í…Œê³ ë¦¬: {{category}}

[ê¸°ë³¸ ë³¸ë¬¸ í”„ë¡¬í”„íŠ¸]
{{body_prompt}}`,
        image:`[ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸/URL]
{{image_prompt}}
{{image_url}}`
      },
      naver:{
        body:`ë„ˆëŠ” ë„¤ì´ë²„ ë¸”ë¡œê·¸ ì „ë¬¸ ì‘ê°€ì•¼.
ì£¼ì œ: {{topic}}
ì¹´í…Œê³ ë¦¬: {{category}}

[ê¸°ë³¸ ë³¸ë¬¸ í”„ë¡¬í”„íŠ¸]
{{body_prompt}}`,
        image:`[ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸/URL]
{{image_prompt}}
{{image_url}}`
      },
      tistory:{
        body:`ë„ˆëŠ” í‹°ìŠ¤í† ë¦¬ ì „ë¬¸ ì‘ê°€ì•¼.
ì£¼ì œ: {{topic}}
ì¹´í…Œê³ ë¦¬: {{category}}

[ê¸°ë³¸ ë³¸ë¬¸ í”„ë¡¬í”„íŠ¸]
{{body_prompt}}`,
        image:`[ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸/URL]
{{image_prompt}}
{{image_url}}`
      }
    };
  }

  function getTemplates(){
    try{
      const saved=JSON.parse(localStorage.getItem(PROMPT_KEY)||"null");
      if(saved && typeof saved==="object") return saved;
    }catch(e){}
    const d=defaultTemplates();
    localStorage.setItem(PROMPT_KEY, JSON.stringify(d));
    return d;
  }
  function setTemplates(obj){ localStorage.setItem(PROMPT_KEY, JSON.stringify(obj)); }

  function setPromptTab(k){
    currentPlatform=k;
    const tpls=getTemplates();
    const body=(tpls[k]&&tpls[k].body)?tpls[k].body:"";
    const image=(tpls[k]&&tpls[k].image)?tpls[k].image:"";
    document.getElementById("tplBody").value=body;
    document.getElementById("tplImage").value=image;
    document.getElementById("tplNow").textContent = (PLATFORMS.find(p=>p.k===k)?.label || k);
  }
  function saveTemplates(){
    const t=getTemplates();
    t[currentPlatform]=t[currentPlatform]||{};
    t[currentPlatform].body=document.getElementById("tplBody").value||"";
    t[currentPlatform].image=document.getElementById("tplImage").value||"";
    setTemplates(t);
    alert("ì €ì¥ ì™„ë£Œ!");
  }
  function resetTemplates(){
    const d=defaultTemplates();
    setTemplates(d);
    setPromptTab(currentPlatform);
    alert("ê¸°ë³¸ê°’ ë³µêµ¬ ì™„ë£Œ!");
  }
  setPromptTab(currentPlatform);

  function getSelectedBlog(){
    const v=document.getElementById("blogSelect").value;
    if(!v) return null;
    try{ return JSON.parse(v); }catch(e){ return null; }
  }

  // âœ… AI ìƒì„±
  async function aiGenerateSelected(){
    if(!selectedTopic){ alert("ì£¼ì œë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”!"); return; }

    const blog=getSelectedBlog();
    const blogType=blog?.type||"blogspot";
    setPromptTab(blogType);

    // âœ… ì´ì „ ë¯¸ë¦¬ë³´ê¸° ë°•ìŠ¤ â€œì—†ì• ê¸°â€
    document.getElementById("finalBox").style.display="none";

    showGenBox();
    addGenLog(`ğŸ›°ï¸ ì„œë²„: ${API_BASE}`);
    addGenLog(`ğŸ—‚ï¸ ë¸”ë¡œê·¸: ${blogType}`);
    addGenLog(`ğŸ§  ì£¼ì œ: ${selectedTopic}`);
    addGenLog(`ğŸ·ï¸ ì¹´í…Œê³ ë¦¬: ${selectedCat || "-"}`);
    addGenLog("1) ìƒì„± ìš”ì²­ ì „ì†¡");
    addGenLog("2) ì‘ë‹µ ëŒ€ê¸°");

    const s=JSON.parse(localStorage.getItem("baseone_settings_v2")||"{}");
    const payload={
      topic:selectedTopic,
      category:selectedCat,
      blog:blogType,
      img_provider:(s.imgProvider||"pexels"),
      pexels_key:(s.pexelsKey||"")
    };

    try{
      const res=await fetch(API_BASE+"/api/generate",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify(payload)
      });
      if(!res.ok){
        const t=await res.text();
        addGenErr("âŒ ìƒì„± ì‹¤íŒ¨: "+t);
        alert("ìƒì„± ì‹¤íŒ¨: "+t);
        return;
      }
      addGenLog("3) ì‘ë‹µ ìˆ˜ì‹ ");
      const data=await res.json();

      if(data.image_url){
        addGenOk("4) ì´ë¯¸ì§€ URL í™•ì¸ ì™„ë£Œ");
      }else{
        addGenLog("4) ì´ë¯¸ì§€ URL ì—†ìŒ(ê²€ìƒ‰ 0ê±´ ê°€ëŠ¥)");
      }

      addGenLog("5) í…œí”Œë¦¿ ì ìš©");
      addGenOk("âœ… ìƒì„± ì™„ë£Œ");

      renderFinalPreview(data, blogType);

    }catch(e){
      addGenErr("âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨");
      alert("ì„œë²„ ì—°ê²° ì‹¤íŒ¨! ì„¤ì •ì˜ ì„œë²„ ì£¼ì†Œ(API_BASE)ë¥¼ í™•ì¸í•˜ì„¸ìš”.");
    }
  }

  function renderFinalPreview(data, blogType){
    const tpls=getTemplates();
    const tpl=(tpls[blogType]||tpls["blogspot"]||{body:"{{body_prompt}}",image:"{{image_prompt}}\n{{image_url}}"});

    const vars={
      topic:data.topic||selectedTopic||"",
      category:data.category||selectedCat||"",
      image_url:data.image_url||"",
      body_prompt:data.body_prompt||"",
      image_prompt:data.image_prompt||""
    };

    const appliedBody=applyTemplate(tpl.body||"{{body_prompt}}",vars);
    const appliedImage=applyTemplate(tpl.image||"{{image_prompt}}\n{{image_url}}",vars);

    document.getElementById("finalMeta").textContent =
      `ğŸ§  ${vars.topic} / ğŸ·ï¸ ${vars.category} / ğŸ—‚ï¸ ${blogType} / â±ï¸ ${data.generated_at || ""}`;

    document.getElementById("finalBody").textContent = appliedBody;
    document.getElementById("finalImage").textContent = appliedImage;

    // âœ… ê´€ë ¨ ë§í¬ ë²„íŠ¼(ë„¤ëª¨ ë°•ìŠ¤ ë²„íŠ¼ì‹)
    const q=encodeURIComponent(`${vars.topic} ${vars.category}`.trim());
    const links=[
      {label:"ğŸ” êµ¬ê¸€", url:`https://www.google.com/search?q=${q}`},
      {label:"ğŸ“° ë‰´ìŠ¤", url:`https://www.google.com/search?q=${q}+site:news`},
      {label:"ğŸ“Œ ë„¤ì´ë²„", url:`https://search.naver.com/search.naver?query=${q}`},
      {label:"â–¶ï¸ ìœ íŠœë¸Œ", url:`https://www.youtube.com/results?search_query=${q}`},
      {label:"ğŸ–¼ï¸ ì´ë¯¸ì§€", url:`https://www.google.com/search?tbm=isch&q=${q}`},
    ];
    const row=document.getElementById("linkRow");
    row.innerHTML = links.map(l=>`<a class="linkBtn" href="${l.url}" target="_blank" rel="noopener noreferrer">${l.label}</a>`).join("");

    document.getElementById("finalBox").style.display="block";
  }

  // âœ… ë°œí–‰ ë²„íŠ¼ 2ê°œ
  async function publishInstant(){
    const blog=getSelectedBlog();
    if(!blog || !selectedTopic){ alert("ë¸”ë¡œê·¸ì™€ ì£¼ì œë¥¼ ì„ íƒí•˜ì„¸ìš”"); return; }
    showGenBox();
    addGenLog("ğŸš€ ì¦‰ì‹œë°œí–‰ í´ë¦­");
    addGenLog("âš ï¸ í˜„ì¬ëŠ” ì„œë²„ì— ì €ì¥ ë‹¨ê³„(OAuth ë¶™ì´ë©´ ì‹¤ì œ ì—…ë¡œë“œ ê°€ëŠ¥)");

    // ì„œë²„ì— endpointê°€ ì•„ì§ ì—†ìœ¼ë©´ â€œì €ì¥â€ë§Œ í•˜ë„ë¡ ê¸°ì¡´ now endpoint ì‚¬ìš©
    const payload={
      blog_type:blog.type,
      blog_url:blog.url,
      category:selectedCat,
      topic:selectedTopic,
      start_time:"NOW",
      interval_hours:"0"
    };

    try{
      const res=await fetch(API_BASE+"/api/publish/now",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify(payload)
      });
      const j=await res.json();
      addGenOk("âœ… ì¦‰ì‹œë°œí–‰ ìš”ì²­ ì €ì¥ ì™„ë£Œ");
      alert(j.message || "ì €ì¥ ì™„ë£Œ");
      loadPublishList();
    }catch(e){
      addGenErr("âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨");
      alert("ì„œë²„ ì—°ê²° ì‹¤íŒ¨!");
    }
  }

  async function publishWithInterval(){
    const blog=getSelectedBlog();
    if(!blog || !selectedTopic){ alert("ë¸”ë¡œê·¸ì™€ ì£¼ì œë¥¼ ì„ íƒí•˜ì„¸ìš”"); return; }
    const interval_hours=document.getElementById("intervalHours").value;
    showGenBox();
    addGenLog("â± ì¦‰ì‹œë°œí–‰(ì˜ˆì•½) í´ë¦­");
    addGenLog("âœ… 1ê°œëŠ” ì¦‰ì‹œ, 2ë²ˆì§¸ë¶€í„° ê°„ê²©ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤(ì„œë²„ ë¡œì§ ì ìš© í•„ìš”)");

    const payload={
      blog_type:blog.type,
      blog_url:blog.url,
      category:selectedCat,
      topic:selectedTopic,
      start_time:"NOW",
      interval_hours
    };

    try{
      const res=await fetch(API_BASE+"/api/publish/now",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify(payload)
      });
      const j=await res.json();
      addGenOk("âœ… ì˜ˆì•½ ìš”ì²­ ì €ì¥ ì™„ë£Œ");
      alert(j.message || "ì €ì¥ ì™„ë£Œ");
      loadPublishList();
    }catch(e){
      addGenErr("âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨");
      alert("ì„œë²„ ì—°ê²° ì‹¤íŒ¨!");
    }
  }

  // Publish list
  function fmtMaybe(o, keys){ for(const k of keys){ if(o && o[k]) return String(o[k]); } return "-"; }

  async function loadPublishList(){
    const box=document.getElementById("publishList");
    box.innerHTML=`<div class="small">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>`;
    try{
      const res=await fetch(API_BASE+"/api/publish/list");
      const data=await res.json();
      const items=data.items||[];
      if(!items.length){ box.innerHTML=`<div class="small">ìš”ì²­ 0ê°œ</div>`; return; }

      let html=`<div class="small">ì´ <b>${items.length}</b>ê°œ</div>`;
      items.slice().reverse().forEach(it=>{
        html += `
          <div class="box" style="margin-top:8px">
            <b>ğŸ“ ${escapeHtml(fmtMaybe(it,["topic"]))}</b>
            <div class="small" style="margin-top:6px;line-height:1.6">
              ğŸ—‚ï¸ ${escapeHtml(fmtMaybe(it,["blog_type"]))} / ğŸ”— ${escapeHtml(fmtMaybe(it,["blog_url"]))}<br/>
              ğŸ·ï¸ ${escapeHtml(fmtMaybe(it,["category"]))} / â±ï¸ ${escapeHtml(fmtMaybe(it,["created_at"]))}
            </div>
          </div>
        `;
      });
      box.innerHTML=html;
    }catch(e){
      box.innerHTML=`<div class="small" style="color:#ffb4b4">ì„œë²„ ì—°ê²° ì‹¤íŒ¨</div>`;
    }
  }

  // init
  render();
  updateSel();
</script>
</body>
</html>

        <div class="small">ìœ„ì—ì„œ í…œí”Œë¦¿ ìˆ˜ì •/ì €ì¥í•˜ë©´, ìƒì„± ê²°ê³¼ì— ìë™ ì ìš©ë¼ìš”.</div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn" onclick="saveTemplates()">ğŸ’¾ ì €ì¥</button>
        <button class="btn danger" onclick="resetTemplates()">â™»ï¸ ê¸°ë³¸ê°’</button>
      </div>
    </div>

    <div class="small" style="margin-top:10px">
      ë³€ìˆ˜: <span class="chip">{{topic}}</span> <span class="chip">{{category}}</span>
      <span class="chip">{{image_url}}</span> <span class="chip">{{body_prompt}}</span>
    </div>

    <div style="margin-top:10px">
      <div class="small"><b>ğŸ“ ë³¸ë¬¸ í…œí”Œë¦¿</b></div>
      <textarea id="tplBody"></textarea>
    </div>

    <div style="margin-top:10px">
      <div class="small"><b>ğŸ–¼ï¸ ì´ë¯¸ì§€ í…œí”Œë¦¿(ì„ íƒ)</b></div>
      <textarea id="tplImage" style="min-height:120px"></textarea>
    </div>

    <div class="small" style="margin-top:10px">í˜„ì¬ ì ìš©: <b id="tplNow">-</b></div>
  </div>

  <!-- ì£¼ì œ -->
  <div class="box" id="templateBox">
    <div class="row">
      <div>
        <b>ğŸ§  ì£¼ì œ ìƒì„±</b>
        <div class="small">ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ë©´, ì‚¬ëŒì´ í´ë¦­í•˜ê³  ì‹¶ì€ ì œëª©ìœ¼ë¡œ ëª©ë¡ì´ ìƒì„±ë¼ìš”.</div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
        <input id="filter" placeholder="ğŸ” ê²€ìƒ‰ (â­ë§Œ: star)" oninput="render()">
        <button class="btn" onclick="copyAll()">ğŸ“‹ ì „ì²´ë³µì‚¬</button>
        <button class="btn" onclick="showStarOnly()">â­</button>
        <button class="btn primary" onclick="aiGenerateSelected()">âœ¨ AI ìƒì„±</button>
      </div>
    </div>

    <div class="grid" id="catGrid"></div>
  </div>

  <!-- ì£¼ì œ ëª©ë¡ -->
  <div class="box">
    <div class="row">
      <div>
        <b>ğŸ“š ì£¼ì œ ëª©ë¡</b>
        <div class="small" id="selInfo">ì„ íƒ ì£¼ì œ: -</div>
      </div>
      <div class="hint small">âœ… ì£¼ì œë¥¼ ì„ íƒí•œ ë’¤ â€œAI ìƒì„±â€ì„ ëˆ„ë¥´ì„¸ìš”.</div>
    </div>

    <div class="topicScroll" id="topics"></div>
  </div>

  <!-- ì§„í–‰ìƒí™© -->
  <div class="box" id="genBox">
    <div class="row">
      <b>ğŸ§¾ ì§„í–‰ ë¡œê·¸</b>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn" onclick="toggleGenBox()">ğŸ‘€ í† ê¸€</button>
        <button class="btn danger" onclick="clearGenLog()">ğŸ§¹ ì§€ìš°ê¸°</button>
      </div>
    </div>
    <div id="genLog"></div>
  </div>

  <!-- âœ… ìƒì„±ì™„ë£Œ â€œí†µ ë¯¸ë¦¬ë³´ê¸°â€ -->
  <div class="box" id="finalBox">
    <div class="row">
      <div>
        <b>âœ… ìƒì„± ì™„ë£Œ ë¯¸ë¦¬ë³´ê¸°(í†µìœ¼ë¡œ)</b>
        <div class="small" id="finalMeta">-</div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn" onclick="copyText(document.getElementById('finalBody').textContent)">ğŸ“‹ ë³¸ë¬¸ ë³µì‚¬</button>
        <button class="btn" onclick="copyText(document.getElementById('finalImage').textContent)">ğŸ–¼ï¸ ì´ë¯¸ì§€ ë³µì‚¬</button>
      </div>
    </div>

    <div class="linkRow" id="linkRow"></div>

    <div class="finalGrid">
      <div class="finalCard">
        <div class="finalHead">
          <div class="finalTitle">ğŸ“ ë³¸ë¬¸ í”„ë¡¬í”„íŠ¸</div>
        </div>
        <div class="finalText" id="finalBody"></div>
      </div>
      <div class="finalCard">
        <div class="finalHead">
          <div class="finalTitle">ğŸ–¼ï¸ ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸</div>
        </div>
        <div class="finalText" id="finalImage"></div>
      </div>
    </div>
  </div>

  <!-- ë°œí–‰ -->
  <div class="box">
    <div class="row">
      <div>
        <b>ğŸš€ ë°œí–‰</b>
        <div class="small">ì§€ê¸ˆì€ â€œì‹¤ì œ ì—…ë¡œë“œâ€ê°€ ì•„ë‹ˆë¼ ì„œë²„ì— ìš”ì²­ ì €ì¥ ë‹¨ê³„ì…ë‹ˆë‹¤(ì‹¤ì œ ì—…ë¡œë“œëŠ” OAuth ë¶™ì´ëŠ” ë‹¨ê³„ í•„ìš”).</div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
        <label class="small">â± ê°„ê²©</label>
        <select id="intervalHours" style="min-width:110px">
          <option value="1">1ì‹œê°„</option><option value="2">2ì‹œê°„</option><option value="3">3ì‹œê°„</option>
          <option value="4">4ì‹œê°„</option><option value="5">5ì‹œê°„</option><option value="6">6ì‹œê°„</option>
        </select>
      </div>
    </div>

    <div class="row" style="margin-top:10px">
      <button class="btn good" onclick="publishInstant()">ğŸš€ ì¦‰ì‹œë°œí–‰</button>
      <button class="btn primary" onclick="publishWithInterval()">â± ì¦‰ì‹œë°œí–‰(ì˜ˆì•½)</button>
      <button class="btn" onclick="loadPublishList()">ğŸ“¦ ë°œí–‰ìš”ì²­ ë¦¬ìŠ¤íŠ¸</button>
    </div>

    <div id="publishList" style="margin-top:10px"></div>
  </div>

</div>

<script>
  // API_BASE
  function getApiBase(){
    const d = JSON.parse(localStorage.getItem("baseone_settings_v3") || "{}");
    const base = (d.backend || "http://127.0.0.1:5000").trim();
    return base.replace(/\/+$/,"");
  }
  const API_BASE = getApiBase();
  document.addEventListener("DOMContentLoaded", ()=> {
    const el = document.getElementById("sv");
    if(el) el.textContent = API_BASE;
  });

  // Utils
  function escapeHtml(s){
    return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
  }
  function escapeAttr(s){
    return String(s).replaceAll("\\","\\\\").replaceAll("'","\\'");
  }
  function safeStr(x){ return (x===undefined || x===null) ? "" : String(x); }
  function applyTemplate(tpl, vars){
    let out = safeStr(tpl);
    Object.keys(vars).forEach(k=>{
      out = out.replaceAll(`{{${k}}}`, safeStr(vars[k]));
    });
    return out;
  }
  function copyText(t){ navigator.clipboard.writeText(t); alert("ë³µì‚¬ ì™„ë£Œ!"); }

  // Logs
  function showGenBox(){ document.getElementById("genBox").style.display = "block"; }
  function toggleGenBox(){
    const box = document.getElementById("genBox");
    box.style.display = (box.style.display==="none" ? "block" : "none");
  }
  function addGenLine(icon, color, msg){
    showGenBox();
    const log = document.getElementById("genLog");
    const t = new Date();
    const time = String(t.getHours()).padStart(2,"0")+":"+String(t.getMinutes()).padStart(2,"0")+":"+String(t.getSeconds()).padStart(2,"0");
    log.innerHTML += `<div style="color:${color}">${icon} <b>[${time}]</b> ${escapeHtml(msg)}</div>`;
    log.scrollTop = log.scrollHeight;
  }
  function addGenLog(msg){ addGenLine("ğŸŸ¦","#f6f8ff",msg); }
  function addGenOk(msg){ addGenLine("âœ…","#9ff5d2",msg); }
  function addGenErr(msg){ addGenLine("âŒ","#ffb4b4",msg); }
  function clearGenLog(){ document.getElementById("genLog").innerHTML = ""; }
function toggleTemplateBox(){
  const box = document.getElementById("templateBox");
  if(!box) return;
  box.style.display = (box.style.display === "none" ? "block" : "none");
}

  // Categories
  const CATS=[
    {k:"ê±´ê°•", s:"ğŸƒ ìš´ë™Â·ì˜ì–‘"},
    {k:"ì»´í“¨í„°/IT", s:"ğŸ’» ìœ í‹¸Â·ë³´ì•ˆ"},
    {k:"ìë™ì°¨", s:"ğŸš— ì •ë¹„Â·ë³´í—˜"},
    {k:"ìƒí™œ/ê°€ì „", s:"ğŸ  ì‚´ë¦¼Â·ì ˆì•½"},
    {k:"ìœ¡ì•„", s:"ğŸ¼ ìœ¡ì•„Â·êµìœ¡"},
    {k:"ëˆ/ì¬í…Œí¬", s:"ğŸ’° ì ˆì•½Â·ì„¸ê¸ˆ"},
    {k:"ì—¬í–‰", s:"ğŸ§³ ì½”ìŠ¤Â·ê¿€íŒ"},
    {k:"ìš”ë¦¬", s:"ğŸ³ ë ˆì‹œí”¼"},
    {k:"ìê¸°ê³„ë°œ", s:"ğŸ“ˆ ìŠµê´€"},
    {k:"ê³µë¶€/ìê²©ì¦", s:"ğŸ“š í•©ê²©"},
    {k:"ë°˜ë ¤ë™ë¬¼", s:"ğŸ¶ ì¼€ì–´"},
    {k:"íŒ¨ì…˜/ë·°í‹°", s:"ğŸ’„ ê´€ë¦¬"},
    {k:"ì·¨ë¯¸", s:"ğŸ¨ DIY"},
    {k:"ìŠ¤í¬ì¸ ", s:"ğŸ‹ï¸ ë£¨í‹´"},
    {k:"ê²Œì„", s:"ğŸ® íŒ"},
    {k:"ì˜í™”/ë“œë¼ë§ˆ", s:"ğŸ¬ ë¦¬ë·°"}
  ];

  let topics=[];
  let selectedTopic="";
  let selectedCat="";

  // Stars
  const STAR_KEY="baseone_fav_topics_v1";
  function getStars(){ try{ const s=JSON.parse(localStorage.getItem(STAR_KEY)||"[]"); return Array.isArray(s)?s:[]; }catch(e){ return []; } }
  function setStars(arr){ localStorage.setItem(STAR_KEY, JSON.stringify(arr)); }
  function isStar(t){ return getStars().includes(t); }
  function toggleStar(t){
    const s=getStars(); const i=s.indexOf(t);
    if(i>=0) s.splice(i,1); else s.unshift(t);
    setStars(s.slice(0,300)); render();
  }
  function showStarOnly(){ document.getElementById("filter").value="star"; render(); }

  // Build grid
  const grid=document.getElementById("catGrid");
  CATS.forEach(obj=>{
    const d=document.createElement("div");
    d.className="cat";
    d.onclick=()=>makeTopics(obj.k);
    d.innerHTML = `
      <div>
        <b>${obj.k}</b>
        <div class="desc">${obj.s}</div>
      </div>
      <span class="badge">30</span>
    `;
    grid.appendChild(d);
  });

  // âœ… ì‚¬ëŒë‹µê²Œ ì£¼ì œ ìƒì„±
  const SAMPLE={
    "ê±´ê°•":[
      "ë©´ì—­ë ¥ ë†’ì´ëŠ” ìƒí™œìŠµê´€ 7ê°€ì§€",
      "í”¼ë¡œê°€ ì•ˆ í’€ë¦´ ë•Œ ê¼­ í™•ì¸í•  ê²ƒ",
      "ì•„ì¹¨ì— ê°œìš´í•´ì§€ëŠ” ë£¨í‹´ ë§Œë“¤ê¸°",
      "ì¥ ê±´ê°• ì¢‹ì•„ì§€ëŠ” ì‹ìŠµê´€",
      "ìŠ¤íŠ¸ë ˆìŠ¤ ì¤„ì´ëŠ” ìƒí™œ íŒ",
      "í˜ˆì••/í˜ˆë‹¹ ê´€ë¦¬ì— ë„ì›€ ë˜ëŠ” ì‹ë‹¨",
      "ê±´ê°•ê²€ì§„ ê²°ê³¼í‘œ ë³´ëŠ” í•µì‹¬ í¬ì¸íŠ¸",
      "ìˆ˜ë©´ì˜ ì§ˆ ì˜¬ë¦¬ëŠ” í™˜ê²½ ì„¸íŒ…ë²•"
    ],
    "ìœ¡ì•„":[
      "ì•„ì´ ìˆ˜ë©´ìŠµê´€ ì¡ëŠ” í˜„ì‹¤ íŒ",
      "ë–¼ì“°ëŠ” ì•„ì´ ëŒ€ì²˜ë²•(ìƒí™©ë³„)",
      "ì´ˆë³´ ë¶€ëª¨ ì²´í¬ë¦¬ìŠ¤íŠ¸(í•„ìˆ˜í…œ/ì£¼ì˜ì )",
      "í¸ì‹ ì¤„ì´ëŠ” ì‹ì‚¬ ë£¨í‹´",
      "ì–´ë¦°ì´ì§‘ ì ì‘ì„ ë•ëŠ” ëŒ€í™”ë²•",
      "ìœ¡ì•„ ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ ë£¨í‹´",
      "ì•„ì´ ê°ê¸° ìì£¼ ê±¸ë¦´ ë•Œ í™•ì¸í•  ê²ƒ"
    ],
    "ëˆ/ì¬í…Œí¬":[
      "í†µì‹ ë¹„/ë³´í—˜ë£Œ ì¤„ì´ëŠ” ìˆœì„œ",
      "ì´ˆë³´ê°€ í•˜ê¸° ì‰¬ìš´ ì˜ˆì‚°ê´€ë¦¬ ë°©ë²•",
      "ì¹´ë“œ í˜œíƒ ìµœëŒ€ë¡œ ë°›ëŠ” ì‚¬ìš©ë²•",
      "ì—°ë§ì •ì‚°ì—ì„œ ë†“ì¹˜ê¸° ì‰¬ìš´ í•­ëª©",
      "ë¹„ìƒê¸ˆ í†µì¥ ë§Œë“œëŠ” ê°€ì¥ ì‰¬ìš´ ë°©ë²•"
    ]
  };

  function makeTopics(cat){
    selectedCat=cat;
    topics=[];
    if(SAMPLE[cat]){
      topics = SAMPLE[cat].slice();
      // ìƒ˜í”Œì´ ì ìœ¼ë©´ ìë™ í™•ì¥
      while(topics.length<30){
        topics.push(`${cat}ì—ì„œ ì‚¬ëŒë“¤ì´ ê°€ì¥ ë§ì´ ê²€ìƒ‰í•˜ëŠ” ì£¼ì œ ${topics.length+1}`);
      }
    }else{
      for(let i=1;i<=30;i++){
        topics.push(`${cat}ì—ì„œ ì‚¬ëŒë“¤ì´ ê°€ì¥ ë§ì´ ê²€ìƒ‰í•˜ëŠ” ì£¼ì œ ${i}`);
      }
    }
    selectedTopic = topics[0] || "";
    updateSel(); render();
  }

  function makeMoney(){
    selectedCat="ìˆ˜ìµí˜•";
    const base=[
      "ë³´í—˜ë£Œ ì¤„ì´ê¸°","ì‹ ìš©ì¹´ë“œ ì¶”ì²œ","í†µì‹ ë¹„ ì ˆì•½","ì „ê¸°ìš”ê¸ˆ ì ˆì•½","ê°€ìŠ¤ìš”ê¸ˆ ì ˆì•½",
      "ëŒ€ì¶œ ì´ì","ì—°ê¸ˆ/IRP","ì„¸ê¸ˆ ì ˆì•½","ìë™ì°¨ë³´í—˜","ì¤‘ê³ ì°¨"
    ];
    topics=[];
    for(let i=1;i<=30;i++){
      topics.push(`${base[i%base.length]}: ì‚¬ëŒë“¤ì´ ê°€ì¥ ë§ì´ ë¬»ëŠ” ê²ƒ ${i}`);
    }
    selectedTopic=topics[0]||"";
    updateSel(); render();
  }

  function updateSel(){
    document.getElementById("selInfo").textContent = `ì„ íƒ ì£¼ì œ: ${selectedTopic || "-"}`;
  }
  function setSelected(t){ selectedTopic=t; updateSel(); }

  function render(){
    const q=(document.getElementById("filter").value||"").trim().toLowerCase();
    const list=document.getElementById("topics");
    list.innerHTML="";

    let filtered=topics;
    if(q==="star"){
      filtered=getStars().slice();
      if(!filtered.length){
        list.innerHTML=`<div class="small">â­ ì¦ê²¨ì°¾ê¸° ì—†ìŒ</div>`;
        return;
      }
    }else if(q){
      filtered = topics.filter(t=>t.toLowerCase().includes(q));
    }

    filtered.forEach(t=>{
      const starOn=isStar(t);
      const d=document.createElement("div");
      d.className="card";
      d.innerHTML=`
        <div style="flex:1">
          <div class="cardTitle">${starOn?"â­":"â˜†"} ${escapeHtml(t)}</div>
          <div class="meta">${selectedCat?`ğŸ·ï¸ ${escapeHtml(selectedCat)}`:""}</div>
        </div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
          <button class="starBtn ${starOn?"on":""}" onclick="toggleStar('${escapeAttr(t)}')">${starOn?"â­":"â˜†"}</button>
          <button class="btn" onclick="setSelected('${escapeAttr(t)}')">ì„ íƒ</button>
          <button class="btn" onclick="copyText('${escapeAttr(t)}')">ë³µì‚¬</button>
        </div>
      `;
      list.appendChild(d);
    });
  }

  function copyAll(){
    if(!topics.length){alert("ì£¼ì œ ì—†ìŒ");return;}
    navigator.clipboard.writeText(topics.join("\n"));
    alert("ì „ì²´ ë³µì‚¬ ì™„ë£Œ!");
  }

  // Blogs select
  function loadBlogsToSelect(){
    const sel=document.getElementById("blogSelect");
    const now=document.getElementById("blogNow");
    sel.innerHTML="";

    const s=JSON.parse(localStorage.getItem("baseone_settings_v2")||"{}");
    const blogs=s.blogs||{blogspot:[],naver:[],tistory:[]};

    const options=[];
    (blogs.blogspot||[]).filter(Boolean).forEach((u,i)=>options.push({type:"blogspot",url:u,label:`ğŸŸ¦ ë¸”ë¡œê·¸ìŠ¤íŒŸ ${i+1} - ${u}`}));
    (blogs.naver||[]).filter(Boolean).forEach((u,i)=>options.push({type:"naver",url:u,label:`ğŸŸ© ë„¤ì´ë²„ ${i+1} - ${u}`}));
    (blogs.tistory||[]).filter(Boolean).forEach((u,i)=>options.push({type:"tistory",url:u,label:`ğŸŸ§ í‹°ìŠ¤í† ë¦¬ ${i+1} - ${u}`}));

    if(!options.length){
      const opt=document.createElement("option");
      opt.value=""; opt.textContent="ì €ì¥ëœ ë¸”ë¡œê·¸ ì£¼ì†Œ ì—†ìŒ â†’ ì„¤ì •ì—ì„œ ì €ì¥";
      sel.appendChild(opt); now.textContent="-";
      return;
    }

    options.forEach(o=>{
      const opt=document.createElement("option");
      opt.value=JSON.stringify({type:o.type,url:o.url});
      opt.textContent=o.label;
      sel.appendChild(opt);
    });

    const last=localStorage.getItem("baseone_last_blog");
    if(last){
      for(let i=0;i<sel.options.length;i++){
        if(sel.options[i].value===last){sel.selectedIndex=i;break;}
      }
    }
    updateBlogNow();
  }

  function updateBlogNow(){
    const sel=document.getElementById("blogSelect");
    const now=document.getElementById("blogNow");
    const v=sel.value;
    if(!v){ now.textContent="-"; return; }
    localStorage.setItem("baseone_last_blog", v);
    try{
      const obj=JSON.parse(v);
      now.textContent=`${obj.type} / ${obj.url}`;
      setPromptTab(obj.type);
    }catch(e){ now.textContent="-"; }
  }

  document.addEventListener("change",(e)=>{
    if(e.target && e.target.id==="blogSelect") updateBlogNow();
  });

  loadBlogsToSelect();

  // Templates
  const PROMPT_KEY="baseone_prompts_v1";
  const PLATFORMS=[
    {k:"blogspot",label:"ğŸŸ¦ ë¸”ë¡œê·¸ìŠ¤íŒŸ"},
    {k:"naver",label:"ğŸŸ© ë„¤ì´ë²„"},
    {k:"tistory",label:"ğŸŸ§ í‹°ìŠ¤í† ë¦¬"},
  ];
  let currentPlatform="blogspot";

  function defaultTemplates(){
    return {
      blogspot:{
        body:`ë„ˆëŠ” ë¸”ë¡œê·¸ìŠ¤íŒŸ ì „ë¬¸ ì‘ê°€ì•¼.
ì£¼ì œ: {{topic}}
ì¹´í…Œê³ ë¦¬: {{category}}

[ê¸°ë³¸ ë³¸ë¬¸ í”„ë¡¬í”„íŠ¸]
{{body_prompt}}`,
        image:`[ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸/URL]
{{image_prompt}}
{{image_url}}`
      },
      naver:{
        body:`ë„ˆëŠ” ë„¤ì´ë²„ ë¸”ë¡œê·¸ ì „ë¬¸ ì‘ê°€ì•¼.
ì£¼ì œ: {{topic}}
ì¹´í…Œê³ ë¦¬: {{category}}

[ê¸°ë³¸ ë³¸ë¬¸ í”„ë¡¬í”„íŠ¸]
{{body_prompt}}`,
        image:`[ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸/URL]
{{image_prompt}}
{{image_url}}`
      },
      tistory:{
        body:`ë„ˆëŠ” í‹°ìŠ¤í† ë¦¬ ì „ë¬¸ ì‘ê°€ì•¼.
ì£¼ì œ: {{topic}}
ì¹´í…Œê³ ë¦¬: {{category}}

[ê¸°ë³¸ ë³¸ë¬¸ í”„ë¡¬í”„íŠ¸]
{{body_prompt}}`,
        image:`[ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸/URL]
{{image_prompt}}
{{image_url}}`
      }
    };
  }

  function getTemplates(){
    try{
      const saved=JSON.parse(localStorage.getItem(PROMPT_KEY)||"null");
      if(saved && typeof saved==="object") return saved;
    }catch(e){}
    const d=defaultTemplates();
    localStorage.setItem(PROMPT_KEY, JSON.stringify(d));
    return d;
  }
  function setTemplates(obj){ localStorage.setItem(PROMPT_KEY, JSON.stringify(obj)); }

  function setPromptTab(k){
    currentPlatform=k;
    const tpls=getTemplates();
    const body=(tpls[k]&&tpls[k].body)?tpls[k].body:"";
    const image=(tpls[k]&&tpls[k].image)?tpls[k].image:"";
    document.getElementById("tplBody").value=body;
    document.getElementById("tplImage").value=image;
    document.getElementById("tplNow").textContent = (PLATFORMS.find(p=>p.k===k)?.label || k);
  }
  function saveTemplates(){
    const t=getTemplates();
    t[currentPlatform]=t[currentPlatform]||{};
    t[currentPlatform].body=document.getElementById("tplBody").value||"";
    t[currentPlatform].image=document.getElementById("tplImage").value||"";
    setTemplates(t);
    alert("ì €ì¥ ì™„ë£Œ!");
  }
  function resetTemplates(){
    const d=defaultTemplates();
    setTemplates(d);
    setPromptTab(currentPlatform);
    alert("ê¸°ë³¸ê°’ ë³µêµ¬ ì™„ë£Œ!");
  }
  setPromptTab(currentPlatform);

  function getSelectedBlog(){
    const v=document.getElementById("blogSelect").value;
    if(!v) return null;
    try{ return JSON.parse(v); }catch(e){ return null; }
  }

  // âœ… AI ìƒì„±
  async function aiGenerateSelected(){
    if(!selectedTopic){ alert("ì£¼ì œë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”!"); return; }

    const blog=getSelectedBlog();
    const blogType=blog?.type||"blogspot";
    setPromptTab(blogType);

    // âœ… ì´ì „ ë¯¸ë¦¬ë³´ê¸° ë°•ìŠ¤ â€œì—†ì• ê¸°â€
    document.getElementById("finalBox").style.display="none";

    showGenBox();
    addGenLog(`ğŸ›°ï¸ ì„œë²„: ${API_BASE}`);
    addGenLog(`ğŸ—‚ï¸ ë¸”ë¡œê·¸: ${blogType}`);
    addGenLog(`ğŸ§  ì£¼ì œ: ${selectedTopic}`);
    addGenLog(`ğŸ·ï¸ ì¹´í…Œê³ ë¦¬: ${selectedCat || "-"}`);
    addGenLog("1) ìƒì„± ìš”ì²­ ì „ì†¡");
    addGenLog("2) ì‘ë‹µ ëŒ€ê¸°");

    const s=JSON.parse(localStorage.getItem("baseone_settings_v2")||"{}");
    const payload={
      topic:selectedTopic,
      category:selectedCat,
      blog:blogType,
      img_provider:(s.imgProvider||"pexels"),
      pexels_key:(s.pexelsKey||"")
    };

    try{
      const res=await fetch(API_BASE+"/api/generate",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify(payload)
      });
      if(!res.ok){
        const t=await res.text();
        addGenErr("âŒ ìƒì„± ì‹¤íŒ¨: "+t);
        alert("ìƒì„± ì‹¤íŒ¨: "+t);
        return;
      }
      addGenLog("3) ì‘ë‹µ ìˆ˜ì‹ ");
      const data=await res.json();

      if(data.image_url){
        addGenOk("4) ì´ë¯¸ì§€ URL í™•ì¸ ì™„ë£Œ");
      }else{
        addGenLog("4) ì´ë¯¸ì§€ URL ì—†ìŒ(ê²€ìƒ‰ 0ê±´ ê°€ëŠ¥)");
      }

      addGenLog("5) í…œí”Œë¦¿ ì ìš©");
      addGenOk("âœ… ìƒì„± ì™„ë£Œ");

      renderFinalPreview(data, blogType);

    }catch(e){
      addGenErr("âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨");
      alert("ì„œë²„ ì—°ê²° ì‹¤íŒ¨! ì„¤ì •ì˜ ì„œë²„ ì£¼ì†Œ(API_BASE)ë¥¼ í™•ì¸í•˜ì„¸ìš”.");
    }
  }

  function renderFinalPreview(data, blogType){
    const tpls=getTemplates();
    const tpl=(tpls[blogType]||tpls["blogspot"]||{body:"{{body_prompt}}",image:"{{image_prompt}}\n{{image_url}}"});

    const vars={
      topic:data.topic||selectedTopic||"",
      category:data.category||selectedCat||"",
      image_url:data.image_url||"",
      body_prompt:data.body_prompt||"",
      image_prompt:data.image_prompt||""
    };

    const appliedBody=applyTemplate(tpl.body||"{{body_prompt}}",vars);
    const appliedImage=applyTemplate(tpl.image||"{{image_prompt}}\n{{image_url}}",vars);

    document.getElementById("finalMeta").textContent =
      `ğŸ§  ${vars.topic} / ğŸ·ï¸ ${vars.category} / ğŸ—‚ï¸ ${blogType} / â±ï¸ ${data.generated_at || ""}`;

    document.getElementById("finalBody").textContent = appliedBody;
    document.getElementById("finalImage").textContent = appliedImage;

    // âœ… ê´€ë ¨ ë§í¬ ë²„íŠ¼(ë„¤ëª¨ ë°•ìŠ¤ ë²„íŠ¼ì‹)
    const q=encodeURIComponent(`${vars.topic} ${vars.category}`.trim());
    const links=[
      {label:"ğŸ” êµ¬ê¸€", url:`https://www.google.com/search?q=${q}`},
      {label:"ğŸ“° ë‰´ìŠ¤", url:`https://www.google.com/search?q=${q}+site:news`},
      {label:"ğŸ“Œ ë„¤ì´ë²„", url:`https://search.naver.com/search.naver?query=${q}`},
      {label:"â–¶ï¸ ìœ íŠœë¸Œ", url:`https://www.youtube.com/results?search_query=${q}`},
      {label:"ğŸ–¼ï¸ ì´ë¯¸ì§€", url:`https://www.google.com/search?tbm=isch&q=${q}`},
    ];
    const row=document.getElementById("linkRow");
    row.innerHTML = links.map(l=>`<a class="linkBtn" href="${l.url}" target="_blank" rel="noopener noreferrer">${l.label}</a>`).join("");

    document.getElementById("finalBox").style.display="block";
  }

  // âœ… ë°œí–‰ ë²„íŠ¼ 2ê°œ
  async function publishInstant(){
    const blog=getSelectedBlog();
    if(!blog || !selectedTopic){ alert("ë¸”ë¡œê·¸ì™€ ì£¼ì œë¥¼ ì„ íƒí•˜ì„¸ìš”"); return; }
    showGenBox();
    addGenLog("ğŸš€ ì¦‰ì‹œë°œí–‰ í´ë¦­");
    addGenLog("âš ï¸ í˜„ì¬ëŠ” ì„œë²„ì— ì €ì¥ ë‹¨ê³„(OAuth ë¶™ì´ë©´ ì‹¤ì œ ì—…ë¡œë“œ ê°€ëŠ¥)");

    // ì„œë²„ì— endpointê°€ ì•„ì§ ì—†ìœ¼ë©´ â€œì €ì¥â€ë§Œ í•˜ë„ë¡ ê¸°ì¡´ now endpoint ì‚¬ìš©
    const payload={
      blog_type:blog.type,
      blog_url:blog.url,
      category:selectedCat,
      topic:selectedTopic,
      start_time:"NOW",
      interval_hours:"0"
    };

    try{
      const res=await fetch(API_BASE+"/api/publish/now",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify(payload)
      });
      const j=await res.json();
      addGenOk("âœ… ì¦‰ì‹œë°œí–‰ ìš”ì²­ ì €ì¥ ì™„ë£Œ");
      alert(j.message || "ì €ì¥ ì™„ë£Œ");
      loadPublishList();
    }catch(e){
      addGenErr("âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨");
      alert("ì„œë²„ ì—°ê²° ì‹¤íŒ¨!");
    }
  }

  async function publishWithInterval(){
    const blog=getSelectedBlog();
    if(!blog || !selectedTopic){ alert("ë¸”ë¡œê·¸ì™€ ì£¼ì œë¥¼ ì„ íƒí•˜ì„¸ìš”"); return; }
    const interval_hours=document.getElementById("intervalHours").value;
    showGenBox();
    addGenLog("â± ì¦‰ì‹œë°œí–‰(ì˜ˆì•½) í´ë¦­");
    addGenLog("âœ… 1ê°œëŠ” ì¦‰ì‹œ, 2ë²ˆì§¸ë¶€í„° ê°„ê²©ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤(ì„œë²„ ë¡œì§ ì ìš© í•„ìš”)");

    const payload={
      blog_type:blog.type,
      blog_url:blog.url,
      category:selectedCat,
      topic:selectedTopic,
      start_time:"NOW",
      interval_hours
    };

    try{
      const res=await fetch(API_BASE+"/api/publish/now",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify(payload)
      });
      const j=await res.json();
      addGenOk("âœ… ì˜ˆì•½ ìš”ì²­ ì €ì¥ ì™„ë£Œ");
      alert(j.message || "ì €ì¥ ì™„ë£Œ");
      loadPublishList();
    }catch(e){
      addGenErr("âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨");
      alert("ì„œë²„ ì—°ê²° ì‹¤íŒ¨!");
    }
  }

  // Publish list
  function fmtMaybe(o, keys){ for(const k of keys){ if(o && o[k]) return String(o[k]); } return "-"; }

  async function loadPublishList(){
    const box=document.getElementById("publishList");
    box.innerHTML=`<div class="small">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>`;
    try{
      const res=await fetch(API_BASE+"/api/publish/list");
      const data=await res.json();
      const items=data.items||[];
      if(!items.length){ box.innerHTML=`<div class="small">ìš”ì²­ 0ê°œ</div>`; return; }

      let html=`<div class="small">ì´ <b>${items.length}</b>ê°œ</div>`;
      items.slice().reverse().forEach(it=>{
        html += `
          <div class="box" style="margin-top:8px">
            <b>ğŸ“ ${escapeHtml(fmtMaybe(it,["topic"]))}</b>
            <div class="small" style="margin-top:6px;line-height:1.6">
              ğŸ—‚ï¸ ${escapeHtml(fmtMaybe(it,["blog_type"]))} / ğŸ”— ${escapeHtml(fmtMaybe(it,["blog_url"]))}<br/>
              ğŸ·ï¸ ${escapeHtml(fmtMaybe(it,["category"]))} / â±ï¸ ${escapeHtml(fmtMaybe(it,["created_at"]))}
            </div>
          </div>
        `;
      });
      box.innerHTML=html;
    }catch(e){
      box.innerHTML=`<div class="small" style="color:#ffb4b4">ì„œë²„ ì—°ê²° ì‹¤íŒ¨</div>`;
    }
  }

  // init
  render();
  updateSel();
</script>
</body>
</html>

