<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>BaseOne 설정</title>
  <style>
    body{background:#141626;color:#eee;font-family:sans-serif;padding:20px}
    h1{color:#7db4ff}
    .box{background:#1f2240;border-radius:10px;padding:15px;margin-bottom:15px}
    input{width:100%;padding:8px;margin:4px 0}
    button{padding:8px 12px;margin:4px;border:none;border-radius:6px;cursor:pointer}
    .add{background:#4e8ef7;color:white}
    .save{background:#3fa46a;color:white}
    .test{background:#777;color:white}
    .bad{color:#ff8a8a}
    .ok{color:#8affb0}
  </style>
</head>
<body>

<h1>BaseOne 설정</h1>
<a href="index.html" style="color:#aaa">← 메인으로</a>

<div class="box">
  <h3>블로그스팟 (최대 10개)</h3>
  <div id="blogspotList"></div>
  <button class="add" onclick="addBlog('blogspot')">블로그스팟 추가</button>
</div>

<div class="box">
  <h3>네이버 (최대 3개)</h3>
  <div id="naverList"></div>
  <button class="add" onclick="addBlog('naver')">네이버 추가</button>
</div>

<div class="box">
  <h3>티스토리 (최대 10개)</h3>
  <div id="tistoryList"></div>
  <button class="add" onclick="addBlog('tistory')">티스토리 추가</button>
</div>

<button class="save" onclick="saveBlogs()">전체 저장</button>

<script>
const LIMIT={blogspot:10,naver:3,tistory:10};
let blogs = JSON.parse(localStorage.getItem("baseone.blogs")||"[]");

function render(){
  ["blogspot","naver","tistory"].forEach(type=>{
    const box=document.getElementById(type+"List");
    box.innerHTML="";
    blogs.filter(b=>b.type===type).forEach((b,i)=>{
      box.innerHTML+=`
        <div>
          <input placeholder="이름" value="${b.name||""}" oninput="bname('${type}',${i},this.value)">
          <input placeholder="주소" value="${b.url||""}" oninput="burl('${type}',${i},this.value)">
          <button class="test" onclick="testBlog('${type}',${i})">연동확인</button>
          <span id="st_${type}_${i}"></span>
        </div>
      `;
    });
  });
}

function addBlog(type){
  if(blogs.filter(b=>b.type===type).length>=LIMIT[type]){
    alert(type+" 최대 개수 초과"); return;
  }
  blogs.push({type,name:"",url:""});
  render();
}

function bname(type,idx,val){
  blogs.filter(b=>b.type===type)[idx].name=val;
}
function burl(type,idx,val){
  blogs.filter(b=>b.type===type)[idx].url=val;
}

function saveBlogs(){
  localStorage.setItem("baseone.blogs",JSON.stringify(blogs));
  alert("저장 완료");
}

async function testBlog(type,idx){
  const b = blogs.filter(x=>x.type===type)[idx];
  const out=document.getElementById(`st_${type}_${idx}`);
  if(!b.url){ out.innerHTML="<span class='bad'>주소 없음</span>"; return;}

  if(type!=="blogspot"){
    out.innerHTML="<span class='ok'>형식만 확인</span>";
    return;
  }

  out.innerHTML="서버 확인중...";
  try{
    const r = await fetch("http://127.0.0.1:5000/api/blogspot/test");
    const d = await r.json();
    out.innerHTML = d.ok ? `<span class="ok">${d.message}</span>` :
                           `<span class="bad">${d.error}</span>`;
  }catch(e){
    out.innerHTML="<span class='bad'>서버 꺼짐</span>";
  }
}

render();
</script>
</body>
</html>
