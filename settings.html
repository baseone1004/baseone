<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BaseOne 설정</title>
<style>
  body{margin:0;font-family:sans-serif;background:#0b1020;color:#eef2ff}
  .wrap{max-width:900px;margin:0 auto;padding:18px}
  .top{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap}
  .btn{padding:10px 14px;border-radius:10px;border:1px solid #444;background:#1f2a44;color:white;font-weight:bold;cursor:pointer}
  .btn.blue{background:#4f8cff;border:none}
  .box{background:#141a30;margin-top:14px;padding:14px;border-radius:14px;border:1px solid rgba(255,255,255,.08)}
  input,select{padding:10px;border-radius:10px;border:1px solid #444;background:#0f1530;color:white;min-width:260px}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between}
  .small{font-size:13px;color:#cfd6ff}
</style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <div style="font-size:22px;font-weight:800">⚙️ BaseOne 설정</div>
    <a href="/"><button class="btn">← 메인으로</button></a>
  </div>

  <div class="box">
    <div class="row">
      <div>
        <div style="font-weight:700;margin-bottom:6px">글작성(텍스트) API</div>
        <div class="small">키는 이 PC 브라우저(LocalStorage)에만 저장돼요.</div>
      </div>
      <div></div>
    </div>

    <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
      <label>
        <div class="small">Provider</div>
        <select id="textProvider">
          <option value="gemini">Gemini</option>
          <option value="gpt">ChatGPT(추가 예정)</option>
          <option value="genspark">GenSpark(추가 예정)</option>
        </select>
      </label>

      <label>
        <div class="small">Gemini API Key</div>
        <input id="geminiKey" placeholder="AIza..."/>
      </label>
    </div>

    <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
      <button class="btn blue" onclick="saveSettings()">저장</button>
      <button class="btn" onclick="testServer()">서버 연결 확인</button>
      <button class="btn" onclick="testGenerate()">생성 테스트</button>
    </div>

    <div id="log" class="small" style="margin-top:12px;white-space:pre-wrap"></div>
  </div>

  <div class="box">
    <div style="font-weight:700;margin-bottom:6px">Gemini API 발급 방법</div>
    <div class="small">
      1) Google AI Studio에서 API 키 만들기<br/>
      2) 생성된 키를 위 입력칸에 붙여넣기<br/>
      3) 저장 후 “생성 테스트” 눌러서 확인
    </div>
  </div>
</div>

<script>
  const KEY = "baseone_settings_v2";

  function loadSettings(){
    const s = JSON.parse(localStorage.getItem(KEY) || "{}");
    document.getElementById("textProvider").value = s.textProvider || "gemini";
    document.getElementById("geminiKey").value = s.geminiKey || "";
  }

  function saveSettings(){
    const s = {
      textProvider: document.getElementById("textProvider").value,
      geminiKey: document.getElementById("geminiKey").value.trim()
    };
    localStorage.setItem(KEY, JSON.stringify(s));
    log("✅ 저장 완료");
  }

  async function testServer(){
    try{
      const r = await fetch("http://127.0.0.1:5000/health");
      const j = await r.json();
      log("✅ 서버 OK\n" + JSON.stringify(j, null, 2));
    }catch(e){
      log("❌ 서버 연결 실패\n서버를 먼저 실행하세요: python server.py");
    }
  }

  async function testGenerate(){
    const s = JSON.parse(localStorage.getItem(KEY) || "{}");
    if(!s.geminiKey){ log("❌ Gemini Key가 비어있어요."); return; }
    try{
      const res = await fetch("http://127.0.0.1:5000/api/generate", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({
          topic: "전기요금 줄이는 방법",
          category: "생활/가전",
          model: "gemini-2.0-flash",
          geminiKey: s.geminiKey
        })
      });
      const txt = await res.text();
      log("✅ 생성 응답\n" + txt);
    }catch(e){
      log("❌ 생성 실패\n" + e);
    }
  }

  function log(t){ document.getElementById("log").textContent = t; }

  loadSettings();
</script>
</body>
</html>
